<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Tutor Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Flowbite & Tailwind CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['\\[', '\\]'], ['$$', '$$']] },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'] }
    };
  </script>
  <style>
    body { min-height: 100vh; background: #f3f6fc; }
    /* Avatars and bubbles remain styled for custom appearance */
    .message-row.user .message-bubble { background:#dcfce7; color:#25633e; border-radius:1.25rem 1.25rem 1.25rem 0.5rem; }
    .message-row.prof .message-bubble { background:#f3f4f6; color:#112035; border-radius:1.25rem 1.25rem 0.5rem 1.25rem; }
    .message-avatar {
      width:32px;height:32px;border-radius:50%;object-fit:cover;
      box-shadow:0 2px 8px #2221;}
    .message-meta { font-size:0.82rem; color:#6b7280; margin-top:4px; }
  </style>
</head>
<body class="font-sans bg-gray-50">
  <!-- LOGIN MODAL -->
  <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50" style="display:none;">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col items-center px-8 py-8">
      <form class="w-full flex flex-col gap-6" id="loginForm">
        <div class="flex flex-col items-center gap-3">
          <img src="/logo.png" alt="Academic Tutor" class="w-16 h-16 rounded-full shadow-lg mb-2">
          <h2 class="text-xl font-bold text-blue-700">Welcome to Academic Tutor</h2>
          <p class="text-gray-500 text-base text-center">Your personal academic assistant</p>
        </div>
        <input type="text" id="loginUsername" class="block w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition"
               placeholder="Username" autocomplete="username" required>
        <input type="password" id="loginPassword" class="block w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition"
               placeholder="Password" autocomplete="current-password" required>
        <button type="submit" class="w-full py-2 bg-blue-600 hover:bg-blue-800 text-white rounded-lg font-semibold text-base transition login-btn">
          Login
        </button>
        <div id="loginError" class="login-error text-red-600 text-sm text-center mt-1 min-h-[18px]"></div>
      </form>
    </div>
  </div>

  <!-- MAIN CHAT CONTAINER -->
  <main id="chatContainer" class="mx-auto flex flex-col w-full max-w-2xl min-h-screen bg-white shadow-2xl rounded-xl overflow-hidden" style="display:none;">
    <!-- Header -->
    <header class="flex items-center justify-between px-6 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white chat-header">
      <span class="flex items-center gap-3 text-lg font-bold"><i class="fas fa-graduation-cap"></i> Academic Tutor</span>
      <button class="new-conversation-btn flex items-center gap-2 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded-lg shadow transition"
        id="newConvBtn"><i class="fa fa-plus"></i> New Conversation</button>
      <span class="user-info-bar ml-3 text-gray-200" id="userInfoBar"></span>
    </header>
    <!-- Topics Navigation -->
    <nav class="chat-topics-bar overflow-x-auto flex gap-2 items-center px-4 py-2 bg-blue-50 border-b border-blue-100">
      <button class="topic-btn active flex items-center gap-2 bg-blue-100 text-blue-800 px-4 py-2 rounded shadow font-semibold"
        id="topicGeneral"><i class="fa fa-book"></i> General</button>
      <button class="topic-btn flex items-center gap-2 bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded shadow font-semibold"
        id="newTopicBtn"><i class="fa fa-plus"></i> New Topic</button>
    </nav>
    <!-- Delete history button -->
    <button class="delete-history-btn flex items-center gap-2 text-white bg-red-600 hover:bg-red-700 rounded-xl px-4 py-2 mx-4 mt-2 w-fit"
      id="deleteHistoryBtn" style="display:none;"><i class="fa fa-trash"></i> Delete History</button>

    <!-- Messages area -->
    <section id="chatMessages" class="chat-messages flex flex-col gap-5 px-6 py-2 overflow-y-auto bg-gray-50 grow relative mb-24">
      <div class="typing-indicator text-gray-500 italic ml-2 text-sm" id="typingIndicator" style="display:none;">Professor is typing...</div>
      <!-- Injected messages go here -->
      <!-- Example (remove in production):
      <div class="message-row user justify-end mb-2">
        <div class="message-bubble max-w-xl px-4 py-3 shadow-lg relative">Hello!</div>
      </div>
      <div class="message-row prof flex items-end gap-2 mb-2">
        <img src="https://randomuser.me/api/portraits/men/31.jpg" class="message-avatar" alt="Professor">
        <div>
          <div class="message-bubble px-4 py-3 shadow-lg">Hi! How can I help you?</div>
          <div class="message-meta">Professor â€¢ 09:30 AM</div>
        </div>
      </div>
      -->
    </section>
    <button id="loadMoreBtn" class="loadmore-btn block mx-auto mt-2 px-8 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg shadow transition"
      style="display:none;">Load More</button>

    <!-- Fixed Footer for Input -->
    <footer class="fixed-footer fixed bottom-0 left-0 w-full bg-white border-t border-blue-100 px-0 py-2 z-50 flex items-center justify-center shadow-lg">
      <div class="chat-input-bar-container w-full max-w-2xl mx-auto px-2">
        <form class="chat-input-bar flex items-center gap-2 w-full" id="chatForm" autocomplete="off">
          <button type="button" class="emoji-btn flex items-center justify-center w-9 h-9 text-blue-400 rounded hover:bg-blue-100 transition"
            id="emojiBtn" title="Emoji Picker"><i class="fa-regular fa-face-grin"></i></button>
          <div class="emoji-picker absolute bottom-16 left-2 bg-white border border-blue-200 rounded-xl shadow-xl p-3 z-50 hidden"
            id="emojiPicker"></div>
          <button type="button" class="attach-btn flex items-center justify-center w-9 h-9 text-blue-400 rounded hover:bg-blue-100 transition"
            id="attachBtn" title="Attach image"><i class="fa-solid fa-paperclip"></i></button>
          <input type="file" style="display:none;" id="attachInput" accept="image/*"/>
          <textarea class="chat-input block px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-200 transition w-full resize-y"
            id="chatInput" rows="2" placeholder="Type your academic question... (Shift+Enter for newline, $math$ or block \\[math\\])" autocomplete="off"></textarea>
          <button type="submit" class="send-btn bg-blue-600 hover:bg-blue-800 text-white rounded-full w-10 h-10 flex items-center justify-center text-lg transition"
            title="Send"><i class="fa-solid fa-paper-plane"></i></button>
        </form>
      </div>
    </footer>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
  <script src="ai-chat.js"></script>
</body>
</html>
