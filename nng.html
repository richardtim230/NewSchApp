<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<head>
  <meta charset="UTF-8">
  <title>OAU ExamGuard - Student Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Flowbite (carousel etc) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .sidebar-active {
      background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%) !important;
      color: #fff !important;
    }
    .sidebar-dot {
      width: 9px; height: 9px; background: #ef4444; border-radius: 100%; margin-left: 6px;
      display: inline-block; vertical-align: middle;
    }
    .carousel-container {
      max-height: 220px;
    }
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body class="h-full bg-gray-100">
  <!-- Mobile Overlay -->
  <div id="mobileDrawerOverlay" onclick="toggleMobileDrawer(false)" class="fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>
  <!-- Mobile Sidebar -->
  <aside id="mobileSidebar"
    class="fixed z-50 top-0 left-0 bottom-0 w-64 bg-[#2852a0] text-white transform -translate-x-full md:hidden transition-transform duration-300 ease-in-out"
    style="background:linear-gradient(180deg,#2852a0 0%,#467ae6 100%);">
    <div class="h-full flex flex-col py-5">
      <div class="px-7 py-3 mb-2">
        <h2 class="font-bold text-2xl tracking-tight leading-tight mb-1">OAU ExamGuard</h2>
        <div class="text-xs text-white/80">Student Dashboard</div>
      </div>
      <nav class="mt-6 flex-1">
        <ul class="flex flex-col gap-3 text-base">
          <li><button class="sidebar-btn sidebar-active w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('overview',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="2"/><path d="M12 8v4l3 3" stroke-width="2"/></svg>Dashboard</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('mocktests',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><rect x="4" y="4" width="16" height="16" rx="2" stroke-width="2"/></svg>Mock Tests</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('pastquestions',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 4h14M5 20h14M7 4v16M17 4v16" stroke-width="2"/></svg>Past Questions</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('taskscenter',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M9 12l2 2l4 -4"/><rect x="2" y="2" width="20" height="20" rx="5" stroke-width="2"/></svg>Tasks Center</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('resources',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 20h14M7 20V7a2 2 0 012-2h6a2 2 0 012 2v13" stroke-width="2"/></svg>Study Resources</button></li>
          <li><button class="sidebar-btn w-full relative py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('messages',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M21 10.5A8.38 8.38 0 013 10.5c0-5.25 7.5-9 9-9s9 3.75 9 9z"/><circle cx="12" cy="10" r="2"/></svg>Messages<span class="sidebar-dot absolute right-5 top-3"></span></button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('settings',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><circle cx="12" cy="8" r="4" stroke-width="2"/><path d="M6 20v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke-width="2"/></svg>Profile Settings</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('assignments',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M4 7h16M4 17h16"/><rect x="2" y="2" width="20" height="20" rx="2" stroke-width="2"/></svg>Assignment</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('studyPadi',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M16 2v4M8 2v4"/></svg>My StudyPadi</button></li>
          <li><button class="sidebar-btn w-full relative py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('broadcasts',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 15h2a3 3 0 003-3V8m9 7a7 7 0 00-7-7"></path></svg>Broadcasts<span class="sidebar-dot absolute right-5 top-3"></span></button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('logout',true)"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M17 16l4-4m0 0l-4-4m4 4H7"/></svg>Logout</button></li>
        </ul>
      </nav>
    </div>
  </aside>

<div>
  <!-- Desktop Sidebar (fixed, scrollable, overlays content only on direct interaction) -->
  <aside class="hidden md:flex fixed pt-20 top-0 left-0 h-full w-64 bg-gradient-to-b from-[#2852a0] to-[#467ae6] text-white flex-col border-r z-30" id="desktopSidebar" style="will-change: transform;">
    <div class="h-full flex flex-col overflow-y-auto">
      <div class="px-7 py-6 mb-2 border-b border-white/10">
        <h2 class="font-bold text-2xl tracking-tight leading-tight mb-1">OAU ExamGuard</h2>
        <div class="text-xs text-white/80">Student Dashboard</div>
      </div>
      <nav class="mt-6 flex-1">
        <ul class="flex flex-col gap-2 text-base" id="desktopSidebarList">
          <!-- Same sidebar buttons as mobile -->
          <li><button class="sidebar-btn sidebar-active w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('overview')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="2"/><path d="M12 8v4l3 3" stroke-width="2"/></svg>Dashboard</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('mocktests')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><rect x="4" y="4" width="16" height="16" rx="2" stroke-width="2"/></svg>Mock Tests</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('pastquestions')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 4h14M5 20h14M7 4v16M17 4v16" stroke-width="2"/></svg>Past Questions</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('taskscenter')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M9 12l2 2l4 -4"/><rect x="2" y="2" width="20" height="20" rx="5" stroke-width="2"/></svg>Tasks Center</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('resources')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 20h14M7 20V7a2 2 0 012-2h6a2 2 0 012 2v13" stroke-width="2"/></svg>Study Resources</button></li>
          <li><button class="sidebar-btn w-full relative py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('messages')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M21 10.5A8.38 8.38 0 013 10.5c0-5.25 7.5-9 9-9s9 3.75 9 9z"/><circle cx="12" cy="10" r="2"/></svg>Messages<span class="sidebar-dot absolute right-5 top-3"></span></button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('settings')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><circle cx="12" cy="8" r="4" stroke-width="2"/><path d="M6 20v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke-width="2"/></svg>Profile Settings</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('assignments')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M4 7h16M4 17h16"/><rect x="2" y="2" width="20" height="20" rx="2" stroke-width="2"/></svg>Assignment</button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('studyPadi')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M16 2v4M8 2v4"/></svg>My StudyPadi</button></li>
          <li><button class="sidebar-btn w-full relative py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('broadcasts')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M5 15h2a3 3 0 003-3V8m9 7a7 7 0 00-7-7"></path></svg>Broadcasts<span class="sidebar-dot absolute right-5 top-3"></span></button></li>
          <li><button class="sidebar-btn w-full py-2 px-7 rounded-l-full flex items-center gap-3" onclick="switchSection('logout')"><svg class="w-6 h-6" fill="none" stroke="currentColor"><path d="M17 16l4-4m0 0l-4-4m4 4H7"/></svg>Logout</button></li>
        </ul>
      </nav>
    </div>
  </aside>


   <div class="md:ml-64 flex flex-col min-h-screen bg-gray-100">
<!-- Responsive Header Block (Mobile & Desktop, Profile Pic from JS) -->
<header
  class="fixed top-0 left-0 right-0 z-40 w-full bg-white border-b px-2 sm:px-4 md:px-8 py-3 flex items-center justify-between shadow-sm overflow-x-hidden"
>
  <div class="flex items-center gap-2 sm:gap-3">
    <button class="md:hidden rounded-full bg-indigo-600 p-2" onclick="toggleMobileDrawer(true)" aria-label="Open sidebar">
      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <span class="font-bold text-lg md:text-2xl text-indigo-800">Student Dashboard</span>
  </div>
  <div class="flex items-center gap-3 sm:gap-4">
    <div class="relative w-24 xs:w-28 sm:w-36 md:w-64">
      <input type="text" placeholder="Search..." class="pl-10 pr-3 py-2 w-full rounded-lg border bg-gray-50 focus:outline-none focus:ring focus:border-blue-300 text-sm">
      <div class="absolute left-2 top-2 text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      </div>
    </div>
    <button type="button" id="notifBtn" class="relative">
      <svg class="w-7 h-7 text-gray-600 hover:text-blue-600" fill="none" stroke="currentColor">
        <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5"/>
      </svg>
      <span id="notifBadge" class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border border-white"></span>
    </button>
    <div class="relative">
      <button type="button" id="profileDropdownBtn">
        <img id="headerProfilePic" class="w-8 h-8 rounded-full border-2 border-indigo-600 object-cover" src="https://ui-avatars.com/api/?name=Student&background=ede9fe&color=3b82f6&size=128&rounded=true" alt="Profile">
      </button>
      <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded shadow-lg z-10">
        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-100" onclick="switchSection('profile')">Profile</a>
        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-100" onclick="switchSection('settings')">Settings</a>
        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-100" onclick="switchSection('logout')">Logout</a>
      </div>
    </div>
  </div>
</header>

<!-- Profile avatar JS update -->
<script>
// Universal profile picture helper
function getProfilePicUrl(student) {
  if (!student) return "https://ui-avatars.com/api/?name=Student&background=ede9fe&color=3b82f6&size=128&rounded=true";
  if (student.profilePic) {
    if (student.profilePic.startsWith("data:image")) return student.profilePic;
    if (student.profilePic.startsWith("http")) return student.profilePic;
    return window.location.origin + student.profilePic;
  }
  const name = encodeURIComponent(student.fullname || student.username || "Student");
  return `https://ui-avatars.com/api/?name=${name}&background=ede9fe&color=3b82f6&size=128&rounded=true`;
}

function updateHeaderProfilePic(student) {
  const img = document.getElementById("headerProfilePic");
  if (img) img.src = getProfilePicUrl(student);
}



// Example async loader
async function fetchStudentProfile() {
  try {
    const resp = await fetch('https://examguide.onrender.com/api/auth/me', { credentials: 'include' });
    const data = await resp.json();
    student = data.user; // Adjust if your API shape is different
    updateHeaderProfilePic(student);
    // More code to populate the rest of user details
  } catch (err) {
    console.error('Failed to fetch student profile:', err);
  }
}

// Ensure DOM is loaded before running code
document.addEventListener("DOMContentLoaded", function() {
  fetchStudentProfile();
});
</script>
 <main class="flex-1 p-2 md:p-8 bg-gray-100 overflow-x-auto hide-scrollbar pt-[88px] md:pt-[104px]">
        <!-- Main Sections -->
        <div id="overview-section" class="section-block">
          <!-- Carousel Section -->
            <div class="carousel-container w-full max-w-5xl mx-auto mb-4 rounded-xl overflow-hidden shadow-lg">
          <div id="adCarousel" class="relative" data-carousel="slide">
            <div class="relative h-[160px] md:h-[220px] overflow-hidden rounded-xl">
              <div class="duration-700 ease-in-out absolute inset-0 transition-all" data-carousel-item="active">
                <img src="oaugate-1140x570.jpg" class="w-full h-full object-cover" alt="Ad 1">
                <div class="absolute bottom-3 left-3 bg-black/60 px-4 py-1 rounded text-white text-sm hidden md:block">Get 50% Off on ExamGuard Resources! ðŸš€</div>
              </div>
              <div class="duration-700 ease-in-out absolute inset-0 transition-all" data-carousel-item>
                <img src="oaugate-1140x570.jpg" class="w-full h-full object-cover" alt="Ad 2">
                <div class="absolute bottom-3 left-3 bg-black/60 px-4 py-1 rounded text-white text-sm hidden md:block">Try Mock Tests for Free This Month!</div>
              </div>
              <div class="duration-700 ease-in-out absolute inset-0 transition-all" data-carousel-item>
                <img src="oaugate-1140x570.jpg" class="w-full h-full object-cover" alt="Ad 3">
                <div class="absolute bottom-3 left-3 bg-black/60 px-4 py-1 rounded text-white text-sm hidden md:block">Earn While You Learn: Join Blog & Earn!</div>
              </div>
            </div>
            <button type="button" class="absolute top-0 left-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
              <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/70 group-hover:bg-white/90">
                <svg class="w-6 h-6 text-indigo-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"></path></svg>
              </span>
            </button>
            <button type="button" class="absolute top-0 right-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
              <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/70 group-hover:bg-white/90">
                <svg class="w-6 h-6 text-indigo-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg>
              </span>
            </button>
          </div>
        </div>
          <!-- Welcome + Motivation -->
          <div class="mb-4">
            <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-xl shadow flex flex-col md:flex-row justify-between items-center px-4 md:px-6 py-5">
              <div>
                <h2 class="text-2xl font-bold mb-1">Welcome back, Alex!</h2>
                <div class="text-md" id="motivation-message">You are capable of amazing things.</div>
              </div>
              <div class="mt-3 md:mt-0">
                <button onclick="randomMotivation()" class="bg-white/20 hover:bg-indigo-400 rounded px-4 py-2 font-semibold">Refresh Motivation</button>
              </div>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="mb-5">
            <div class="bg-white rounded-xl shadow px-3 py-4 flex justify-center">
              <div class="w-full flex flex-wrap justify-center gap-3">
                <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm"
                  onclick="window.location.href='#'">
                  <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor">
                    <rect x="2" y="6" width="20" height="14" rx="3" stroke-width="2"/><path d="M10 10h4M10 14h2" stroke-width="2"/>
                  </svg>
                  <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Marketplace</span>
                </button>
                <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm"
                  onclick="window.location.href='#'">
                  <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor">
                    <circle cx="12" cy="8" r="4" stroke-width="2"/><path d="M6 20v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke-width="2"/>
                  </svg>
                  <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Account Settings</span>
                </button>
                <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm"
                  onclick="window.location.href='#'">
                  <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor">
                    <circle cx="12" cy="8" r="4" stroke-width="2"/><path d="M6 20v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke-width="2"/>
                  </svg>
                  <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Request For Tutor</span>
                </button>
                <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm"
                  onclick="window.location.href='#'">
                  <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor">
                    <rect x="6" y="10" width="12" height="8" rx="3" stroke-width="2"/><path d="M9 10v-2a3 3 0 116 0v2" stroke-width="2"/>
                  </svg>
                  <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Earnings Page</span>
                </button>
                <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm"
                  onclick="window.location.href='#'">
                  <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor">
                    <path d="M21 15V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2m7 4h3m-6-4h6" stroke-width="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5" />
                  </svg>
                  <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Blog and Earn</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Top Scorers & Stat Cards -->
          <div class="mb-6 flex flex-col md:flex-row gap-4 w-full">
<div class="bg-white rounded-xl shadow md:w-1/3 w-full p-6 flex flex-col mb-2 md:mb-0">
  <h2 class="text-lg font-bold mb-2 text-indigo-700">Top Scorers</h2>
  <div class="flex flex-col gap-4 w-full" id="topScorersList">
    <!-- Will be filled via JS -->
  </div>
</div>

<div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:w-2/3 w-full">
  <!-- 1. Total Exams Taken -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-total-exams">-</span>
    <div class="font-semibold text-gray-700">Total Exams Taken</div>
  </div>
  <!-- 2. Avg Score -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-avg-score">-</span>
    <div class="font-semibold text-gray-700">Average Score</div>
  </div>
  <!-- 3. Total Available Exams -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-available-exams">-</span>
    <div class="font-semibold text-gray-700">Total Available Exams</div>
  </div>
  <!-- 4. Scholarship/Internship Opportunity -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-scholarship-oppty">-</span>
    <div class="font-semibold text-gray-700">Scholarship/Interns Opportunity</div>
  </div>
  <!-- 5. Total Credit Point -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-credit-points">-</span>
    <div class="font-semibold text-gray-700">Total Credit Points</div>
  </div>
  <!-- 6. Total Score Points (From Tasks) -->
  <div class="bg-white rounded-xl shadow p-6 text-center flex flex-col justify-center">
    <span class="text-3xl font-bold mb-1 text-indigo-800 block" id="stat-task-points">-</span>
    <div class="font-semibold text-gray-700">Total Score Points (Tasks)</div>
  </div>
</div>

<script>
// Example: Plug in values after fetching data
async function updateStatsPanel() {
  // Example API fetch logic -- replace API_URL with your actual endpoint!
  const API_URL = "https://examguide.onrender.com/api/";
  const token = localStorage.getItem("token");
  let student, mockResults = [], totalAvailableExams = 0, totalCreditPoints = 0, totalTaskPoints = 0;
  let scholarshipChance = "-";
  try {
    // Get student
    const resp = await fetch(API_URL + "auth/me", {
      credentials: "include",
      headers: token ? { Authorization: "Bearer " + token } : {}
    });
    const data = await resp.json();
    student = data.user;

    // Get exam results
    let resultsResp = await fetch(API_URL + "results/user/" + student._id, {
      credentials: "include",
      headers: token ? { Authorization: "Bearer " + token } : {}
    });
    mockResults = await resultsResp.json();

    // Only mock/exam tests.
    const filteredResults = (mockResults||[]).filter(r => {
      // Adjust "examSet" and type detection as needed for your backend
      if (!r.examSet) return false;
      const et = typeof r.examSet === "object" ? (r.examSet.type || "").toLowerCase() : "";
      return et === "mock" || et === "mock test" ||
             et === "exam" ||
             (r.examSet.title && r.examSet.title.toLowerCase().match(/mock|exam/));
    });

    document.getElementById("stat-total-exams").textContent = filteredResults.length;

    // Average Score
    let avg = "-";
    if (filteredResults.length) {
      avg = Math.round(filteredResults.reduce((sum, r) => sum + (parseFloat(r.score) || 0), 0) / filteredResults.length);
      avg = avg + "%";
    }
    document.getElementById("stat-avg-score").textContent = avg;

    // Total Available Exams
    let examRes = await fetch(API_URL + "schedules", { credentials: "include", headers: token ? { Authorization: "Bearer " + token } : {} });
    let examData = await examRes.json();
    if (Array.isArray(examData)) totalAvailableExams = examData.length;
    else if (examData.schedules && Array.isArray(examData.schedules)) totalAvailableExams = examData.schedules.length;
    document.getElementById("stat-available-exams").textContent = totalAvailableExams;

    // Scholarship/Internship Opportunity (dummy logic - replace as needed)
    // Example: if avg score >= 70, opportunity is 85%, else 45%, or get from API!
    if (typeof(avg) === "string" && avg !== "-") {
      const avgNum = parseInt(avg);
      scholarshipChance = (avgNum >= 70 ? "85%" : "45%");
    }
    document.getElementById("stat-scholarship-oppty").textContent = scholarshipChance;

    // Total Credit Point: fetch same as tutor/mock.html logic
let totalCreditPoints = "-";
if (student) {
  if (typeof student.creditPoints !== "undefined" && student.creditPoints !== null)
    totalCreditPoints = student.creditPoints;
  else if (typeof student.credits !== "undefined" && student.credits !== null)
    totalCreditPoints = student.credits;
}
document.getElementById("stat-credit-points").textContent = totalCreditPoints;
    // Total Score Points (From Tasks)
    let tasksRes = await fetch(API_URL + "tasks/user/" + student._id, { credentials: "include", headers: token ? { Authorization: "Bearer " + token } : {} });
    let tasksData = await tasksRes.json();
    if (Array.isArray(tasksData)) {
      totalTaskPoints = tasksData.reduce((sum, t) => sum + (t.points||0), 0);
    }
    document.getElementById("stat-task-points").textContent = totalTaskPoints || "-";

  } catch(e) {
    // fallback
    ["stat-total-exams","stat-avg-score","stat-available-exams","stat-scholarship-oppty","stat-credit-points","stat-task-points"].forEach(id=>{
      if(document.getElementById(id))document.getElementById(id).textContent="-";
    });
  }
}
// run after DOM
document.addEventListener("DOMContentLoaded", updateStatsPanel);
</script>
          </div>

<div class="bg-white rounded-lg p-6 shadow flex flex-col items-center w-full">
  <h3 class="text-lg font-bold mb-3 text-indigo-700 w-full text-left">Mock Test Scores</h3>
  <div class="w-full" style="min-height:220px;">
    <canvas id="mockScoreLineChart" height="180"></canvas>
  </div>
  <div class="mt-3 w-full text-sm text-gray-600 flex flex-wrap gap-6">
    <div><span class="font-semibold">Best Mock:</span> <span id="mockBestStat">-</span></div>
    <div><span class="font-semibold">Last Mock:</span> <span id="mockLastStat">-</span></div>
  </div>
</div>

<!-- Modern Chart.js Line Chart for Mock Scores (no animation) -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  (async function() {
    const API_URL = "https://examguide.onrender.com/api/";
    const token = localStorage.getItem("token");
    let student = null;
    try {
      const resp = await fetch(API_URL + "auth/me", {
        credentials: "include",
        headers: token ? { Authorization: "Bearer " + token } : {}
      });
      const data = await resp.json();
      student = data.user;
    } catch (e) {}

    let resultsCache = [];
    if (student && student._id) {
      try {
        const resp = await fetch(API_URL + "results/user/" + student._id, {
          credentials: "include",
          headers: token ? { Authorization: "Bearer " + token } : {}
        });
        resultsCache = await resp.json();
      } catch (e) {}
    }

    // Only mock tests.
    const mockResults = (resultsCache||[]).filter(r => {
      if (!r.examSet) return false;
      const et = typeof r.examSet === "object" ? (r.examSet.type || "").toLowerCase() : "";
      return et === "mock" || et === "mock test" || (r.examSet.title && r.examSet.title.toLowerCase().includes("mock"));
    });
    const sorted = [...mockResults].sort((a, b) => new Date(a.submittedAt) - new Date(b.submittedAt));

    function shortLabel(res, idx) {
      if (!res.examSet) return "Mock " + (idx+1);
      let str = res.examSet.title || "";
      const word = str.split(' ').find(w => w.length > 0) || ("Mock " + (idx+1));
      return word.length > 16 ? word.slice(0,16) + "..." : word;
    }

    const labels = sorted.map((r, i) => 
      (r.submittedAt ? (shortLabel(r, i) + " (" + (new Date(r.submittedAt).toLocaleDateString('en-GB', {month:"short", day:"numeric"})) + ")")
                     : shortLabel(r, i))
    );
    const scores = sorted.map(r => r.score ?? 0);
    let best = {score:"-", examSet:{title:"-"}}, last = {score:"-", examSet:{title:"-"}};
    if (sorted.length) {
      best = sorted.reduce((acc, curr) => (curr.score > (acc.score??-1) ? curr : acc), sorted[0]);
      last = sorted[sorted.length-1];
    }
    function firstWord(str) {
      if (!str) return "-";
      const match = str.match(/^\w+/);
      return match ? match[0] : str;
    }
    if (document.getElementById("mockBestStat"))
      document.getElementById("mockBestStat").textContent = `${best.score ?? "-"}% (${firstWord(best.examSet?.title)})`;
    if (document.getElementById("mockLastStat"))
      document.getElementById("mockLastStat").textContent = `${last.score ?? "-"}% (${firstWord(last.examSet?.title)})`;

    // Draw line chart with animation disabled
    const chartElem = document.getElementById("mockScoreLineChart");
    if (window.Chart && chartElem) {
      const ctx = chartElem.getContext("2d");
      if (window.mockScoreLineChart && typeof window.mockScoreLineChart.destroy === "function") {
        window.mockScoreLineChart.destroy();
      }
      window.mockScoreLineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels.length ? labels : ['No Data'],
          datasets: [{
            label: 'Score (%)',
            data: scores.length ? scores : [0],
            fill: false,
            borderColor: '#6366f1',
            backgroundColor: '#6366f1',
            tension: 0.28,
            pointRadius: 5,
            pointBackgroundColor: '#3b82f6',
            pointBorderColor: '#fff',
            pointHoverRadius: 7,
            pointHoverBackgroundColor: '#f59e42',
            pointHoverBorderColor: '#6366f1',
            borderWidth: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {display: false},
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return `Score: ${context.parsed.y}%`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              title: { display: true, text: "Percentage (%)" },
              ticks: { font: { weight: 'bold' } }
            },
            x: {
              title: { display: true, text: "Test" },
              grid: {display:false}
            }
          },
          animation: false // << disables the extending animation effect
        }
      });
    }
  })();
});
</script>
   
     <div class="flex flex-col md:flex-row gap-6 w-full">
  <!-- GPA Progress -->    
  <div class="bg-white rounded-lg p-6 shadow pt-10 mt-4 md:mt-0 max-w-xl w-full">
    <h3 class="text-lg font-bold mb-3 text-indigo-700">GPA Progress</h3>
    <canvas id="gpaChart" height="120"></canvas>
  </div>

  <!-- Sliding News -->
  <div class="bg-white rounded-lg p-6 shadow mt-4 md:mt-0 max-w-md w-full flex flex-col justify-between relative overflow-hidden">
    <h3 class="text-lg font-bold mb-3 text-indigo-700">Latest News</h3>
    <div class="relative w-full h-64 flex items-center justify-center">
      <div id="news-carousel" class="w-full h-full flex transition-all duration-500">
        <!-- News slides injected here by JS -->
      </div>
      <!-- Arrows -->
      <button id="news-prev" class="absolute left-1 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-indigo-100 shadow rounded-full p-2 z-10">
        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor"><path d="M15 19l-7-7 7-7"/></svg>
      </button>
      <button id="news-next" class="absolute right-1 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-indigo-100 shadow rounded-full p-2 z-10">
        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor"><path d="M9 5l7 7-7 7"/></svg>
      </button>
    </div>
    <!-- Indicators -->
    <div id="news-indicators" class="w-full flex justify-center gap-2 mt-4"></div>
  </div>
</div>

<script>
// Example news data - replace with your data/API if needed
const newsItems = [
  {
    image: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=500&q=80",
    title: "OAU Announces New ICT Hub Partnership",
    description: "The university partners with global ICT leaders to improve campus digital infrastructure and opportunities for students.",
    url: "#"
  },
  {
    image: "https://images.unsplash.com/photo-1521737852567-6949f3f9f2b5?auto=format&fit=crop&w=500&q=80",
    title: "Scholarship Applications Now Open",
    description: "Applications for 2026 OAU merit scholarships are now open. Apply before March 15. See requirements and how to apply.",
    url: "#"
  },
  {
    image: "https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=500&q=80",
    title: "Upcoming Mock Exams Schedule Released",
    description: "Check the mock test portal for new session schedules, tips on preparation, and eligibility information.",
    url: "#"
  }
];

let currentNews = 0;

function renderNewsSlide(idx) {
  const news = newsItems[idx];
  return `
    <div class="w-full h-full flex flex-col items-center animate-fadeIn">
      <div class="w-full h-40 rounded-lg overflow-hidden mb-2 flex-shrink-0">
        <img src="${news.image}" alt="${news.title}" class="w-full h-full object-cover object-center transition-all duration-300"/>
      </div>
      <h4 class="text-md font-bold text-indigo-700 mb-1 mt-2">${news.title}</h4>
      <p class="text-gray-600 text-sm line-clamp-2">${news.description}</p>
      <a href="${news.url}" class="mt-4 inline-block bg-indigo-50 text-indigo-700 font-semibold px-4 py-2 rounded hover:bg-indigo-700 hover:text-white transition">Read More</a>
    </div>
  `;
}

// Animate fade-in utility
const style = document.createElement('style');
style.innerHTML = `
@keyframes fadeIn {
  0% {opacity:0; transform: translateY(8px);}
  100% {opacity:1; transform: translateY(0);}
}
.animate-fadeIn { animation: fadeIn .6s; }
.line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
`;
document.head.appendChild(style);

function updateNewsCarousel() {
  const carousel = document.getElementById("news-carousel");
  if (!carousel) return;
  carousel.innerHTML = renderNewsSlide(currentNews);

  // Indicators
  const indicators = document.getElementById("news-indicators");
  indicators.innerHTML = "";
  for (let i = 0; i < newsItems.length; i++) {
    indicators.innerHTML += `<span class="inline-block w-2 h-2 rounded-full mx-1 ${i===currentNews?'bg-indigo-600':'bg-gray-300'}"></span>`;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  updateNewsCarousel();
  document.getElementById("news-prev").onclick = () => {
    currentNews = (currentNews - 1 + newsItems.length) % newsItems.length;
    updateNewsCarousel();
  };
  document.getElementById("news-next").onclick = () => {
    currentNews = (currentNews + 1) % newsItems.length;
    updateNewsCarousel();
  };
});
</script>
      
<!-- Tasks Center Section (with Pagination) -->
<div id="taskscenter-section" class="section-block hidden">
  <div class="max-w-6xl mx-auto py-10 px-2 md:px-6">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-bold text-indigo-800">Tasks Center</h2>
        <p class="text-md text-gray-600 mt-1">Complete daily and weekly activities to boost your engagement, earn rewards, and develop your skills.</p>
      </div>
      <div class="flex gap-4">
        <button class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition" onclick="refreshTasks()">
          <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M4 4v5h.582M20 20v-5h-.581M7 10l-2 2 2 2M17 14l2-2-2-2" stroke-width="2"></path></svg>
          Refresh Tasks
        </button>
      </div>
    </div>

    <!-- Progress Overview -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-10" id="task-stats-row">
      <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl shadow-lg flex flex-col items-center p-6">
        <div class="text-3xl font-bold mb-1" id="activeTasksCount">-</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Tasks Active</div>
      </div>
      <div class="bg-gradient-to-r from-green-400 to-teal-500 text-white rounded-2xl shadow-lg flex flex-col items-center p-6">
        <div class="text-3xl font-bold mb-1" id="completedTasksCount">-</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Completed</div>
      </div>
      <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-2xl shadow-lg flex flex-col items-center p-6">
        <div class="text-3xl font-bold mb-1" id="overdueTasksCount">-</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Overdue</div>
      </div>
      <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-2xl shadow-lg flex flex-col items-center p-6">
        <div class="text-3xl font-bold mb-1" id="pointsCount">-</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Points</div>
      </div>
    </div>

    <!-- Tasks List: horizontally scrollable -->
    <div class="bg-white rounded-2xl shadow-lg overflow-x-auto">
      <table class="min-w-full text-sm divide-y divide-gray-200" id="tasksTable">
        <thead class="bg-indigo-50 font-bold text-indigo-800">
          <tr>
            <th class="px-6 py-3 text-left whitespace-nowrap">Task</th>
            <th class="px-6 py-3 text-left whitespace-nowrap">Description</th>
            <th class="px-6 py-3 text-left whitespace-nowrap">Activity Type</th>
            <th class="px-6 py-3 text-left whitespace-nowrap">Points</th>
            <th class="px-6 py-3 text-left whitespace-nowrap">Status</th>
            <th class="px-6 py-3 text-left whitespace-nowrap">Action</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100" id="tasksTableBody">
          <!-- Populated dynamically -->
        </tbody>
      </table>
    </div>

    <!-- Pagination controls -->
    <div class="flex items-center justify-end gap-3 mt-4" id="tasksPaginationControls">
      <button id="tasksPrevBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Previous</button>
      <span id="tasksPageInfo" class="text-gray-700">Page 1</span>
      <button id="tasksNextBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Next</button>
    </div>
  </div>

  <!-- Article Modal (With Description + Loader) -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden" id="articleModal">
    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative flex flex-col gap-6">
      <button class="absolute top-3 right-4 text-gray-500 hover:text-indigo-700 text-xl" onclick="closeArticleModal()">&times;</button>
      <div id="articleModalContent" class="overflow-auto" style="max-height:60vh;">
        <iframe id="articleFrame" src="" width="100%" height="400" frameborder="0" class="rounded mb-5"></iframe>
        <div id="articleDescription" class="text-gray-700 text-sm mt-2"></div>
      </div>
      <button id="articleMarkAsDoneBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-5 py-2 rounded-lg self-end transition flex gap-2 items-center" data-taskid="">
        <span>Mark as Done</span>
        <svg id="articleMarkAsDoneLoader" class="hidden animate-spin w-5 h-5" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12A8 8 0 018 4v4a4 4 0 00-4 4z"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- YouTube Video Modal (With Description + Loader) -->
  <div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center hidden" id="videoModal">
    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative flex flex-col gap-6">
      <button class="absolute top-3 right-4 text-gray-500 hover:text-indigo-700 text-xl" onclick="closeVideoModal()">&times;</button>
      <div id="videoModalContent" class="overflow-auto" style="max-height:60vh;">
        <iframe id="videoFrame" width="100%" height="360" src="" frameborder="0" allowfullscreen class="rounded mb-5"></iframe>
        <div id="videoDescription" class="text-gray-700 text-sm mt-2"></div>
      </div>
      <button id="videoMarkAsDoneBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-5 py-2 rounded-lg self-end transition flex gap-2 items-center" data-taskid="">
        <span>Mark as Done</span>
        <svg id="videoMarkAsDoneLoader" class="hidden animate-spin w-5 h-5" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12A8 8 0 018 4v4a4 4 0 00-4 4z"></path>
        </svg>
      </button>
    </div>
  </div>

  <script>
    // --- Pagination Globals ---
    let tasksCurrentPage = 1;
    const tasksPerPage = 6;
    let tasksTotalPages = 1;

    // For 1 minute disabling mechanic
    const modalDisabledUntil = {};

    function esc(str) { return String(str || "").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }

    function activityTypePill(type, meta) {
      switch ((type||"").toLowerCase()) {
        case "reading": return `<span class="bg-green-100 text-green-700 rounded-full px-3 py-1 font-semibold text-xs">Reading</span>
          ${meta?.duration ? `<div class="text-xs text-gray-500 mt-1">${esc(meta.duration)}</div>` : ""}`;
        case "video": return `<span class="bg-pink-100 text-pink-700 rounded-full px-3 py-1 font-semibold text-xs">Video</span>
          ${meta?.duration ? `<div class="text-xs text-gray-500 mt-1">${esc(meta.duration)}</div>` : ""}`;
        case "social": return `<span class="bg-blue-100 text-blue-700 rounded-full px-3 py-1 font-semibold text-xs">Social</span>
          ${meta?.platform ? `<div class="text-xs text-gray-500 mt-1">${esc(meta.platform)}</div>` : ""}`;
        case "mocktest": return `<span class="bg-indigo-100 text-indigo-600 rounded-full px-3 py-1 font-semibold text-xs">Mock Test</span>
          ${meta?.status ? `<div class="text-xs text-gray-500 mt-1">${esc(meta.status)}</div>` : ""}`;
        case "profile": return `<span class="bg-purple-100 text-purple-700 rounded-full px-3 py-1 font-semibold text-xs">Profile</span>
          <div class="text-xs text-gray-500 mt-1">One time</div>`;
        default:
          return `<span class="bg-gray-200 text-gray-700 rounded-full px-3 py-1 font-semibold text-xs">${esc(type)}</span>`;
      }
    }

    function statusPill(status) {
      switch ((status||"").toLowerCase()) {
        case "active": return `<span class="bg-yellow-100 text-yellow-800 font-semibold px-3 py-1 rounded-full text-xs">Active</span>`;
        case "overdue": return `<span class="bg-red-100 text-red-700 font-semibold px-3 py-1 rounded-full text-xs">Overdue</span>`;
        case "done": case "completed": return `<span class="bg-green-100 text-green-700 font-semibold px-3 py-1 rounded-full text-xs">Done</span>`;
        default: return `<span class="bg-gray-100 text-gray-700 font-semibold px-3 py-1 rounded-full text-xs">${esc(status)}</span>`;
      }
    }

    // Table action quick launch, NO 'Mark as Done' here
    function actionCell(task) {
      if (["done", "completed"].includes((task.status||"").toLowerCase())) {
        return `<span class="text-gray-400 text-xs">Completed</span>`;
      }
      // Reading
      if ((task.activityType === "reading" || task.activityType === "article") && task.meta?.url) {
        return `<button onclick="openArticleModal('${esc(task.meta.url)}','${task._id}')" class="bg-blue-600 hover:bg-blue-700 text-white rounded px-4 py-1 font-semibold text-xs shadow flex gap-2 items-center">
          <span>Read</span>
          <svg class="inline w-4 h-4 ml-1" fill="none" stroke="currentColor"><path d="M4 4v16h16V4H4Zm8 0v16" stroke-width="1.5"/></svg>
        </button>`;
      }
      // Video
      if (task.activityType === "video" && task.meta?.url) {
        return `<button onclick="openVideoModal('${esc(task.meta.url)}','${task._id}')" class="bg-blue-600 hover:bg-blue-700 text-white rounded px-4 py-1 font-semibold text-xs shadow flex gap-2 items-center">
          <span>Watch</span>
          <svg class="inline w-4 h-4 ml-1" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="2"/><path d="M10 8l6 4-6 4V8z" stroke-width="1.5"/></svg>
        </button>`;
      }
      // Social
      if (task.activityType === "social" && task.meta?.url) {
        return `<a href="${esc(task.meta.url)}" target="_blank" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-1 rounded font-semibold text-xs shadow flex gap-2 items-center">
          <span>Open</span>
          <svg class="inline w-4 h-4 ml-1" fill="none" stroke="currentColor"><path d="M5 12h14M12 5l7 7-7 7" stroke-width="1.5"/></svg>
        </a>`;
      }
      // Mock Test
      if (task.activityType === "mocktest" && task.meta?.url) {
        return `<button onclick="window.location.href='${esc(task.meta.url)}'" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded px-4 py-1 font-semibold text-xs shadow flex gap-2 items-center">
          <span>Start Test</span>
          <svg class="inline w-4 h-4 ml-1" fill="none" stroke="currentColor"><path d="M12 4a8 8 0 010 16 8 8 0 010-16z" stroke-width="1.5"/></svg>
        </button>`;
      }
      return `<span class="text-gray-400 text-xs">No Action</span>`;
    }

    // Pagination-aware task loader
    async function loadTasks(page = 1) {
      const API_URL = "https://examguide.onrender.com/api/";
      let token = localStorage.getItem("token");
      let student = null;
      try {
        const resp = await fetch(API_URL + "auth/me", {
          credentials: "include",
          headers: token ? { Authorization: "Bearer " + token } : {}
        });
        const data = await resp.json();
        student = data.user;
      } catch (e) {}
      let tasks = [];
      if (student && student._id) {
        try {
          const resp = await fetch(`${API_URL}tasks/user/${student._id}`, {
            credentials: "include",
            headers: token ? { Authorization: "Bearer " + token } : {}
          });
          tasks = await resp.json();
        } catch (e) {}
      }
      if (!Array.isArray(tasks) || !tasks.length) {
        // Fallback demo tasks, all with descriptions
        tasks = [
          {
            _id: "demo1",
            title: `Read: "5 Quick Ways to Beat Procrastination"`,
            activityType: "reading",
            points: 15,
            status: "active",
            description: "Boost your productivity with these simple strategies for overcoming procrastination.",
            meta: { duration: "10 min", url: "https://medium.com/the-mission/5-quick-ways-to-beat-procrastination-626edf2e5a9" }
          },
          {
            _id: "demo2",
            title: `Watch: Study Motivation â€” How to Stay Focused`,
            activityType: "video",
            points: 10,
            status: "active",
            description: "Motivational tips and tricks to help you keep your mind on your studies.",
            meta: { duration: "7 min", url: "https://www.youtube.com/embed/Oe421EPjeBE" }
          },
          {
            _id: "demo3",
            title: `Like ExamGuard Facebook Page`,
            activityType: "social",
            points: 8,
            status: "active",
            description: "Support ExamGuard by liking our Facebook page.",
            meta: { url: "https://facebook.com/examguardpage", platform: "Facebook" }
          },
          {
            _id: "demo4",
            title: `Participate in "Math Practice Test"`,
            activityType: "mocktest",
            points: 20,
            status: "active",
            description: "Apply your Math knowledge in a quick mock test session.",
            meta: { url: "#mocktest", status: "Available" }
          },
          {
            _id: "demo5",
            title: "Complete your profile information",
            activityType: "profile",
            points: 5,
            status: "done",
            description: "Help us know you better by completing your entire profile."
          },
          {
            _id: "demo6",
            title: "Read: Study Techniques for Finals",
            activityType: "reading",
            points: 12,
            status: "active",
            description: "Essential reading before finals week.",
            meta: { duration: "15 min", url: "https://example.com/finals-study" }
          },
          {
            _id: "demo7",
            title: "Watch: Time Management for Students",
            activityType: "video",
            points: 9,
            status: "active",
            description: "Practical advice for balancing study and life.",
            meta: { duration: "8 min", url: "https://www.youtube.com/embed/time-management" }
          }
        ];
      }
      window.tasksList = tasks;

      // ---- Pagination logic ----
      tasksTotalPages = Math.ceil(tasks.length / tasksPerPage) || 1;
      if (page < 1) page = 1;
      if (page > tasksTotalPages) page = tasksTotalPages;
      tasksCurrentPage = page;
      const startIdx = (page - 1) * tasksPerPage;
      const pageTasks = tasks.slice(startIdx, startIdx + tasksPerPage);

      const tbody = document.getElementById("tasksTableBody");
      tbody.innerHTML = pageTasks.map(task =>
        `<tr>
          <td class="px-6 py-4 font-semibold text-blue-900 whitespace-nowrap">${esc(task.title)}</td>
          <td class="px-6 py-4 text-gray-700">${esc(task.description || "")}</td>
          <td class="px-6 py-4 whitespace-nowrap">${activityTypePill(task.activityType, task.meta)}</td>
          <td class="px-6 py-4 text-center font-bold text-indigo-600 whitespace-nowrap">${esc(task.points) ?? 0}</td>
          <td class="px-6 py-4 whitespace-nowrap">${statusPill(task.status)}</td>
          <td class="px-6 py-4 whitespace-nowrap">${actionCell(task)}</td>
        </tr>`).join("");

      // Progress overview
      const active = tasks.filter(t => (t.status||"").toLowerCase() === "active").length;
      const done = tasks.filter(t => ["done","completed"].includes((t.status||"").toLowerCase())).length;
      const overdue = tasks.filter(t => (t.status||"").toLowerCase() === "overdue").length;
      const points = tasks.reduce((sum, t) => sum + (t.points||0), 0);
      document.getElementById("activeTasksCount").textContent = active;
      document.getElementById("completedTasksCount").textContent = done;
      document.getElementById("overdueTasksCount").textContent = overdue;
      document.getElementById("pointsCount").textContent = points;

      // Pagination controls update
      document.getElementById("tasksPageInfo").textContent = `Page ${tasksCurrentPage} of ${tasksTotalPages}`;
      document.getElementById("tasksPrevBtn").disabled = (tasksCurrentPage === 1);
      document.getElementById("tasksNextBtn").disabled = (tasksCurrentPage === tasksTotalPages);
    }

    function refreshTasks() { loadTasks(1); }

    // --- Modal and "Mark as Done" controls (existing code) here ---
    function getModalBtnAndLoader(modalType) {
      if (modalType === "article") {
        return {
          btn: document.getElementById("articleMarkAsDoneBtn"),
          loader: document.getElementById("articleMarkAsDoneLoader"),
          span: document.getElementById("articleMarkAsDoneBtn").querySelector("span")
        };
      } else if (modalType === "video") {
        return {
          btn: document.getElementById("videoMarkAsDoneBtn"),
          loader: document.getElementById("videoMarkAsDoneLoader"),
          span: document.getElementById("videoMarkAsDoneBtn").querySelector("span")
        };
      }
      return {};
    }

    async function markTaskDone(taskId, modalType) {
      const { btn, loader, span } = getModalBtnAndLoader(modalType);
      if (!btn || btn.disabled) return; // Skip if currently disabled (locked)
      btn.disabled = true;
      loader.classList.remove("hidden");
      span.textContent = "Marking...";

      const disableKey = modalType + "_" + String(taskId);
      modalDisabledUntil[disableKey] = Date.now() + 60000;

      const token = localStorage.getItem("token");
      try {
        const res = await fetch(`https://examguide.onrender.com/api/tasks/${taskId}`, {
          method: "PATCH",
          headers: { 
            "Content-Type": "application/json",
            ...(token ? {Authorization: "Bearer "+token} : {})
          },
          body: JSON.stringify({ status: "done" })
        });
        if (!res.ok) throw new Error("Could not mark as done");
        closeArticleModal();
        closeVideoModal();
        await loadTasks(tasksCurrentPage);
      } catch (e) {
        alert("Failed to mark as done. Please retry.");
      }

      loader.classList.add("hidden");
      span.textContent = "Disabled for 1 min...";
      btn.disabled = true;
      setTimeout(() => {
        if (modalDisabledUntil[disableKey] <= Date.now()) {
          btn.disabled = false;
          span.textContent = "Mark as Done";
        }
      }, 60000);
    }

    function openArticleModal(url, taskId) {
      const task = window.tasksList?.find(t => t._id === taskId) || {};
      document.getElementById('articleFrame').src = url;
      document.getElementById('articleModal').classList.remove('hidden');
      const btn = document.getElementById('articleMarkAsDoneBtn');
      btn.setAttribute('data-taskid', taskId);
      document.getElementById('articleDescription').textContent = task.description || "";

      // 1min lock check
      const disableKey = "article_" + String(taskId);
      const now = Date.now(), until = modalDisabledUntil[disableKey]||0;
      const loader = document.getElementById('articleMarkAsDoneLoader');
      const span = btn.querySelector("span");
      if (until > now) {
        btn.disabled = true;
        loader.classList.add("hidden");
        span.textContent = "Disabled for 1 min...";
        setTimeout(() => {
          if (modalDisabledUntil[disableKey] <= Date.now()) {
            btn.disabled = false;
            span.textContent = "Mark as Done";
          }
        }, until-now);
      } else {
        btn.disabled = false;
        loader.classList.add("hidden");
        span.textContent = "Mark as Done";
      }
    }
    function closeArticleModal() {
      document.getElementById('articleModal').classList.add('hidden');
      document.getElementById('articleFrame').src = '';
      document.getElementById('articleMarkAsDoneBtn').setAttribute('data-taskid', '');
      document.getElementById('articleDescription').textContent = "";
    }
    function openVideoModal(youtubeUrl, taskId) {
      const task = window.tasksList?.find(t => t._id === taskId) || {};
      document.getElementById('videoFrame').src = youtubeUrl + '?autoplay=1';
      document.getElementById('videoModal').classList.remove('hidden');
      const btn = document.getElementById('videoMarkAsDoneBtn');
      btn.setAttribute('data-taskid', taskId);
      document.getElementById('videoDescription').textContent = task.description || "";

      // Disable if locked (1 min interval)
      const disableKey = "video_" + String(taskId);
      const now = Date.now(), until = modalDisabledUntil[disableKey]||0;
      const loader = document.getElementById('videoMarkAsDoneLoader');
      const span = btn.querySelector("span");
      if (until > now) {
        btn.disabled = true;
        loader.classList.add("hidden");
        span.textContent = "Disabled for 1 min...";
        setTimeout(() => {
          if (modalDisabledUntil[disableKey] <= Date.now()) {
            btn.disabled = false;
            span.textContent = "Mark as Done";
          }
        }, until-now);
      } else {
        btn.disabled = false;
        loader.classList.add("hidden");
        span.textContent = "Mark as Done";
      }
    }
    function closeVideoModal() {
      document.getElementById('videoModal').classList.add('hidden');
      document.getElementById('videoFrame').src = '';
      document.getElementById('videoMarkAsDoneBtn').setAttribute('data-taskid', '');
      document.getElementById('videoDescription').textContent = "";
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('articleMarkAsDoneBtn').onclick = function() {
        const taskId = this.getAttribute('data-taskid');
        if (taskId && !this.disabled) markTaskDone(taskId, "article");
      };
      document.getElementById('videoMarkAsDoneBtn').onclick = function() {
        const taskId = this.getAttribute('data-taskid');
        if (taskId && !this.disabled) markTaskDone(taskId, "video");
      };

      // Pagination controls handlers
      document.getElementById("tasksPrevBtn").onclick = function() {
        if (tasksCurrentPage > 1) loadTasks(tasksCurrentPage - 1);
      };
      document.getElementById("tasksNextBtn").onclick = function() {
        if (tasksCurrentPage < tasksTotalPages) loadTasks(tasksCurrentPage + 1);
      };

      loadTasks(1);
    });
  </script>
</div>

  <!-- Profile Section -->
<div id="profile-section" class="section-block hidden">
  <div class="max-w-4xl mx-auto py-10 px-2 md:px-8">
    <!-- Profile header/overview -->
    <div class="bg-white rounded-xl shadow-lg flex flex-col items-center md:flex-row md:items-start gap-8 p-8 mb-10">
      <div class="flex flex-col items-center md:items-start gap-5">
        <img class="w-32 h-32 rounded-full border-4 border-indigo-400 shadow-md object-cover" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile avatar">
        <button class="bg-indigo-600 text-white px-4 py-1 rounded font-semibold text-sm shadow hover:bg-indigo-700 transition">Change Photo</button>
      </div>
      <div class="flex-1 flex flex-col gap-3 w-full">
        <h2 class="text-3xl font-bold text-indigo-800 mb-1">Alex Student</h2>
        <div class="text-md text-gray-600">Student, OAU ExamGuard</div>
        <div class="flex gap-3 flex-wrap mt-2">
          <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-md text-xs font-semibold">Year 3</span>
          <span class="bg-green-100 text-green-700 px-3 py-1 rounded-md text-xs font-semibold">GPA: 3.8</span>
          <span class="bg-pink-100 text-pink-700 px-3 py-1 rounded-md text-xs font-semibold">Account Type: Student</span>
        </div>
        <div class="flex flex-wrap gap-2 mt-3">
          <a href="mailto:alex.student@example.com" class="text-blue-600 text-sm underline">alex.student@example.com</a>
          <a href="#" class="text-gray-600 text-sm underline">Change Password</a>
        </div>
        <div class="mt-5 flex gap-3">
          <button class="bg-blue-700 text-white px-5 py-2 rounded font-semibold text-sm hover:bg-blue-800 transition shadow">Edit Profile</button>
          <button class="bg-gray-100 text-gray-800 px-5 py-2 rounded font-semibold text-sm border hover:bg-gray-200 transition shadow">Download Resume</button>
        </div>
      </div>
    </div>

    <!-- Profile Details & Edit form -->
    <div class="bg-white rounded-xl shadow p-8 flex flex-col gap-8 mb-10">
      <h3 class="text-xl font-bold text-indigo-700 mb-4">Personal Information</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium mb-1">Full Name</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="Alex Student" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Email Address</label>
          <input type="email" class="w-full border rounded-lg p-2 text-sm" value="alex.student@example.com" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Country</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="Nigeria" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Town/City</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="Ile-Ife" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Institution</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="Obafemi Awolowo University" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Department</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="Computer Science" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Phone Number</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="+2348012345678" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Gender</label>
          <select class="w-full border rounded-lg p-2 text-sm">
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Short Bio</label>
        <textarea class="w-full border rounded-lg p-2 text-sm min-h-[40px]" placeholder="Write a brief biography about yourself...">Hi, I'm Alex, a passionate learner and aspiring software engineer.</textarea>
      </div>
      <div class="mt-5 flex gap-3 justify-end">
        <button class="bg-blue-700 text-white px-6 py-2 rounded font-semibold text-sm hover:bg-blue-800 transition shadow">Save Changes</button>
        <button class="bg-gray-100 text-gray-800 px-6 py-2 rounded font-semibold text-sm border hover:bg-gray-200 transition shadow">Cancel</button>
      </div>
    </div>

    <!-- Social Media & External Links -->
    <div class="bg-white rounded-xl shadow p-8 flex flex-col gap-8 mb-8">
      <h3 class="text-xl font-bold text-indigo-700 mb-4">Social & External Links</h3>
      <div class="grid md:grid-cols-3 gap-5">
        <div>
          <label class="block text-sm font-medium mb-1">Facebook</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter Facebook link" value="https://facebook.com/alex.student" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Twitter</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="https://twitter.com/alex_student" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Instagram</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="https://instagram.com/alex.student" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Github</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="https://github.com/alexstudent" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">LinkedIn</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="https://linkedin.com/in/alexstudent" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Other Link</label>
          <input type="text" class="w-full border rounded-lg p-2 text-sm" value="" />
        </div>
      </div>
      <div class="mt-5 flex gap-3 justify-end">
        <button class="bg-blue-700 text-white px-6 py-2 rounded font-semibold text-sm hover:bg-blue-800 transition shadow">Save Social Links</button>
      </div>
    </div>

    <!-- Achievements & Badges -->
    <div class="bg-white rounded-xl shadow p-8 flex flex-col gap-4 mb-8">
      <h3 class="text-xl font-bold text-indigo-700 mb-1">Achievements & Badges</h3>
      <div class="flex gap-5 flex-wrap mt-1">
        <div class="bg-gradient-to-br from-yellow-400 via-indigo-500 to-blue-600 rounded-lg px-5 py-2 flex items-center gap-3 shadow">
          <svg class="w-7 h-7 text-yellow-100" fill="currentColor">
            <polygon points="24,0 32,16 24,32 0,32 8,16 0,0" />
          </svg>
          <span class="font-semibold text-white text-sm">Top Scorer (Mock Test)</span>
        </div>
        <div class="bg-gradient-to-r from-green-400 to-blue-400 rounded-lg px-5 py-2 flex items-center gap-3 shadow">
          <svg class="w-7 h-7 text-white" fill="currentColor">
            <circle cx="12" cy="12" r="10"/>
          </svg>
          <span class="font-semibold text-white text-sm">All Assignments Completed</span>
        </div>
        <div class="bg-gradient-to-r from-pink-500 to-purple-400 rounded-lg px-5 py-2 flex items-center gap-3 shadow">
          <svg class="w-7 h-7 text-white" fill="currentColor">
            <rect x="4" y="4" width="16" height="16" rx="7"/>
          </svg>
          <span class="font-semibold text-white text-sm">Social Media Star</span>
        </div>
        <!-- Add more badges dynamically -->
      </div>
    </div>

    <!-- Quick Motivation & Completion Status -->
    <div class="bg-gradient-to-r from-indigo-500 to-blue-500 text-white rounded-xl px-6 py-4 flex items-center justify-between shadow">
      <div>
        <h3 class="text-lg font-bold mb-1">Stay Focused!</h3>
        <p class="text-sm">Your consistency is key. Review your progress and aim for the next badge!</p>
      </div>
      <div>
        <span class="bg-white/30 px-4 py-1 rounded text-white font-semibold">Profile: 94% Complete</span>
      </div>
    </div>
  </div>
</div>
  <!-- Broadcasts Section -->
<div id="broadcasts-section" class="section-block hidden">
  <div class="max-w-5xl mx-auto py-10 px-2 md:px-8">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-7">
      <div>
        <h2 class="text-3xl font-bold text-indigo-800">Broadcasts & Announcements</h2>
        <p class="text-md text-gray-600 mt-1">Stay up to date with important alerts, updates, and general information.</p>
      </div>
      <div class="flex gap-4">
        <button class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition"
                onclick="document.getElementById('createBroadcastModal').classList.remove('hidden')">
          <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 4v16m8-8H4" stroke-width="2"></path></svg>
          New Broadcast
        </button>
      </div>
    </div>

    <!-- Broadcasts Feed -->
    <div class="flex flex-col gap-6">
      <!-- Broadcast Card Example -->
      <div class="bg-white rounded-xl shadow p-6 flex flex-col md:flex-row gap-6 items-center border-l-4 border-indigo-600">
        <div class="flex-1">
          <h3 class="font-bold text-lg text-indigo-900 flex items-center gap-2">
            <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor"><path d="M15 17h5l-1.405-1.405M18 14.158V11a6 6 0 10-12 0v3.159" stroke-width="1.5"></path></svg>
            System Maintenance Scheduled
          </h3>
          <div class="text-sm text-gray-600 mt-1">
            <span>There will be a brief downtime on Jan 5th, 2026 from 2:00am to 3:00am. Please save your work in advance.</span>
          </div>
        </div>
        <div class="flex flex-col items-end md:w-36">
          <span class="text-xs text-gray-400">Jan 2, 2026 â€¢ Admin</span>
          <button class="mt-2 bg-indigo-50 text-indigo-700 font-semibold rounded px-4 py-1 text-xs hover:bg-indigo-100">Mark as read</button>
        </div>
      </div>
      <!-- Broadcast Card Example 2 -->
      <div class="bg-white rounded-xl shadow p-6 flex flex-col md:flex-row gap-6 items-center border-l-4 border-green-500">
        <div class="flex-1">
          <h3 class="font-bold text-lg text-green-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="2"/><path d="M10 12l2 2 4-4" stroke-width="2"/></svg>
            New Mock Exams Available!
          </h3>
          <div class="text-sm text-gray-600 mt-1">
            <span>Donâ€™t miss our January set of mock exams now open for registration. Visit the Mock Tests section to participate.</span>
          </div>
        </div>
        <div class="flex flex-col items-end md:w-36">
          <span class="text-xs text-gray-400">Jan 1, 2026 â€¢ System</span>
          <button class="mt-2 bg-green-50 text-green-700 font-semibold rounded px-4 py-1 text-xs hover:bg-green-100">Mark as read</button>
        </div>
      </div>
      <!-- ...add more broadcast cards as needed -->
    </div>

  

    <!-- Create Broadcast Modal -->
    <div class="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center hidden" id="createBroadcastModal">
      <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-8 flex flex-col gap-6 relative">
        <button class="absolute top-4 right-5 text-gray-400 hover:text-indigo-600 text-2xl"
                onclick="document.getElementById('createBroadcastModal').classList.add('hidden')">&times;</button>
        <h3 class="font-bold text-2xl mb-2 text-indigo-900">New Broadcast</h3>
        <form class="flex flex-col gap-4">
          <div>
            <label class="font-medium mb-1 block">Title*</label>
            <input type="text" class="border rounded-lg p-2 w-full" placeholder="Enter broadcast title" required>
          </div>
          <div>
            <label class="font-medium mb-1 block">Message*</label>
            <textarea class="border rounded-lg p-2 w-full min-h-[60px]" placeholder="Type the announcement or alert details..." required></textarea>
          </div>
          <div>
            <label class="font-medium mb-1 block">Broadcast Color</label>
            <select class="border rounded-lg p-2 w-full">
              <option value="system">System (Blue)</option>
              <option value="success">Success (Green)</option>
              <option value="warning">Warning (Yellow)</option>
              <option value="info">Info (Gray)</option>
            </select>
          </div>
          <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded px-6 py-2 shadow mt-1">Send Broadcast</button>
        </form>
      </div>
    </div>
  </div>
</div>
        <!-- My StudyPadi Section -->
<div id="studyPadi-section" class="section-block hidden">
  <div class="max-w-6xl mx-auto py-10 px-2 md:px-6">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-7">
      <div>
        <h2 class="text-3xl font-bold text-indigo-800">My StudyPadi</h2>
        <p class="text-md text-gray-600 mt-1">Your personal study companion. Customize your goals, schedule sessions, and track your learning journey.</p>
      </div>
      <div class="flex gap-4">
        <button class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition"
          onclick="document.getElementById('addPadiModal').classList.remove('hidden')">
          <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 4v16m8-8H4" stroke-width="2"></path></svg>
          Add Study Goal
        </button>
      </div>
    </div>

    <!-- Study Sessions & Goals List -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
      <!-- Upcoming Study Session Card -->
      <div class="bg-white rounded-xl shadow p-6 flex flex-col gap-3">
        <div class="flex items-center gap-3">
          <span class="bg-indigo-100 text-indigo-700 font-semibold px-3 py-1 rounded-lg text-xs">Session</span>
          <span class="bg-green-100 text-green-700 px-2 py-1 rounded-lg text-xs font-semibold">Today â€¢ 6:00pm</span>
        </div>
        <h3 class="font-bold text-lg text-indigo-900 mb-2">Math Revision â€¢ Algebra & Trigonometry</h3>
        <p class="text-gray-600 mb-2 text-sm">Duration: 1 hour<br>Goal: Complete all assigned workbook problems.</p>
        <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded px-4 py-2 text-xs shadow w-max">Join Session</button>
      </div>
      <!-- Personal Goal Card -->
      <div class="bg-white rounded-xl shadow p-6 flex flex-col gap-3">
        <div class="flex items-center gap-3">
          <span class="bg-pink-100 text-pink-700 font-semibold px-3 py-1 rounded-lg text-xs">Goal</span>
          <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-lg text-xs font-semibold">Due: Jan 20</span>
        </div>
        <h3 class="font-bold text-lg text-indigo-900 mb-2">Finish Biology Notes ("Nucleus & Cell Division")</h3>
        <div class="flex items-center gap-2 mb-2">
          <span class="inline-block px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold">BIO102</span>
          <span class="inline-block px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-semibold">Notes</span>
        </div>
        <p class="text-gray-600 mb-2 text-sm">Mark as done when all notes are summarized.</p>
        <button class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 font-bold rounded px-4 py-2 text-xs shadow w-max">Mark as Done</button>
      </div>
      <!-- Add more cards based on user's sessions/goals -->
    </div>

    <!-- My StudyPadi Overview -->
    <div class="bg-gradient-to-r from-indigo-500 to-blue-500 rounded-xl px-6 py-7 text-white shadow mb-8 grid md:grid-cols-2 gap-7">
      <div>
        <h3 class="font-bold text-lg mb-1">Todayâ€™s Progress</h3>
        <div class="flex flex-col gap-2 text-sm">
          <span>Sessions Completed: <span class="font-bold">2</span></span>
          <span>Goals Achieved: <span class="font-bold">1</span></span>
          <span>Hours Studied: <span class="font-bold">2h 15m</span></span>
        </div>
      </div>
      <div class="flex flex-col justify-center">
        <div class="text-sm mb-2">Keep up the great work! Stay consistent for better results.</div>
        <button class="bg-white/20 hover:bg-white/40 text-white font-semibold rounded px-5 py-2 transition">See Full Journal</button>
      </div>
    </div>

    <!-- Journal / Timeline -->
    <div class="bg-white rounded-xl shadow p-6 mb-8">
      <h3 class="text-lg font-semibold text-indigo-800 mb-3">Learning Timeline</h3>
      <ol class="relative border-l border-indigo-200 ml-4">
        <li class="mb-5 ml-6">
          <span class="absolute -left-3 flex items-center justify-center w-6 h-6 bg-indigo-100 rounded-full ring-8 ring-white">
            <svg class="w-3 h-3 text-indigo-700" fill="currentColor"><circle cx="1.5" cy="1.5" r="1.5"></circle></svg>
          </span>
          <div class="font-semibold text-indigo-900">Started Math Revision session</div>
          <span class="text-xs text-gray-400">Today, 6:02pm</span>
        </li>
        <li class="mb-5 ml-6">
          <span class="absolute -left-3 flex items-center justify-center w-6 h-6 bg-green-100 rounded-full ring-8 ring-white">
            <svg class="w-3 h-3 text-green-700" fill="currentColor"><circle cx="1.5" cy="1.5" r="1.5"></circle></svg>
          </span>
          <div class="font-semibold text-indigo-900">Completed Biology Notes goal</div>
          <span class="text-xs text-gray-400">Today, 3:45pm</span>
        </li>
        <li class="ml-6">
          <span class="absolute -left-3 flex items-center justify-center w-6 h-6 bg-yellow-100 rounded-full ring-8 ring-white">
            <svg class="w-3 h-3 text-yellow-700" fill="currentColor"><circle cx="1.5" cy="1.5" r="1.5"></circle></svg>
          </span>
          <div class="font-semibold text-indigo-900">Scheduled next Chemistry session</div>
          <span class="text-xs text-gray-400">Yesterday, 8:50pm</span>
        </li>
      </ol>
    </div>

    <!-- Motivational Banner -->
    <div class="bg-gradient-to-br from-yellow-400 via-indigo-400 to-blue-600 rounded-xl px-7 py-6 text-white shadow flex flex-col md:flex-row items-center gap-5">
      <div class="flex-1">
        <h3 class="text-xl font-bold">Tip:</h3>
        <p class="text-md mb-1">Set realistic goals and review your progress at least once a week for continuous improvement.</p>
      </div>
      <div>
        <button class="bg-white/30 hover:bg-white/50 text-white font-semibold rounded px-6 py-2 transition">Set Weekly Goal</button>
      </div>
    </div>
  </div>

  <!-- Add Study Goal Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center hidden" id="addPadiModal">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-8 flex flex-col gap-6 relative">
      <button class="absolute top-4 right-5 text-gray-400 hover:text-indigo-600 text-2xl"
              onclick="document.getElementById('addPadiModal').classList.add('hidden')">&times;</button>
      <h3 class="font-bold text-2xl mb-2 text-indigo-900">Add New Study Goal</h3>
      <form class="flex flex-col gap-4">
        <div>
          <label class="font-medium mb-1 block">Goal Title*</label>
          <input type="text" class="border rounded-lg p-2 w-full" placeholder="Goal title (e.g. Finish Chemistry notes)" required>
        </div>
        <div>
          <label class="font-medium mb-1 block">Course*</label>
          <select class="border rounded-lg p-2 w-full" required>
            <option value="">Select course</option>
            <option value="PHY101">Physics 101</option>
            <option value="BIO102">Biology 102</option>
            <option value="CHE201">Chemistry 201</option>
          </select>
        </div>
        <div>
          <label class="font-medium mb-1 block">Due Date*</label>
          <input type="date" class="border rounded-lg p-2 w-full" required>
        </div>
        <div>
          <label class="font-medium mb-1 block">Description</label>
          <textarea class="border rounded-lg p-2 w-full min-h-[40px]" placeholder="Describe your study goal and how youâ€™ll accomplish it..."></textarea>
        </div>
        <button type="submit"
          class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded px-6 py-2 shadow mt-1">Add Goal</button>
      </form>
    </div>
  </div>
  </div>
<!-- Logout Section -->
<div id="logout-section" class="section-block hidden">
  <div class="flex flex-col items-center justify-center min-h-[60vh] py-10">
    <div class="bg-white rounded-xl shadow-lg p-10 max-w-md w-full flex flex-col items-center text-center">
      <svg class="w-20 h-20 mb-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 48 48">
        <circle cx="24" cy="24" r="22" stroke-width="3" stroke="currentColor" fill="none"/>
        <path d="M32 16v-2a4 4 0 00-4-4h-8a4 4 0 00-4 4v20a4 4 0 004 4h8a4 4 0 004-4v-2" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 24h16m0 0l-5-5m5 5l-5 5" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2 class="text-2xl font-bold text-indigo-800 mb-2">Sign out</h2>
      <p class="text-gray-700 mb-6">Are you sure you want to log out of your account?<br>This will end your current session and youâ€™ll need to login again to access the dashboard.</p>
      <div class="flex flex-col gap-3 w-full">
        <button 
          onclick="handleLogout()"
          class="bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg px-6 py-2 transition shadow"
        >
          Yes, Log me out
        </button>
        <button 
          onclick="switchSection('overview')"
          class="border border-gray-300 bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold rounded-lg px-6 py-2 transition shadow"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
  <script>
    function handleLogout() {
      // Clear local and session storage (including tokens & dashboard data)
      try {
        localStorage.clear();
        sessionStorage.clear();
      } catch {}
      // Optionally, for extra security, clear cookies (if JS-accessible)
      // Redirect to the login/landing page "mock-icthallb"
      window.location.href = "mock-icthallb";
    }
  </script>
</div>
        <!-- Study Resources Section -->
<div id="resources-section" class="section-block hidden">
  <div class="max-w-7xl mx-auto py-10 px-2 md:px-8">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-bold text-indigo-800">Study Resources</h2>
        <p class="text-md text-gray-600 mt-1">Find, organize, and access a collection of curated resources to help you excel.</p>
      </div>
      <div class="flex gap-4">
        <button class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition"
                onclick="document.getElementById('uploadResourceModal').classList.remove('hidden')">
          <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 4v16m8-8H4" stroke-width="2"></path></svg>
          Upload Resource
        </button>
        <button class="inline-flex items-center gap-2 border border-indigo-600 text-indigo-600 hover:bg-indigo-50 px-5 py-2 rounded-lg font-semibold transition shadow"
                onclick="window.location.href='#'">
          <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M21 21l-6-6m3-5A7 7 0 1 1 5 5a7 7 0 0 1 13 5z" stroke-width="2"></path></svg>
          Search Resources
        </button>
      </div>
    </div>

    <!-- Filter & Search -->
    <form class="flex flex-wrap gap-3 items-center bg-white shadow rounded-xl p-4 mb-8">
      <input type="text" class="flex-1 min-w-[150px] border rounded-lg p-2 text-sm" placeholder="Search by title, topic, or keyword...">
      <select class="border rounded-lg p-2 text-sm bg-gray-50 min-w-[120px]">
        <option value="">All Types</option>
        <option value="pdf">PDF</option>
        <option value="video">Video</option>
        <option value="notes">Notes</option>
        <option value="audio">Audio</option>
        <option value="link">Link</option>
      </select>
      <select class="border rounded-lg p-2 text-sm bg-gray-50 min-w-[120px]">
        <option value="">All Courses</option>
        <option value="PHY101">Physics 101</option>
        <option value="BIO102">Biology 102</option>
        <option value="CHE201">Chemistry 201</option>
      </select>
      <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 transition text-white font-semibold px-5 py-2 rounded-lg shadow">Filter</button>
    </form>

    <!-- Resources Grid/Table -->
    <div class="bg-white rounded-2xl shadow-lg overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr class="bg-indigo-50 text-left text-gray-700 text-sm font-semibold">
            <th class="px-6 py-4 rounded-tl-2xl">Title</th>
            <th class="px-6 py-4">Type</th>
            <th class="px-6 py-4">Course</th>
            <th class="px-6 py-4">Uploaded By</th>
            <th class="px-6 py-4">Date Added</th>
            <th class="px-6 py-4">Actions</th>
            <th class="px-6 py-4 rounded-tr-2xl">Rating</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-sm">
          <!-- Example resource 1 -->
          <tr class="hover:bg-indigo-50/40 transition">
            <td class="px-6 py-4">
              <a href="#" class="font-semibold text-indigo-800 hover:underline">PHY101 - Wave Optics</a>
              <div class="text-xs text-gray-500">Comprehensive lecture note &amp; solved examples</div>
            </td>
            <td class="px-6 py-4">
              <span class="inline-flex gap-1 items-center px-2 py-1 rounded bg-blue-100 text-blue-700 font-medium text-xs">
                <svg class="w-4 h-4" fill="none" stroke="currentColor"><rect x="4" y="4" width="16" height="16" rx="2" stroke-width="2"></rect></svg>
                PDF
              </span>
            </td>
            <td class="px-6 py-4">Physics 101</td>
            <td class="px-6 py-4 flex items-center gap-2">
              <img src="https://randomuser.me/api/portraits/men/44.jpg" class="w-6 h-6 rounded-full" alt="Neil Sims"/>
              <span>Neil Sims</span>
            </td>
            <td class="px-6 py-4">Jan 2, 2026</td>
            <td class="px-6 py-4 flex gap-2">
              <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-1 rounded shadow text-xs">View</button>
              <button class="bg-gray-100 hover:bg-indigo-50 text-indigo-700 px-4 py-1 rounded font-semibold text-xs">Download</button>
              <button class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 px-3 py-1 rounded text-xs font-bold">â˜… Save</button>
            </td>
            <td class="px-6 py-4">
              <div class="flex gap-0.5 text-yellow-400 items-center">
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4 text-gray-300" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <span class="text-gray-500 ml-1 text-xs">(56)</span>
              </div>
            </td>
          </tr>
          <!-- Example resource 2 -->
          <tr class="hover:bg-indigo-50/40 transition">
            <td class="px-6 py-4">
              <a href="#" class="font-semibold text-indigo-800 hover:underline">BIO102 - DNA Replication Video</a>
              <div class="text-xs text-gray-500">Explainer video & 3D animation</div>
            </td>
            <td class="px-6 py-4">
              <span class="inline-flex gap-1 items-center px-2 py-1 rounded bg-pink-100 text-pink-700 font-medium text-xs">
                <svg class="w-4 h-4" fill="none" stroke="currentColor"><polygon points="5,3 19,12 5,21 5,3" stroke-width="2"/></svg>
                Video
              </span>
            </td>
            <td class="px-6 py-4">Biology 102</td>
            <td class="px-6 py-4 flex items-center gap-2">
              <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-6 h-6 rounded-full" alt="Roberta"/>
              <span>Roberta Casas</span>
            </td>
            <td class="px-6 py-4">Dec 16, 2025</td>
            <td class="px-6 py-4 flex gap-2">
              <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-1 rounded shadow text-xs">Watch</button>
              <button class="bg-gray-100 hover:bg-indigo-50 text-indigo-700 px-4 py-1 rounded font-semibold text-xs">Download</button>
              <button class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 px-3 py-1 rounded text-xs font-bold">â˜… Save</button>
            </td>
            <td class="px-6 py-4">
              <div class="flex gap-0.5 text-yellow-400 items-center">
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <svg class="w-4 h-4 text-gray-300" fill="currentColor"><polygon points="9.9,1.1 3.3,21 19.8,8.6 0,8.6 16.5,21"/></svg>
                <span class="text-gray-500 ml-1 text-xs">(42)</span>
              </div>
            </td>
          </tr>
          <!-- Add more resources similarly -->
        </tbody>
      </table>
    </div>

    <!-- Quick Shortcuts & Tips -->
    <div class="mt-8 flex flex-col md:flex-row gap-4">
      <div class="flex-1 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-xl px-6 py-6 text-white shadow flex flex-col md:flex-row items-center gap-4">
        <div>
          <h3 class="text-xl font-bold mb-2">Need Help?</h3>
          <p class="mb-3">Browse our <a class="underline font-semibold" href="#">Resource FAQ</a> or contact <a class="underline font-semibold" href="#">Support</a>.</p>
        </div>
        <div class="ml-auto">
          <button class="bg-white/20 hover:bg-white/40 text-white font-semibold rounded px-5 py-2 transition">Resource Guidelines</button>
        </div>
      </div>
      <div class="flex-1 bg-white rounded-xl shadow px-6 py-6 text-gray-700 flex flex-col gap-2">
        <h3 class="text-lg font-semibold text-indigo-800 mb-2">Tips for Effective Study</h3>
        <ul class="list-disc ml-6 text-sm">
          <li>Organize resources by topic or type with the filters above.</li>
          <li>Save frequently used resources for quick access.</li>
          <li>Utilize videos and varied formats for deeper understanding.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Upload Resource Modal (hidden by default, show on upload button click) -->
  <div class="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center hidden" id="uploadResourceModal">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-8 flex flex-col gap-6 relative">
      <button class="absolute top-4 right-5 text-gray-400 hover:text-indigo-600 text-2xl" onclick="document.getElementById('uploadResourceModal').classList.add('hidden')">&times;</button>
      <h3 class="font-bold text-2xl mb-2 text-indigo-900">Upload New Resource</h3>
      <form class="flex flex-col gap-4">
        <div>
          <label class="font-medium mb-1 block">Title*</label>
          <input type="text" class="border rounded-lg p-2 w-full" placeholder="Resource title" required>
        </div>
        <div>
          <label class="font-medium mb-1 block">Course*</label>
          <select class="border rounded-lg p-2 w-full" required>
            <option value="">Select course</option>
            <option value="PHY101">Physics 101</option>
            <option value="BIO102">Biology 102</option>
            <option value="CHE201">Chemistry 201</option>
          </select>
        </div>
        <div>
          <label class="font-medium mb-1 block">Type*</label>
          <select class="border rounded-lg p-2 w-full" required>
            <option value="">Select type</option>
            <option value="pdf">PDF</option>
            <option value="video">Video</option>
            <option value="note">Notes</option>
            <option value="audio">Audio</option>
            <option value="link">Link</option>
          </select>
        </div>
        <div>
          <label class="font-medium mb-1 block">Upload File / Link*</label>
          <input type="file" class="border rounded-lg px-2 py-1 w-full" />
          <input type="url" class="mt-2 border rounded-lg px-2 py-1 w-full" placeholder="Or paste a link..." />
        </div>
        <div>
          <label class="font-medium mb-1 block">Description</label>
          <textarea class="border rounded-lg p-2 w-full min-h-[60px]" placeholder="Describe the resource, key concepts, etc."></textarea>
        </div>
        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded px-6 py-2 shadow mt-1">Upload Resource</button>
      </form>
    </div>
  </div>
                </div>
        <!-- Assignments Section -->
<div id="assignments-section" class="section-block hidden">
  <div class="max-w-6xl mx-auto py-8 space-y-8">

    <!-- Assignment Summary Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-5 mb-6">
      <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl shadow p-6 flex flex-col items-center">
        <div class="text-4xl font-bold mb-2">3</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Due Now</div>
      </div>
      <div class="bg-gradient-to-r from-green-400 to-teal-500 text-white rounded-xl shadow p-6 flex flex-col items-center">
        <div class="text-4xl font-bold mb-2">7</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Completed</div>
      </div>
      <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-xl shadow p-6 flex flex-col items-center">
        <div class="text-4xl font-bold mb-2">2</div>
        <div class="uppercase text-xs tracking-wider font-semibold">Overdue</div>
      </div>
    </div>

    <!-- Assignments Table -->
    <div class="bg-white rounded-2xl shadow-lg overflow-x-auto">
      <div class="flex items-center justify-between px-6 pt-6">
        <h2 class="text-2xl font-semibold text-indigo-900 mb-4">Your Assignments</h2>
        <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-5 py-2 rounded-lg shadow text-sm">+ New Assignment</button>
      </div>
      <table class="min-w-full divide-y divide-gray-200 pb-4">
        <thead class="bg-gray-50 text-xs uppercase tracking-wider">
          <tr>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Title</th>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Course</th>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Due Date</th>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Status</th>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Submission</th>
            <th class="px-6 py-3 text-left font-bold text-gray-600">Action</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100 text-sm">
          <tr class="hover:bg-indigo-50/40">
            <td class="px-6 py-4 font-semibold text-indigo-800">Project Proposal</td>
            <td class="px-6 py-4">CS101</td>
            <td class="px-6 py-4">Jan 12, 2026</td>
            <td class="px-6 py-4">
              <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-red-100 text-red-700">Due</span>
            </td>
            <td class="px-6 py-4">
              <span class="text-gray-500">Not Submitted</span>
            </td>
            <td class="px-6 py-4">
              <button class="bg-blue-600 hover:bg-blue-700 text-white rounded px-4 py-1 font-semibold text-xs shadow">Submit</button>
            </td>
          </tr>
          <tr class="hover:bg-indigo-50/40">
            <td class="px-6 py-4 font-semibold text-indigo-800">Essay: The Cell</td>
            <td class="px-6 py-4">BIO102</td>
            <td class="px-6 py-4">Jan 20, 2026</td>
            <td class="px-6 py-4">
              <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700">Completed</span>
            </td>
            <td class="px-6 py-4">
              <span class="text-green-600 font-semibold">Submitted</span>
            </td>
            <td class="px-6 py-4">
              <button class="bg-gray-100 hover:bg-gray-200 text-gray-800 rounded px-4 py-1 font-semibold text-xs border">View</button>
            </td>
          </tr>
          <tr class="hover:bg-indigo-50/40">
            <td class="px-6 py-4 font-semibold text-indigo-800">Calculus Homework</td>
            <td class="px-6 py-4">MTH201</td>
            <td class="px-6 py-4">Jan 5, 2026</td>
            <td class="px-6 py-4">
              <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-yellow-100 text-yellow-700">Overdue</span>
            </td>
            <td class="px-6 py-4">
              <span class="text-red-600">Not Submitted</span>
            </td>
            <td class="px-6 py-4">
              <button class="bg-red-500 hover:bg-red-600 text-white rounded px-4 py-1 font-semibold text-xs shadow">Submit</button>
            </td>
          </tr>
          <!-- More assignments ... -->
        </tbody>
      </table>
    </div>

    <!-- Assignment Detail Drawer Modal (for script-controlled expand/slide in) -->
    <!-- Placeholder for UI/JS integration; modal can be revealed by JS logic -->
    <div class="hidden" id="assignment-detail-modal">
      <div class="fixed inset-0 bg-black bg-opacity-30 z-40 flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-lg w-full mx-4 p-8 shadow-2xl flex flex-col gap-5 relative">
          <button class="absolute top-3 right-4 text-gray-500 hover:text-indigo-700 text-xl" onclick="document.getElementById('assignment-detail-modal').classList.add('hidden')">&times;</button>
          <h3 class="font-bold text-2xl mb-2 text-indigo-900">Assignment Title Here</h3>
          <div>
            <label class="block font-medium mb-1">Description</label>
            <p class="bg-gray-50 rounded p-3 text-gray-700 text-sm">Assignment details and instructions go here. You can provide detailed instructions for the assignment, requirements, and other notes.</p>
          </div>
          <div class="flex gap-3">
            <div>
              <span class="block font-medium text-xs text-gray-400">Due Date:</span>
              <span class="font-semibold">Jan 20, 2026</span>
            </div>
            <div>
              <span class="block font-medium text-xs text-gray-400">Course:</span>
              <span class="font-semibold">BIO102</span>
            </div>
            <div>
              <span class="block font-medium text-xs text-gray-400">Status:</span>
              <span class="font-semibold text-green-700">Completed</span>
            </div>
          </div>
          <div>
            <label class="block font-medium mb-1">Submission:</label>
            <div class="bg-green-50 rounded px-3 py-2 font-mono text-green-700">Submitted Document Link or Upload Button Placeholder</div>
          </div>
          <button class="mt-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded px-6 py-2 font-bold shadow text-sm">Edit Submission</button>
        </div>
      </div>
    </div>

    <!-- Assignment Upload Modal (not hooked by default) -->
    <!--
    <div class="hidden" id="assignment-upload-modal">
      ...
    </div>
    -->

  </div>
</div>
<!-- Mock Tests / Exams Section (Paginated) -->
<div id="mocktests-section" class="section-block hidden">
  <div class="max-w-5xl mx-auto py-8">
    <!-- AVAILABLE MOCKS -->
    <div class="mb-8">
      <h2 class="text-2xl font-semibold text-indigo-800 mb-2">Available Mock Exams</h2>
      <div class="overflow-x-auto rounded-xl shadow">
        <table class="min-w-full bg-white rounded-xl" id="mockExamsTable">
          <thead>
            <tr class="bg-indigo-50 text-gray-700 font-semibold text-sm">
              <th class="px-5 py-3 text-left rounded-tl-xl">Exam Title</th>
              <th class="px-5 py-3 text-left">Start Time</th>
              <th class="px-5 py-3 text-left">Status</th>
              <th class="px-5 py-3 text-left rounded-tr-xl">Action</th>
            </tr>
          </thead>
          <tbody class="text-gray-700" id="mockExamsTableBody">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-end gap-3 mt-2">
        <button id="mockAvailablePrevBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Previous</button>
        <span id="mockAvailablePageInfo" class="text-gray-700">Page 1</span>
        <button id="mockAvailableNextBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Next</button>
      </div>
    </div>

    <!-- COMPLETED MOCKS -->
    <div class="mb-2">
      <h2 class="text-2xl font-semibold text-indigo-800 mb-2">Completed Mock Exams</h2>
      <div class="overflow-x-auto rounded-xl shadow">
        <table class="min-w-full bg-white rounded-xl" id="completedExamsTable">
          <thead>
            <tr class="bg-indigo-50 text-gray-700 font-semibold text-sm">
              <th class="px-5 py-3 text-left rounded-tl-xl">Exam Title</th>
              <th class="px-5 py-3 text-left">Date Completed</th>
              <th class="px-5 py-3 text-left">Score</th>
              <th class="px-5 py-3 text-left rounded-tr-xl">Review</th>
            </tr>
          </thead>
          <tbody class="text-gray-700" id="completedExamsTableBody">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-end gap-3 mt-2">
        <button id="mockCompletedPrevBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Previous</button>
        <span id="mockCompletedPageInfo" class="text-gray-700">Page 1</span>
        <button id="mockCompletedNextBtn" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 font-bold" disabled>Next</button>
      </div>
    </div>
  </div>
</div>

<script>
const MOCK_PAGE_SIZE = 6;
let availableMocks = [];
let completedMocks = [];
let availableMockPage = 1;
let completedMockPage = 1;

function formatDate(dateStr) {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' });
}
function formatTime(dateStr) {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  return date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
}
function esc(str) { return String(str || "").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }

async function fetchCurrentUser() {
  try {
    const token = localStorage.getItem("token") || sessionStorage.getItem("token");
    if (!token) return null;
    const res = await fetch(`${API_BASE_URL}/api/auth/me`, {
      headers: { "Authorization": "Bearer " + token }
    });
    if (!res.ok) throw new Error("Failed to fetch user");
    const data = await res.json();
    return data.user;
  } catch(err) {
    console.error("User fetch error:", err);
    return null;
  }
}

async function fetchMockExams() {
  const token = localStorage.getItem("token") || sessionStorage.getItem("token");
  availableMocks = [];
  completedMocks = [];
  availableMockPage = 1;
  completedMockPage = 1;
  try {
    const user = await fetchCurrentUser();
    if (!user) {
      document.getElementById("mockExamsTableBody").innerHTML =
        '<tr><td colspan="4" class="px-5 py-5 text-center text-gray-400">Please login</td></tr>';
      document.getElementById("completedExamsTableBody").innerHTML =
        '<tr><td colspan="4" class="px-5 py-5 text-center text-gray-400">Please login</td></tr>';
      updatePaginationControls();
      return;
    }
    let faculty = user.faculty && (user.faculty._id || user.faculty);
    let department = user.department && (user.department._id || user.department);
    let level = user.level || "100";

    // Fetch exam schedules (AVAILABLE)
    let url = `${API_BASE_URL}/api/schedules?faculty=${faculty}&department=${department}&level=${encodeURIComponent(level)}`;
    const resExams = await fetch(url, {
      headers: { "Authorization": token ? `Bearer ${token}` : undefined }
    });
    let scheduleExams = [];
    if (resExams.ok) {
      const resp = await resExams.json();
      if (Array.isArray(resp)) {
        scheduleExams = resp;
      } else if (resp.schedules) {
        scheduleExams = resp.schedules;
      }
    }

    // Fetch completed exams (history)
    let completed = [];
    const resCompleted = await fetch(`${API_BASE_URL}/api/results/user/${user._id}`, {
      headers: { "Authorization": token ? `Bearer ${token}` : undefined }
    });
    if (resCompleted.ok) {
      const data = await resCompleted.json();
      if (Array.isArray(data)) completed = data;
    }

    // Gather completed examSet IDs
    const completedExamSetIDs = new Set(
      completed
        .map(r =>
          r.examSet?._id ||
          r.examSet ||
          r.examSetId ||
          (typeof r.examSet === 'object' && r.examSet?._id)
        )
        .filter(Boolean)
        .map(String)
    );

    // Available (not completed)
    availableMocks = scheduleExams.filter(sch => {
      const examSetId = sch.examSet?._id || sch.examSet || sch.examSetId || sch._id;
      return !completedExamSetIDs.has(String(examSetId));
    });

    // Completed
    completedMocks = completed;

    renderAvailableMocks();
    renderCompletedMocks();
    updatePaginationControls();
  } catch (e) {
    document.getElementById("mockExamsTableBody").innerHTML =
      `<tr><td colspan="4" class="px-5 py-5 text-center text-red-500">Failed to load exams.</td></tr>`;
    document.getElementById("completedExamsTableBody").innerHTML =
      `<tr><td colspan="4" class="px-5 py-5 text-center text-red-500">Failed to load exams.</td></tr>`;
    updatePaginationControls();
  }
}

function renderAvailableMocks() {
  const tbody = document.getElementById("mockExamsTableBody");
  const start = (availableMockPage-1)*MOCK_PAGE_SIZE;
  const pageMocks = availableMocks.slice(start, start+MOCK_PAGE_SIZE);
  tbody.innerHTML = "";
  if (!pageMocks.length) {
    tbody.innerHTML = `<tr><td colspan="4" class="text-gray-400 px-5 py-5 text-center">No available mock exams</td></tr>`;
    return;
  }
  pageMocks.forEach(sch => {
    const examSet = sch.examSet || {};
    const title = esc(examSet.title || sch.title || "Untitled");
    const startTime = sch.start || sch.startTime || sch.date || examSet.startTime || "";
    const status = (sch.status || examSet.status || "").toLowerCase();
    let now = new Date();
    let examStartTime = new Date(startTime);

    let statusLabel = "";
    let actionBtn = "";
    if ((status === "active" || status === "open") && examStartTime <= now) {
      statusLabel = `<span class="inline-flex items-center px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Available</span>`;
      actionBtn = `<button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow text-xs" onclick="startExam('${examSet._id || sch._id}')">Start</button>`;
    } else if (status === "closed") {
      statusLabel = `<span class="inline-flex items-center px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-xs font-bold">Closed</span>`;
      actionBtn = `<button class="px-4 py-2 bg-gray-200 text-gray-400 font-semibold rounded-lg shadow text-xs cursor-not-allowed" disabled>Closed</button>`;
    } else {
      statusLabel = `<span class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">Upcoming</span>`;
      actionBtn = `<button class="px-4 py-2 bg-blue-100 text-blue-500 font-semibold rounded-lg shadow text-xs cursor-not-allowed" disabled>Upcoming</button>`;
    }
    tbody.innerHTML += `
      <tr class="border-b hover:bg-indigo-50/50">
        <td class="px-5 py-4 font-medium">${title}</td>
        <td class="px-5 py-4 text-sm">${formatDate(startTime)} ${formatTime(startTime)}</td>
        <td class="px-5 py-4">${statusLabel}</td>
        <td class="px-5 py-4">${actionBtn}</td>
      </tr>
    `;
  });
}

function renderCompletedMocks() {
  const tbody = document.getElementById("completedExamsTableBody");
  const start = (completedMockPage-1)*MOCK_PAGE_SIZE;
  const pageMocks = completedMocks.slice(start, start+MOCK_PAGE_SIZE);
  if (!pageMocks.length) {
    tbody.innerHTML = `<tr><td colspan="4" class="text-gray-400 px-5 py-5 text-center">No completed mock exams yet</td></tr>`;
    return;
  }
  tbody.innerHTML = pageMocks.map(res => {
    let title =
      esc((res.examSet && (res.examSet.title || res.examSet.name)) ||
      res.examTitle || res.title || "Untitled");
    let dateCompleted = res.completedAt || res.date || res.createdAt || res.submittedAt;
    let score = res.score || res.percentage || (res.result ? `${res.result}` : "");
    return `
      <tr class="border-b hover:bg-indigo-50/50">
        <td class="px-5 py-4 font-medium">${title}</td>
        <td class="px-5 py-4 text-sm">${formatDate(dateCompleted)}</td>
        <td class="px-5 py-4 font-semibold text-green-700">${score ? (score + '%') : ''}</td>
        <td class="px-5 py-4">
          <button class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow text-xs" onclick="reviewExam('${res._id}')">Review</button>
        </td>
      </tr>
    `;
  }).join('');
}

function updatePaginationControls() {
  // Available
  const totalAvailable = Math.ceil(availableMocks.length / MOCK_PAGE_SIZE) || 1;
  document.getElementById("mockAvailablePageInfo").textContent = `Page ${availableMockPage} of ${totalAvailable}`;
  document.getElementById("mockAvailablePrevBtn").disabled = availableMockPage <= 1;
  document.getElementById("mockAvailableNextBtn").disabled = availableMockPage >= totalAvailable;
  // Completed
  const totalCompleted = Math.ceil(completedMocks.length / MOCK_PAGE_SIZE) || 1;
  document.getElementById("mockCompletedPageInfo").textContent = `Page ${completedMockPage} of ${totalCompleted}`;
  document.getElementById("mockCompletedPrevBtn").disabled = completedMockPage <= 1;
  document.getElementById("mockCompletedNextBtn").disabled = completedMockPage >= totalCompleted;
}

// Event Listeners for Pagination
document.addEventListener("DOMContentLoaded", function() {
  document.getElementById("mockAvailablePrevBtn").onclick = function() {
    if (availableMockPage > 1) { availableMockPage--; renderAvailableMocks(); updatePaginationControls(); }
  };
  document.getElementById("mockAvailableNextBtn").onclick = function() {
    const total = Math.ceil(availableMocks.length / MOCK_PAGE_SIZE) || 1;
    if (availableMockPage < total) { availableMockPage++; renderAvailableMocks(); updatePaginationControls(); }
  };
  document.getElementById("mockCompletedPrevBtn").onclick = function() {
    if (completedMockPage > 1) { completedMockPage--; renderCompletedMocks(); updatePaginationControls(); }
  };
  document.getElementById("mockCompletedNextBtn").onclick = function() {
    const total = Math.ceil(completedMocks.length / MOCK_PAGE_SIZE) || 1;
    if (completedMockPage < total) { completedMockPage++; renderCompletedMocks(); updatePaginationControls(); }
  };

  fetchMockExams();
});

function startExam(examId) {
  window.location.href = `/mock-exam/${examId}`;
}
function reviewExam(resultId) {
  window.location.href = `/mock-exam/review/${resultId}`;
}
</script>
        <!-- Past Questions Section -->
<div id="pastquestions-section" class="section-block hidden">
  <div class="max-w-6xl mx-auto py-8">
    <!-- Filter Form -->
    <form class="bg-white rounded-xl shadow px-6 py-5 mb-8 flex flex-col md:flex-row gap-4 md:items-end">
      <div class="flex flex-col flex-1">
        <label class="font-medium text-gray-700 mb-1" for="course">Course</label>
        <input type="text" id="course" class="border rounded-lg p-2 text-gray-700 focus:ring focus:border-blue-400 outline-none" placeholder="e.g., Physics, Chemistry">
      </div>
      <div class="flex flex-col flex-1">
        <label class="font-medium text-gray-700 mb-1" for="year">Year</label>
        <input type="number" id="year" class="border rounded-lg p-2 text-gray-700 focus:ring focus:border-blue-400 outline-none" placeholder="e.g., 2023">
      </div>
      <div class="flex flex-col flex-1">
        <label class="font-medium text-gray-700 mb-1" for="exam">Exam Type</label>
        <select id="exam" class="border rounded-lg p-2 text-gray-700 focus:ring focus:border-blue-400 outline-none">
          <option value="" selected>All types</option>
          <option value="midterm">Midterm</option>
          <option value="final">Final</option>
          <option value="quiz">Quiz</option>
        </select>
      </div>
      <button type="submit" class="bg-gradient-to-r from-indigo-500 to-blue-600 text-white font-semibold px-7 py-2 rounded-lg shadow-md hover:from-indigo-700 hover:to-blue-800 transition w-full md:w-auto">
        Filter
      </button>
    </form>

    <!-- Past Questions Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Card Example 1 -->
      <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col hover:shadow-xl transition">
        <div class="flex items-center gap-3 mb-3">
          <span class="bg-indigo-100 text-indigo-800 font-semibold px-3 py-1 rounded-lg text-xs">PHY101</span>
          <span class="bg-yellow-100 text-yellow-700 font-semibold px-2 py-1 rounded-lg text-xs">2023</span>
          <span class="bg-green-100 text-green-700 px-2 py-1 rounded-lg text-xs font-semibold">Final</span>
        </div>
        <h3 class="font-bold text-lg text-indigo-900 mb-2">Physics 101 - Final Exam</h3>
        <p class="text-gray-600 mb-4 text-sm">Experience the official PHY101 (2023) final exam with comprehensive solutions and marking scheme.</p>
        <div class="flex gap-2 mt-auto">
          <button class="flex-1 bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded-lg font-semibold shadow">View</button>
          <button class="flex-1 bg-gray-100 hover:bg-indigo-50 text-indigo-700 transition px-4 py-2 rounded-lg font-semibold">Download</button>
        </div>
      </div>
      <!-- Card Example 2 -->
      <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col hover:shadow-xl transition">
        <div class="flex items-center gap-3 mb-3">
          <span class="bg-pink-100 text-pink-700 font-semibold px-3 py-1 rounded-lg text-xs">BIO102</span>
          <span class="bg-yellow-100 text-yellow-700 font-semibold px-2 py-1 rounded-lg text-xs">2022</span>
          <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-lg text-xs font-semibold">Midterm</span>
        </div>
        <h3 class="font-bold text-lg text-indigo-900 mb-2">Biology 102 - Midterm Paper</h3>
        <p class="text-gray-600 mb-4 text-sm">Test your knowledge with last yearâ€™s BIO102 midterm. Includes detailed answers and explanations.</p>
        <div class="flex gap-2 mt-auto">
          <button class="flex-1 bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded-lg font-semibold shadow">View</button>
          <button class="flex-1 bg-gray-100 hover:bg-indigo-50 text-indigo-700 transition px-4 py-2 rounded-lg font-semibold">Download</button>
        </div>
      </div>
      <!-- Card Example 3 -->
      <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col hover:shadow-xl transition">
        <div class="flex items-center gap-3 mb-3">
          <span class="bg-green-100 text-green-800 font-semibold px-3 py-1 rounded-lg text-xs">CHE201</span>
          <span class="bg-yellow-100 text-yellow-700 font-semibold px-2 py-1 rounded-lg text-xs">2021</span>
          <span class="bg-red-100 text-red-700 px-2 py-1 rounded-lg text-xs font-semibold">Quiz</span>
        </div>
        <h3 class="font-bold text-lg text-indigo-900 mb-2">Chemistry 201 - Quiz</h3>
        <p class="text-gray-600 mb-4 text-sm">Sharpen your skills with the CHE201 quiz. Perfect for quick revision before your exams.</p>
        <div class="flex gap-2 mt-auto">
          <button class="flex-1 bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded-lg font-semibold shadow">View</button>
          <button class="flex-1 bg-gray-100 hover:bg-indigo-50 text-indigo-700 transition px-4 py-2 rounded-lg font-semibold">Download</button>
        </div>
      </div>
      <!-- Add more cards as needed following the above card pattern -->
    </div>

    <!-- No Results Example (optional, for empty filter result) -->
    
    <div class="mt-12 flex flex-col items-center justify-center text-gray-400">
      <svg class="w-14 h-14 mb-2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      <span class="font-semibold text-lg">No past questions found.</span>
      <span class="text-sm">Try adjusting your search filters.</span>
    </div>
  
  </div>
</div>
        <!-- Messages Section -->
        <div id="messages-section" class="section-block hidden">
          <div class="flex flex-col md:flex-row gap-4 h-[80vh]">
            <!-- Sidebar: Chats -->
            <div class="w-full md:w-1/3 xl:w-1/4 border-r bg-white rounded-lg overflow-hidden flex flex-col min-w-[265px]">
              <div class="flex-shrink-0 p-4 border-b">
                <input type="text" placeholder="Search for messages or contacts" class="block w-full p-2 pl-9 text-sm border rounded-lg bg-gray-50 outline-none focus:border-blue-400" />
                <span class="absolute left-6 top-3.5 text-gray-400"></span>
              </div>
              <div class="flex-1 overflow-y-auto min-h-0">
                <div>
                  <!-- Replicate the avatar with status for main contact -->
                  <ul>
                    <li class="flex items-center px-4 py-2 group cursor-pointer bg-blue-50 border-r-4 border-blue-600">
                      <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-8 h-8 rounded-full mr-2" alt="Roberta" />
                      <div class="flex-1">
                        <div class="flex items-center gap-2"><span class="font-semibold text-sm">Roberta Casas</span><span class="text-xs text-blue-600 ml-1 animate-pulse font-semibold">Typingâ€¦</span></div>
                        <span class="text-xs text-gray-500">18:05</span>
                      </div>
                      <div class="ml-3 flex flex-col gap-1 text-xs text-right">
                        <span class="text-green-600">â—</span>
                      </div>
                    </li>
                    <!-- Additional contacts (truncated for brevity) -->
                    <li class="flex items-center px-4 py-2 group cursor-pointer hover:bg-gray-50">
                      <img src="https://randomuser.me/api/portraits/women/60.jpg" class="w-8 h-8 rounded-full mr-2" alt="" />
                      <div class="flex-1"><span class="font-semibold text-sm">Leslie Livingston</span><br><span class="text-xs text-gray-400">Yes, we can do this! ðŸ”¥</span></div>
                      <span class="text-xs text-gray-400">14:23</span>
                    </li>
                    <li class="flex items-center px-4 py-2 group cursor-pointer hover:bg-gray-50">
                      <img src="https://randomuser.me/api/portraits/men/44.jpg" class="w-8 h-8 rounded-full mr-2" alt="" />
                      <div class="flex-1"><span class="font-semibold text-sm">Neil Sims</span><br><span class="text-xs text-gray-400">Voice message</span></div>
                      <span class="text-xs text-gray-400">10:02</span>
                    </li>
                  </ul>
                </div>
                <div>
                  <div class="text-xs font-bold px-4 pt-2 pb-1 text-gray-400">Group conversation</div>
                  <ul>
                    <li class="flex items-center px-4 py-2 group cursor-pointer hover:bg-gray-50">
                      <img src="https://randomuser.me/api/portraits/men/72.jpg" class="w-8 h-8 rounded-full mr-2" alt="" />
                      <div class="flex-1"><span class="font-semibold text-sm">Business group</span><br><span class="text-xs text-gray-400">Bonnie: Wait! What test? ðŸ¤”</span></div>
                    </li>
                    <li class="flex items-center px-4 py-2 group cursor-pointer hover:bg-gray-50">
                      <img src="https://randomuser.me/api/portraits/women/75.jpg" class="w-8 h-8 rounded-full mr-2" alt="" />
                      <div class="flex-1"><span class="font-semibold text-sm">Family group</span><br><span class="text-xs text-gray-400">Jese: Pizza is here! ðŸ•</span></div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- Message Pane -->
            <div class="flex-1 bg-gray-50 flex flex-col rounded-lg overflow-hidden">
              <div class="flex-shrink-0 px-6 py-3 border-b flex gap-3 items-center bg-white">
                <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-9 h-9 rounded-full" alt="" />
                <div>
                  <div class="font-semibold text-base">Roberta Casas</div>
                  <div class="text-green-600 text-xs">Online</div>
                </div>
              </div>
              <div class="flex-1 overflow-y-auto px-5 py-4 bg-gray-50 flex flex-col gap-4">
                <!-- Example messages (partial, for full fidelity, expand as pattern) -->
                <div class="flex flex-col gap-1">
                  <div class="flex gap-2 items-end">
                    <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-7 h-7 rounded-full" alt="" />
                    <div>
                      <div class="bg-white rounded-lg px-4 py-2 shadow text-sm">That's awesome. I think our users will really appreciate the improvements.</div>
                      <div class="text-xs text-gray-400 mt-1 pl-1">11:46</div>
                    </div>
                  </div>
                  <div class="flex gap-2 items-end mt-2">
                    <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-7 h-7 rounded-full" alt="" />
                    <div>
                      <div class="bg-white rounded-lg px-4 py-2 shadow w-72 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M9 19V6l-2.83 2.83"/></svg>
                        <span class="text-sm text-gray-700">3:42</span>
                        <span class="flex-1"><span class="block h-1 bg-blue-400 w-16 rounded"></span></span>
                      </div>
                      <div class="text-xs text-gray-400 mt-1 pl-1">11:48</div>
                    </div>
                  </div>
                </div>
                <div class="flex gap-2 justify-end items-end">
                  <div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm">I agree on this one and we should add it to the next sprint so that we can roll it out as soon as possible.</div>
                    <div class="text-xs text-gray-400 mt-1 text-right">11:48</div>
                  </div>
                  <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-7 h-7 rounded-full" alt="" />
                </div>
                <div class="flex flex-row-reverse gap-2 items-end">
                  <div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm mb-1">Hey Roberta... forgot to ask, but can you please send me a pic of the new office?</div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm">Thanks! ðŸ™</div>
                    <div class="text-xs text-gray-400 mt-1 text-right">11:48</div>
                  </div>
                  <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-7 h-7 rounded-full" alt="" />
                </div>
                <div class="flex gap-2 items-end">
                  <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-7 h-7 rounded-full" alt="" />
                  <div>
                    <div class="bg-white rounded-lg px-4 py-2 shadow text-sm flex flex-col gap-3">
                      <span>Here's the new office! <span class="text-blue-600">ðŸ’™</span></span>
                      <img class="rounded-lg w-64" src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80" alt="office" />
                    </div>
                    <div class="text-xs text-gray-400 mt-1 pl-1">11:46</div>
                  </div>
                </div>
                <div class="flex gap-2 justify-end items-end">
                  <div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm mb-1">We've been looking for a design system for a while now, I think that I have found a pretty good candidate.</div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm">I'll send a link in a bit.</div>
                    <div class="text-xs text-gray-400 mt-1 text-right">12:56</div>
                  </div>
                  <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-7 h-7 rounded-full" alt="" />
                </div>
                <div class="flex gap-2 items-end">
                  <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-7 h-7 rounded-full" alt="" />
                  <div>
                    <div class="bg-white rounded-lg px-4 py-2 shadow text-sm">
                      You mean this one? <span class="ml-1">ðŸ™ƒ</span>
                      <div class="mt-2">
                        <a href="https://github.com/themesberg/flowbite" class="text-blue-600 underline" target="_blank">https://github.com/themesberg/flowbite</a>
                        <div class="border rounded-lg mt-2 bg-gray-100 p-3">
                          <div class="flex items-center gap-2">
                            <svg fill="none" class="w-7 h-7" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke="#2563eb" stroke-width="2"/><polygon points="9,8 15,12 9,16" fill="#2563eb" /></svg>
                            <span class="text-blue-700 font-semibold">Flowbite</span>
                          </div>
                          <div class="text-xs mt-2">GitHub - themesberg/flowbite: The most popular and open source library...</div>
                        </div>
                      </div>
                    </div>
                    <div class="text-xs text-gray-400 mt-1 pl-1">11:46</div>
                  </div>
                </div>
                <div class="flex gap-2 justify-end items-end">
                  <div>
                    <div class="bg-indigo-100 rounded-lg px-4 py-2 shadow text-sm">Wait... how did you know? ðŸ˜±</div>
                    <div class="text-xs text-gray-400 mt-1 text-right">13:02</div>
                  </div>
                  <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-7 h-7 rounded-full" alt="" />
                </div>
                <div class="flex gap-2 items-end">
                  <img src="https://randomuser.me/api/portraits/women/68.jpg" class="w-7 h-7 rounded-full" alt="" />
                  <div>
                    <div class="bg-white rounded-lg px-4 py-2 shadow text-sm">
                      I have been using it forever!
                    </div>
                    <div class="text-xs text-gray-400 mt-1 pl-1">13:04</div>
                  </div>
                </div>
              </div>
              <div class="p-4 bg-white border-t flex gap-3 items-center">
                <button class="text-gray-500 hover:text-indigo-600">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor"><path d="M13.5 20L9 15.5l4.5-4.5"/></svg>
                </button>
                <input type="text" placeholder="Type a message..." class="flex-1 p-2 text-sm border rounded-lg bg-gray-50 outline-none focus:border-blue-400" />
                <button class="bg-blue-700 text-white font-medium rounded-md px-4 py-1 hover:bg-blue-800 flex items-center">
                  <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor"><path d="M21 11.5a8.38 8.38 0 01-1.29 4.56L13.5 20v-4.55A7.49 7.49 0 0020.5 11.5a7.49 7.49 0 00-7.5-7.5V2l-7 7 7 7v-4.55A8.38 8.38 0 0119 11.5z"/></svg>
                  <span>Send</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Settings Section -->
        <div id="settings-section" class="section-block hidden">
          <div class="max-w-5xl mx-auto flex flex-col gap-6 py-6">
            <!-- General Info -->
            <div class="bg-white rounded-lg shadow p-5 space-y-6">
              <h2 class="font-semibold text-xl mb-2">General information</h2>
              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Your name*</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Ex. Bonnie Green" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Full address*</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="174 Cayuga Ave, San Francisco, CA 9411" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Biography</label>
                  <textarea class="w-full border rounded-lg p-2 text-sm h-10 min-h-[40px] max-h-32" placeholder="Hello, my name is Bonnie Green..."></textarea>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">ZIP/Postal code</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Ex. 123456" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Your organization</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Ex. Flowbite LLC" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Country*</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="United States" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Town/City*</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Ex. Sacramento" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Department</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Marketing" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Account Type <span class="text-gray-400" title="E.g., Admin, Student, Teacher">?</span></label>
                  <select class="w-full border rounded-lg p-2 text-sm">
                    <option>Choose your account type</option>
                    <option>Student</option>
                    <option>Teacher</option>
                    <option>Admin</option>
                  </select>
                </div>
              </div>
              <button class="bg-blue-700 text-white mt-2 px-6 py-2 rounded font-semibold hover:bg-blue-800">Save changes</button>
            </div>
            <!-- Social -->
            <div class="bg-white rounded-lg shadow p-5 space-y-4">
              <div class="text-xl font-semibold mb-1">Social</div>
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="text-sm font-medium">Facebook</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your facebook account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Dribbble</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your dribbble account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Twitter</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your twitter account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Behance</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your behance account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Github</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your github account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Pinterest</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your pinterest account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">Instagram</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your instagram account"/>
                </div>
                <div>
                  <label class="text-sm font-medium">TikTok</label>
                  <input type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your tiktok account"/>
                </div>
              </div>
              <button class="bg-blue-700 text-white mt-2 px-6 py-2 rounded font-semibold hover:bg-blue-800">Save changes</button>
            </div>
            <!-- Password -->
            <div class="bg-white rounded-lg shadow p-5 space-y-4">
              <div class="text-xl font-semibold mb-1">Password</div>
              <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-3">
                  <label class="block text-sm font-medium mb-1">Current password</label>
                  <input type="password" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your current password"/>
                  <label class="block text-sm font-medium mb-1">Your new password</label>
                  <input type="password" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter your new password"/>
                  <label class="block text-sm font-medium mb-1">Confirm new password</label>
                  <input type="password" class="w-full border rounded-lg p-2 text-sm" placeholder="Confirm new password"/>
                  <button class="bg-blue-700 text-white mt-1 px-6 py-2 rounded font-semibold hover:bg-blue-800">Save changes</button>
                </div>
                <div class="bg-gray-50 rounded-lg p-4 text-sm">
                  <div class="font-semibold mb-1">Password requirements:</div>
                  <ul class="space-y-1">
                    <li class="flex items-center gap-2 text-green-600"><span class="text-xl">â—</span>At least 10 characters (and up to 100 characters)</li>
                    <li class="flex items-center gap-2 text-green-600"><span class="text-xl">â—</span>At least one lowercase character</li>
                    <li class="flex items-center gap-2 text-green-600"><span class="text-xl">â—</span>Inclusion of at least one special character, e.g., ! @ # ?</li>
                    <li class="flex items-center gap-2 text-gray-400"><span class="text-xl">â—</span>Significantly different from your previous passwords</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Other section blocks remain unchanged, and are hidden unless selected -->
      </main>
    </div>
  </div>

  <script>

let student = null;
    async function fetchStudentProfile() {
  try {
    // Update with your actual API endpoint
    const resp = await fetch('https://examguide.onrender.com/api/auth/me', { credentials: 'include' });
    const data = await resp.json();
    student = data.user; // Adapt if your response shape differs
    updateHeaderProfilePic(student);
    populateUserDetails();
    // Any additional UI functions needing student
  } catch (err) {
    console.error('Failed to fetch student', err);
    // Optionally show error message or fallback UI
  }
}
          // Section show/hide
    function toggleMobileDrawer(show) {
      const sidebar = document.getElementById('mobileSidebar');
      const overlay = document.getElementById('mobileDrawerOverlay');
      if (show) {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
      } else {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
      }
    }
    function switchSection(section, isMobile) {
      if(isMobile) toggleMobileDrawer(false);
      document.querySelectorAll('.section-block').forEach(s => s.classList.add('hidden'));
      if(document.getElementById(section + '-section'))
        document.getElementById(section + '-section').classList.remove('hidden');
      const allLists = [document.getElementById('desktopSidebarList'), document.querySelector('aside#mobileSidebar nav ul')];
      allLists.forEach(list => {
        if (!list) return;
        Array.from(list.children).forEach((li, i) => {
          if (li.querySelector('.sidebar-btn')) {
            const sectionsOrder = ['overview','mocktests','pastquestions','taskscenter','resources','messages','profile','assignments','studyPadi','broadcasts','settings','logout'];
            if(i===sectionsOrder.indexOf(section)) {
              li.querySelector('.sidebar-btn').classList.add('sidebar-active');
            } else {
              li.querySelector('.sidebar-btn').classList.remove('sidebar-active');
            }
          }
        });
      });
    }
    document.getElementById('profileDropdownBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      document.getElementById('profileDropdown').classList.toggle('hidden');
    });
    document.getElementById('notifBtn').addEventListener('click', function(e){
      alert('You have 2 new notifications!');
    });
    window.addEventListener('click', function(e){
      if (!document.getElementById('profileDropdownBtn').contains(e.target)) {
        document.getElementById('profileDropdown').classList.add('hidden');
      }
    });

    // Motivation Quotes
    const motivations = [
      "You are capable of amazing things.",
      "Donâ€™t watch the clock; do what it does. Keep going.",
      "Success is not for the lazy.",
      "Stay positive, work hard, make it happen.",
      "Mistakes are proof that you are trying.",
      "Push yourself, because no one else is going to do it for you.",
      "Believe you can and youâ€™re halfway there.",
      "Small steps every day!",
      "Your only limit is your mind.",
      "Dream big, work hard, stay focused."
    ];
    function randomMotivation() {
      const msg = motivations[Math.floor(Math.random()*motivations.length)];
      document.getElementById('motivation-message').textContent = msg;
    }
    // Auto refresh motivational quote every 5 seconds
    setInterval(randomMotivation, 5000);

    // === Fetch CURRENT USER details from backend ===
    const API_BASE_URL = "https://examguide.onrender.com";
    async function fetchCurrentUser() {
      try {
        const token = localStorage.getItem("token");
        if (!token) return null;
        const res = await fetch(`${API_BASE_URL}/api/auth/me`, {
          method: "GET",
          headers: { "Authorization": `Bearer ${token}` },
          credentials: "include"
        });
        if (!res.ok) throw new Error("Failed to fetch user");
        const data = await res.json();
        return data.user;
      } catch (err) {
        console.error("Error fetching user:", err);
        return null;
      }
    }
    // Update dashboard UI with user info
    async function populateUserDetails() {
      const user = await fetchCurrentUser();
      if (!user) return;
      // Welcome message
      document.querySelectorAll('h2.text-2xl.font-bold.mb-1').forEach(el => {
        el.textContent = `Welcome back, ${user.fullname || user.username || 'Student'}!`;
      });
      // Profile photo (dashboard + profile section)
     const img = document.getElementById("headerProfilePic");
if (img) img.src = getProfilePicUrl(student);
      // Email
      const emailInput = document.querySelector("input[type='email']");
      if (emailInput && user.email) emailInput.value = user.email;
      const emailLink = document.querySelector("a[href^='mailto:']");
      if (emailLink && user.email) {
        emailLink.textContent = user.email;
        emailLink.href = `mailto:${user.email}`;
      }
      // Name, phone, department, etc. (update if available)
      if (document.querySelector("input[type='text'][value='Alex Student']") && user.fullname)
        document.querySelector("input[type='text'][value='Alex Student']").value = user.fullname;
      if (document.querySelector("input[type='text'][value='+2348012345678']") && user.phone)
        document.querySelector("input[type='text'][value='+2348012345678']").value = user.phone;
      if (document.querySelector("input[type='text'][value='Computer Science']") && user.department)
        document.querySelector("input[type='text'][value='Computer Science']").value = user.department;
    }

    document.addEventListener('DOMContentLoaded', function() {
      switchSection('overview');
      populateUserDetails();
      

      const gpaCtx = document.getElementById('gpaChart').getContext('2d');
      window.gpaChart = new Chart(gpaCtx, {
        type: 'line',
        data: {
          labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4'],
          datasets: [{
            label: 'GPA',
            data: [3.2, 3.45, 3.67, 3.8],
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37,99,235,0.1)',
            borderWidth: 3,
            pointRadius: 4,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          scales: { y: { beginAtZero: false, min:2.0, max:4.0 } },
          plugins: { legend: { display: false } }
        }
      });

      randomMotivation();
    });

document.addEventListener("DOMContentLoaded", function() {
  const API_URL = "https://examguide.onrender.com/api/";
  const token = localStorage.getItem("token");
  function fetchTopScorers() {
    fetch(API_URL + "results/leaderboard/top", {
      headers: { Authorization: "Bearer " + token }
    })
    .then(resp => resp.json())
    .then(data => {
      let html = "";
      if (Array.isArray(data) && data.length > 0) {
        html = data.slice(0, 3).map((stu, idx) => `
          <div class="flex items-center gap-3">
            <img src="${stu.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(stu.fullname||stu.username)}&background=3a86ff&color=fff&rounded=true`}" class="w-10 h-10 rounded-full border-2 border-indigo-400 shadow" alt="${stu.fullname}">
            <span class="text-base font-semibold text-indigo-900 flex-1">${stu.fullname || stu.username}</span>
            <span class="text-sm font-bold text-indigo-600">${stu.totalScore} pts</span>
            <span class="ml-2 text-xl">${['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'][idx]||''}</span>
          </div>
        `).join('');
      } else {
        html = `<div style="text-align:center;color:#888;">No leaderboard data yet.</div>`;
      }
      document.getElementById("topScorersList").innerHTML = html;
    }).catch(() => {
      document.getElementById("topScorersList").innerHTML = `<div style="text-align:center;color:#f25f5c;">Failed to load top scorers!</div>`;
    });
  }
  fetchTopScorers();
});
    // example usage in HTML/JS
document.getElementById('profileImage').src = getProfilePicUrl(student);
// getProfilePicUrl implements the logic above
</script>
</body>
</html>
