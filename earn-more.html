<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Earn More Credit Points | OAU ExamGuard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(120deg, #f0f4ff 0%, #fef6e4 100%);
      min-height: 100vh;
    }
    .earn-method-card {
      background: #fff;
      border-radius: 1.25rem;
      box-shadow: 0 4px 32px 0 rgba(80,100,180,0.11);
      transition: box-shadow 0.2s, transform 0.2s;
    }
    .earn-method-card:hover {
      box-shadow: 0 8px 48px 0 rgba(255,215,0,0.18);
      transform: translateY(-2px) scale(1.025);
    }
    @media (max-width: 640px) {
      .earn-method-card { padding: 1.4rem !important; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between py-3 px-4">
      <div class="flex items-center gap-3">
        <img src="logo.png" alt="Logo" class="h-11 w-11 rounded-full border-2 border-indigo-200 shadow" />
        <span class="font-extrabold text-indigo-700 text-2xl tracking-wide">OAU ExamGuard</span>
      </div>
      <a href="earnings.html" class="inline-flex items-center px-5 py-2 text-base font-semibold text-white bg-indigo-700 rounded-full shadow hover:bg-indigo-800 transition">
        <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
        Back
      </a>
    </div>
  </nav>
  <!-- Main Content -->
  <main class="flex-1 flex flex-col items-center justify-center px-3 py-4">
    <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-900 text-center mb-7 mt-6">Earn More Credit Points</h1>
    <div class="w-full max-w-2xl grid grid-cols-1 sm:grid-cols-2 gap-7">
      <!-- Watch Ad Card -->
      <div class="earn-method-card p-6 flex flex-col items-center text-center">
        <div class="flex items-center justify-center w-14 h-14 rounded-full bg-yellow-100 shadow mb-2">
          <svg class="w-9 h-9 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor" stroke-width="2"/>
            <polygon points="10,9 16,12 10,15" fill="currentColor"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-yellow-700 mb-2">Watch Ad</h2>
        <p class="text-gray-600 mb-3">Watch a short ad and get random credit points as a reward. Stay on the ad for <b>20 seconds</b> to qualify.</p>
        <button id="watchAdBtn" class="mt-2 px-6 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow hover:bg-yellow-600 transition">
          Watch Ad &amp; Earn
        </button>
      </div>
      <!-- YouTube Subscribe (future) -->
      <div class="earn-method-card p-6 flex flex-col items-center text-center opacity-50 cursor-not-allowed">
        <div class="flex items-center justify-center w-14 h-14 rounded-full bg-red-100 shadow mb-2">
          <svg class="w-9 h-9 text-red-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor" stroke-width="2"/>
            <polygon points="10,9 16,12 10,15" fill="currentColor"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-red-700 mb-2">Subscribe to YouTube</h2>
        <p class="text-gray-600 mb-3">Coming soon: Subscribe to our YouTube channel to earn points, right from this platform!</p>
        <button class="mt-2 px-6 py-2 bg-red-400 text-white font-semibold rounded-lg shadow" disabled>
          Coming Soon
        </button>
      </div>
      <!-- Facebook Follow (future) -->
      <div class="earn-method-card p-6 flex flex-col items-center text-center opacity-50 cursor-not-allowed">
        <div class="flex items-center justify-center w-14 h-14 rounded-full bg-blue-100 shadow mb-2">
          <svg class="w-9 h-9 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M17 2.07V4.07C17 5.1 16.1 6 15.07 6H9.93C8.9 6 8 5.1 8 4.07V2.07C8 1.04 8.9 0.14 9.93 0.14H15.07C16.1 0.14 17 1.04 17 2.07Z" fill="currentColor"/>
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-blue-700 mb-2">Follow on Facebook</h2>
        <p class="text-gray-600 mb-3">Coming soon: Follow us on Facebook to earn points instantly!</p>
        <button class="mt-2 px-6 py-2 bg-blue-400 text-white font-semibold rounded-lg shadow" disabled>
          Coming Soon
        </button>
      </div>
      <!-- Facebook Video (future) -->
      <div class="earn-method-card p-6 flex flex-col items-center text-center opacity-50 cursor-not-allowed">
        <div class="flex items-center justify-center w-14 h-14 rounded-full bg-blue-100 shadow mb-2">
          <svg class="w-9 h-9 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor" stroke-width="2"/>
            <polygon points="10,9 16,12 10,15" fill="currentColor"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-blue-700 mb-2">Watch Facebook Video</h2>
        <p class="text-gray-600 mb-3">Coming soon: Watch Facebook videos and earn points on this platform!</p>
        <button class="mt-2 px-6 py-2 bg-blue-400 text-white font-semibold rounded-lg shadow" disabled>
          Coming Soon
        </button>
      </div>
    </div>
  </main>
  <!-- Ad Modal -->
  <div id="adModal" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,0.92);width:100vw;height:100vh;align-items:center;justify-content:center;">
    <div class="w-full h-full flex flex-col justify-center items-center">
      <iframe id="adIframe"
        src="https://nevillequery.com/aphb8wa4g?key=e33b11641a201e15c5c4c5343e791af6"
        style="width:100vw;height:85vh;border:none;background:#fff;border-radius:0;">
      </iframe>
      <div style="width:100vw;text-align:center;background:#fff;padding:18px 0 8px 0;font-size:1.2em;">
        <span id="adCountdown" style="font-size:1.5em;font-weight:700;color:#6366f1;">20</span>
        <button id="adCancelBtn" style="display:none;margin-left:18px;padding:6px 24px;background:#eee;border-radius:8px;font-size:1em;">Cancel</button>
        <div style="font-size:0.99em;color:#888;margin-top:10px;">Stay on the ad for <span id="adSeconds">20</span> seconds to earn points.</div>
      </div>
    </div>
  </div>
  <!-- Toast Notification -->
  <div id="toast" class="hidden fixed bottom-7 right-7 z-[9999] bg-emerald-600 text-white px-6 py-3 rounded-lg shadow-lg text-base font-semibold transition-opacity duration-300"></div>
  <script>
    const API_BASE = "https://examguide.onrender.com";
    const SMARTLINK_URL = "https://nevillequery.com/aphb8wa4g?key=e33b11641a201e15c5c4c5343e791af6";

    // Toast
    function showToast(message, type = "success") {
      var toast = document.getElementById('toast');
      if (!toast) return;
      toast.className = 'fixed bottom-7 right-7 z-[9999] px-6 py-3 rounded-lg shadow-lg text-base font-semibold transition-opacity duration-300';
      toast.classList.add(type === "success" ? 'bg-emerald-600' : 'bg-red-600');
      toast.classList.remove(type === "success" ? 'bg-red-600' : 'bg-emerald-600');
      toast.textContent = message;
      toast.style.opacity = 1;
      toast.classList.remove('hidden');
      setTimeout(() => {
        toast.style.opacity = 0;
        setTimeout(() => { toast.classList.add('hidden'); }, 350);
      }, 2600);
    }

    // Ad Modal Logic (copy/adapted from practice-result.html)
    let adModalTimer = null, adModalCountdown = 20, adModalProceedCallback = null;
    function showAdModal(proceedCallback) {
      adModalProceedCallback = proceedCallback;
      adModalCountdown = 20;
      document.getElementById("adIframe").src = SMARTLINK_URL;
      document.getElementById("adModal").style.display = "flex";
      document.getElementById("adCountdown").textContent = adModalCountdown;
      document.getElementById("adSeconds").textContent = adModalCountdown;
      document.getElementById("adCancelBtn").style.display = "none";
      clearInterval(adModalTimer);
      adModalTimer = setInterval(() => {
        adModalCountdown--;
        document.getElementById("adCountdown").textContent = adModalCountdown;
        document.getElementById("adSeconds").textContent = adModalCountdown;
        if (adModalCountdown <= 10) {
          document.getElementById("adCancelBtn").style.display = "inline-block";
        }
        if (adModalCountdown <= 0) {
          closeAdModal(true);
        }
      }, 1000);
    }
    function closeAdModal(proceed) {
      clearInterval(adModalTimer);
      document.getElementById("adModal").style.display = "none";
      document.getElementById("adIframe").src = "";
      if (proceed && typeof adModalProceedCallback === "function") {
        adModalProceedCallback();
        adModalProceedCallback = null;
      }
    }
    document.getElementById("adCancelBtn").onclick = function() {
      closeAdModal(false);
    };

    // Watch Ad button logic
    document.getElementById("watchAdBtn").onclick = function() {
      // Check for login/token
      const token = localStorage.getItem('token');
      if (!token || typeof token !== "string" || token.length < 10) {
        showToast("Please login to earn points.", "error");
        setTimeout(() => { window.location.href = "mock.html"; }, 1500);
        return;
      }
      // Show Ad Modal
      showAdModal(async () => {
        // After 20s, assign random points 0.5 - 5.0 (rounded to 1dp)
        const points = Math.round((Math.random() * 4.5 + 0.5) * 10) / 10;
        try {
          const res = await fetch(`${API_BASE}/api/rewards/bonus`, {
            method: "POST",
            headers: {
              "Authorization": "Bearer " + token,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              points,
              reason: "Watched Ad on earn-more"
            })
          });
          const data = await res.json();
          if (res.ok && data.awarded) {
            showToast(`ðŸŽ‰ You earned +${points} credit point${points !== 1 ? "s" : ""}!`, "success");
          } else {
            showToast(data.error || "Failed to assign points.", "error");
          }
        } catch {
          showToast("Network error. Please try again.", "error");
        }
      });
    };
  </script>
</body>
</html>
