<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=0.85">
<title>OAU ExamGuard - Reset Password</title>
<link rel="icon" type="image/png" href="logo.png" />
<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
:root {
    --primary: #276EF1;
    --accent: #003366;
    --error: #e74c3c;
    --success: #27ae60;
    --background: #f5f7fa;
    --card-bg: #fff;
    --shadow: 0 6px 32px 0 rgba(39,110,241,.11), 0 1.5px 4px 0 rgba(39,110,241,.03);
    --radius: 20px;
    --modal-bg: #fff;
    --modal-backdrop: rgba(0,0,0,0.24);
}
* { box-sizing: border-box; }
body {
    margin: 0;
    padding: 0;
    font-family: 'Roboto', Arial, sans-serif;
    background: var(--background);
    min-height: 100vh;
}
.layout {
    display: flex;
    min-height: 100vh;
}
.sidebar-header {
    width: 340px;
    min-width: 250px;
    background: linear-gradient(135deg, #276EF1 0%, #003366 100%);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2.5rem 2rem 2rem 2rem;
    box-shadow: 0 4px 20px rgba(39,110,241,.10);
    z-index: 2;
}
.sidebar-header img {
    width: 90px;
    margin-bottom: 1.3rem;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    padding: 6px;
}
.sidebar-header h1 {
    font-size: 2.1rem;
    margin: 0 0 .4rem 0;
    font-weight: 900;
    letter-spacing: 1.5px;
    text-shadow: 0 1px 6px rgba(0,0,0,0.11);
    background: linear-gradient(90deg,#ffe46355,#276EF144 80%);
    border-radius: 12px;
    padding: .6rem 1rem;
    display: inline-block;
}
.sidebar-header p {
    font-size: 1.07rem;
    margin: 0 0 2.15rem 0;
    letter-spacing: .8px;
    opacity: 0.96;
}
.sidebar-header ul {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
}
.sidebar-header ul li {
    margin: 1.05rem 0;
    font-size: 1.07rem;
    display: flex;
    align-items: center;
    gap: 0.7rem;
    opacity: 0.97;
}
.sidebar-header ul li i {
    color: #ffe463;
    font-size: 1.32em;
}
.sidebar-header .support {
    margin-top: 2rem;
    font-size: .97rem;
    color: #e3e6ff;
    opacity: .84;
}
.main-content {
    flex: 1 1 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--background);
    min-width: 0;
    padding: 4vw 2vw;
}
.reset-card {
    width: 100%;
    max-width: 410px;
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 2.2rem 2rem 2rem 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin: 2vw 0;
    position: relative;
}
.reset-card .mini-logo {
    width: 50px;
    margin: 0 auto 0.2rem;
    display: block;
}
.reset-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: .5rem;
    text-align: center;
}
.reset-message {
    color: #1B428C;
    text-align: center;
    margin-bottom: 1.1rem;
    font-size: 1.07rem;
}
.form-group {
    margin-bottom: 1.2rem;
}
.form-group label {
    display: block;
    margin-bottom: .45rem;
    color: #222;
    font-weight: 600;
}
.form-group input {
    width: 100%;
    padding: .65rem .8rem;
    border: 1.5px solid #d6e0ef;
    border-radius: 8px;
    font-size: 1rem;
    background: #f8fbff;
    transition: border 0.2s, background 0.15s;
    outline: none;
    font-family: inherit;
}
.form-group input:focus {
    border-color: var(--primary);
    background: #fff;
}
.btn-primary {
    width: 100%;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: .93rem 0;
    font-size: 1.11rem;
    font-weight: 700;
    cursor: pointer;
    margin-top: .5rem;
    box-shadow: 0 2px 10px rgba(39,110,241,.09);
    transition: background 0.17s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.btn-primary:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
.btn-primary:hover, .btn-primary:focus {
    background: #1B428C;
}
.form-tip {
    color: #888;
    font-size: .93rem;
    margin-bottom: .8rem;
    margin-top: -.6rem;
}
@media (max-width:900px) {
    .layout { flex-direction: column; min-height: unset;}
    .sidebar-header {
        width: 100vw; min-width: 0; max-width: none;
        flex-direction: row; align-items: flex-start; justify-content: flex-start;
        padding: 1.1rem 1vw; box-shadow: none; border-radius: 0 0 18px 18px; gap: 1.4vw;
    }
    .sidebar-header > * { margin-bottom: 0 !important; }
    .sidebar-header img { width: 60px; margin: 0 1.4vw 0 0; padding: 3px;}
    .sidebar-header h1 { font-size: 1.52rem; margin-bottom: 0.18rem; padding: .4rem .5rem; background: linear-gradient(90deg,#ffe46333,#276EF133 80%); border-radius: 9px;}
    .main-content { padding: 4vw 1vw 2vw 1vw;}
}
html, body { height: 100%; overflow-x: hidden;}
.reset-card { min-width: 0;}
@media (max-width: 480px) {
    .reset-card { padding: .8rem .3rem 1.3rem .3rem; max-width: 99vw;}
    .sidebar-header { flex-direction: column; align-items: center; text-align: center; padding: 1.1rem 0.2rem; gap: 0.15rem;}
    .sidebar-header img { margin: 0 0 0.65rem 0; }
}
/* MODAL STYLES */
.modal-backdrop {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: var(--modal-backdrop);
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
}
.modal-backdrop.show { display: flex;}
.custom-modal {
    background: var(--modal-bg);
    border-radius: 22px;
    box-shadow: 0 8px 40px #00336633, 0 1.5px 4px #276EF1aa;
    max-width: 97vw;
    min-width: 300px;
    width: 100%;
    max-width: 390px;
    padding: 2.7rem 1.2rem 1.7rem 1.2rem;
    position: relative;
    text-align: center;
    animation: modalIn .5s;
    max-height: 90vh;
    overflow-y: auto;
}
@keyframes modalIn {
    from { opacity: 0; transform: scale(0.95);}
    to { opacity: 1; transform: scale(1);}
}
.custom-modal .modal-spinner {
    margin: 0 auto 18px auto;
}
.custom-modal .modal-status-icon {
    font-size: 2.7rem;
    margin-bottom: 0.7rem;
}
.custom-modal .modal-status-icon.success { color: var(--success);}
.custom-modal .modal-status-icon.error { color: var(--error);}
.custom-modal .modal-title {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--primary);
}
.custom-modal .modal-message {
    font-size: 1.07rem;
    margin-bottom: 1.1rem;
    color: #1B428C;
}
.custom-modal .modal-actions {
    margin-top: 1.3rem;
    display: flex;
    gap: .9rem;
    justify-content: center;
}
.custom-modal .modal-btn {
    padding: .67rem 1.2rem;
    border-radius: 10px;
    border: none;
    background: var(--primary);
    color: #fff;
    font-size: 1.07rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
    min-width: 110px;
}
.custom-modal .modal-btn.secondary {
    background: #f5f7fa;
    color: #003366;
    border: 1.5px solid #276EF1;
}
.custom-modal .close-modal {
    position: absolute;
    top: 11px;
    right: 15px;
    background: transparent;
    border: none;
    font-size: 1.8rem;
    color: #888;
    cursor: pointer;
    opacity: 0.7;
}
.custom-modal .close-modal:hover { opacity: 1;}
</style>
</head>
<body>
<div class="layout">
    <div class="sidebar-header">
        <img src="logo.png" alt="ExamGuard Logo" class="examguard-logo">
        <div>
            <h1>OAU ExamGuard</h1>
            <p>Your Exam, Our Priority</p>
            <ul>
                <li><i class="bi bi-shield-lock"></i> Secure exam sessions</li>
                <li><i class="bi bi-person-badge"></i> Verified student access</li>
                <li><i class="bi bi-graph-up-arrow"></i> Progress analytics</li>
                <li><i class="bi bi-phone"></i> Mobile friendly</li>
            </ul>
            <div class="support">
                <i class="bi bi-envelope"></i> Free email support
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="reset-card">
            <img class="mini-logo" src="logo.png" alt="OAU Logo">
            <div class="reset-title">Reset Your Password</div>
            <div class="reset-message">Enter your Student ID and new password below.</div>
            <form id="resetPasswordForm" autocomplete="off">
                <div class="form-group">
                    <label for="reset-studentid">Student ID</label>
                    <input type="text" id="reset-studentid" name="reset-studentid" required>
                </div>
                <div class="form-group">
                    <label for="reset-newpass">New Password</label>
                    <input type="password" id="reset-newpass" name="reset-newpass" required minlength="8">
                </div>
                <div class="form-group">
                    <label for="reset-confirmpass">Confirm New Password</label>
                    <input type="password" id="reset-confirmpass" name="reset-confirmpass" required minlength="8">
                </div>
                <button type="submit" class="btn-primary" id="doResetBtn">Reset Password</button>
            </form>
            <div class="form-tip" style="text-align:center;">
                Remember your password? <a href="mock.html" style="color:var(--primary);text-decoration:none;font-weight:600;">Return to Login</a>
            </div>
        </div>
    </div>
</div>
<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop">
    <div class="custom-modal" id="customModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <button class="close-modal" id="closeModalBtn" aria-label="Close modal">&times;</button>
        <div id="modalContent"></div>
    </div>
</div>
<script>
// UNIVERSAL MODAL SYSTEM (copied/adapted from original)
const modalBackdrop = document.getElementById('modalBackdrop');
const customModal = document.getElementById('customModal');
const modalContent = document.getElementById('modalContent');
const closeModalBtn = document.getElementById('closeModalBtn');

function openModal(contentHtml, allowClose = false) {
    modalContent.innerHTML = contentHtml;
    modalBackdrop.classList.add('show');
    if (allowClose) {
        closeModalBtn.style.display = 'block';
    } else {
        closeModalBtn.style.display = 'none';
    }
}
function closeModal() {
    modalBackdrop.classList.remove('show');
    modalContent.innerHTML = '';
}
closeModalBtn.onclick = closeModal;
modalBackdrop.addEventListener('click', function(e){
    if(e.target === modalBackdrop && closeModalBtn.style.display === 'block') closeModal();
});
function showLoadingModal(message="Please wait...", subMsg="Processing your request...") {
    openModal(`
        <div class="modal-spinner spinner"></div>
        <div class="modal-title">${message}</div>
        <div class="modal-message">${subMsg}</div>
    `);
}
function showStatusModal(type, title, msg, allowClose=true) {
    let icon = type === "success"
        ? '<span class="modal-status-icon success"><i class="bi bi-check-circle-fill"></i></span>'
        : '<span class="modal-status-icon error"><i class="bi bi-x-circle-fill"></i></span>';
    openModal(`
        ${icon}
        <div class="modal-title">${title}</div>
        <div class="modal-message">${msg}</div>
    `, allowClose);
}

// RESET PASSWORD LOGIC
document.getElementById('resetPasswordForm').onsubmit = async function(ev) {
    ev.preventDefault();
    const studentId = document.getElementById('reset-studentid').value.trim();
    const newPass = document.getElementById('reset-newpass').value;
    const confirmPass = document.getElementById('reset-confirmpass').value;

    if (!studentId || !newPass || !confirmPass) {
        showStatusModal("error", "Reset Error", "All fields are required.", true);
        return;
    }
    if (newPass !== confirmPass) {
        showStatusModal("error", "Reset Error", "Passwords do not match.", true);
        return;
    }
    if (newPass.length < 8) {
        showStatusModal("error", "Reset Error", "Password must be at least 8 characters.", true);
        return;
    }
    showLoadingModal("Resetting Password...", "Please wait...");
    try {
        const resp = await fetch('/api/auth/reset', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ studentId, password: newPass })
        });
        const data = await resp.json();
        if (resp.ok) {
            showStatusModal("success", "Success", data.message || "Password reset successful.", true);
        } else {
            showStatusModal("error", "Reset Error", data.message || "Failed to reset password.", true);
        }
    } catch (err) {
        showStatusModal("error", "Reset Error", "Server error. Please try again.", true);
    }
};
</script>
</body>
</html>
