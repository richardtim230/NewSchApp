<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<head>
  <meta charset="UTF-8" />
  <title>Marketplace — OAU ExamGuard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Flowbite (components) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
  <style>
    /* small custom utilities */
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
    .product-image { min-height: 160px; max-height: 220px; }
    /* subtle card hover */
    .card-hover:hover { transform: translateY(-6px); box-shadow: 0 8px 24px rgba(15,23,42,0.08); }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    /* hero image mask effect */
    .hero-gradient {
      background: linear-gradient(180deg, rgba(99,102,241,0.06), rgba(99,102,241,0));
      border-radius: 1rem;
    }
  </style>
</head>
<body class="h-full bg-gray-100 font-sans">

  <!-- Header -->
  <header class="fixed w-full z-40 top-0 left-0 bg-white border-b shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <button id="mobileMenuBtn" class="md:hidden p-2 rounded bg-indigo-600 text-white" aria-label="Open menu"
            onclick="document.getElementById('mobileSidebar').classList.toggle('-translate-x-full')">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
          </button>
          <div class="flex items-center gap-3">
            <img src="https://raw.githubusercontent.com/richardtim230/NewSchApp/main/oaugate-1140x570.jpg" alt="logo" class="w-10 h-10 rounded object-cover border" />
            <div>
              <div class="font-bold text-indigo-800">OAU ExamGuard</div>
              <div class="text-xs text-gray-500">Marketplace</div>
            </div>
          </div>
        </div>

        <div class="flex-1 px-4">
          <div class="max-w-3xl mx-auto relative">
            <input id="globalSearch" type="search" placeholder="Search products, categories or sellers..." class="w-full border rounded-lg pl-10 pr-4 py-2 focus:ring-indigo-300 focus:border-indigo-300" />
            <div class="absolute left-3 top-2.5 text-gray-400">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button id="ordersBtn" class="hidden md:inline-flex items-center gap-2 px-3 py-1 rounded bg-indigo-50 text-indigo-700" onclick="openOrders()">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7h18M3 12h18M3 17h18"/></svg>
            Orders
          </button>

          <button id="cartBtn" class="relative inline-flex items-center gap-2 px-3 py-1 rounded bg-indigo-600 text-white" onclick="toggleCartDrawer(true)">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4"/><circle cx="10" cy="20" r="1"/><circle cx="18" cy="20" r="1"/></svg>
            <span id="cartCountBadge" class="ml-1 bg-white text-indigo-700 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
          </button>

          <div class="relative">
            <button id="profileBtn" class="flex items-center gap-2 ml-2" onclick="toggleProfileDropdown()">
              <img id="headerProfilePic" src="https://ui-avatars.com/api/?name=Student&background=ede9fe&color=3b82f6&size=128&rounded=true" class="w-9 h-9 rounded-full border-2 border-indigo-600 object-cover"/>
            </button>
            <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded shadow-lg z-50">
              <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-50" onclick="switchSection('profile')">Profile</a>
              <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-50" onclick="switchSection('settings')">Settings</a>
              <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-indigo-50" onclick="logout()">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Sidebar -->
  <aside id="mobileSidebar" class="fixed z-50 top-0 left-0 bottom-0 w-64 bg-[#2852a0] text-white transform -translate-x-full md:hidden transition-transform duration-300 ease-in-out" style="background:linear-gradient(180deg,#2852a0 0%,#467ae6 100%);">
    <div class="h-full flex flex-col py-5">
      <div class="px-6 py-3 mb-2">
        <h2 class="font-bold text-2xl tracking-tight leading-tight mb-1">OAU ExamGuard</h2>
        <div class="text-xs text-white/80">Marketplace</div>
      </div>
      <nav class="mt-4 px-4">
        <ul class="flex flex-col gap-3 text-base">
          <li><button class="w-full text-left" onclick="switchSection('home',true)">Home</button></li>
          <li><button class="w-full text-left" onclick="switchSection('market',true)">Marketplace</button></li>
          <li><button class="w-full text-left" onclick="switchSection('orders',true)">Orders</button></li>
          <li><button class="w-full text-left" onclick="switchSection('settings',true)">Settings</button></li>
        </ul>
      </nav>
    </div>
  </aside>

  <main class="md:ml-0 pt-24 pb-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Hero Section (NEW) -->
      <section class="mb-6">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-center">
          <!-- Left: Content -->
          <div class="md:col-span-7">
            <div class="bg-white rounded-xl p-8 hero-gradient shadow-sm">
              <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-800 leading-tight">Everything students need to pass — in one marketplace</h1>
              <p class="mt-4 text-gray-600 text-lg">Discover exam packs, mock tests, study courses, and campus resources managed by trusted sellers. Fast downloads, test-like mocks, and course content to level up your results.</p>

              <!-- CTA row -->
              <div class="mt-6 flex flex-col sm:flex-row sm:items-center gap-3">
                <button class="inline-flex items-center gap-2 bg-indigo-600 text-white px-5 py-3 rounded-lg shadow hover:bg-indigo-700" onclick="switchSection('market')">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4"/></svg>
                  Explore Marketplace
                </button>
                <button class="inline-flex items-center gap-2 border border-indigo-200 text-indigo-700 px-5 py-3 rounded-lg hover:bg-indigo-50" onclick="window.location.href='seller-onboard.html'">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 2v4M20 12h-4M12 22v-4M4 12h4"/></svg>
                  Sell on ExamGuard
                </button>
                <a class="text-sm text-gray-500 ml-auto sm:ml-0" href="public-mocks.html">Try public mock tests →</a>
              </div>

              <!-- Search bar -->
              <div class="mt-6">
                <label for="heroSearch" class="sr-only">Search marketplace</label>
                <div class="relative">
                  <input id="heroSearch" class="w-full border rounded-lg pl-12 pr-4 py-3 focus:ring-indigo-300 focus:border-indigo-300" placeholder="Search mock tests, e-books, courses, sellers..." />
                  <div class="absolute left-4 top-3 text-gray-400">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
                  </div>
                </div>
              </div>

              <!-- Small stats -->
              <div class="mt-6 grid grid-cols-3 gap-4 text-center">
                <div>
                  <div class="text-2xl font-bold text-indigo-700">1.2k+</div>
                  <div class="text-xs text-gray-500">Products</div>
                </div>
                <div>
                  <div class="text-2xl font-bold text-indigo-700">30k+</div>
                  <div class="text-xs text-gray-500">Students helped</div>
                </div>
                <div>
                  <div class="flex items-center justify-center gap-1">
                    <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.122-6.545L.49 6.91l6.561-.955L10 0l2.949 5.955 6.561.955-4.754 4.635 1.122 6.545z"/></svg>
                    <div class="text-2xl font-bold text-indigo-700">4.8</div>
                  </div>
                  <div class="text-xs text-gray-500">Avg. rating</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right: Hero image -->
          <div class="md:col-span-5">
            <div class="relative">
              <img src="https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=1200&q=80" alt="Study together" class="w-full rounded-xl shadow-lg object-cover h-[340px]" />
              <div class="absolute bottom-4 left-4 bg-white/90 rounded-lg px-4 py-2 text-sm">
                <div class="font-semibold text-indigo-700">Top seller: ExamGuard Publications</div>
                <div class="text-xs text-gray-600">Best-selling PDF packs & mock bundles</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Quick Links (updated) -->
      <section class="mb-6">
        <div class="bg-white rounded-xl shadow px-3 py-4">
          <div class="w-full flex flex-wrap justify-center gap-3">
            <!-- Marketplace -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="switchSection('market')">
              <svg class="w-8 h-8 mb-1 text-indigo-700" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path d="M16 11V7a4 4 0 00-8 0v4M3 7h18l-1.5 12.5a2 2 0 01-2 1.5H6.5a2 2 0 01-2-1.5L3 7z"/>
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Marketplace</span>
            </button>

            <!-- Account Settings -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="switchSection('settings')">
              <svg class="w-8 h-8 mb-1 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 15.5A3.5 3.5 0 1012 8.5a3.5 3.5 0 000 7z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06A2 2 0 013.27 16.9l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82L4.21 4A2 2 0 016.9 1.27l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V1a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.01a1.65 1.65 0 001.82-.33l.06-.06A2 2 0 0119.79 4l-.06.06a1.65 1.65 0 00-.33 1.82V9c0 .4.13.78.36 1.11z" />
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Account Settings</span>
            </button>

            <!-- Request For Tutor -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="window.location.href='tutor-req.html'">
              <svg class="w-8 h-8 mb-1 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Request For Tutor</span>
            </button>

            <!-- Earnings -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="window.location.href='earnings.html'">
              <svg class="w-8 h-8 mb-1 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="9"/><path d="M8 12h8M12 8v8"/>
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Earnings</span>
            </button>

            <!-- Blog and Earn -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="window.location.href='#'">
              <svg class="w-8 h-8 mb-1 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Blog & Earn</span>
            </button>

            <!-- Public Mock Tests -->
            <button class="flex flex-col items-center justify-center w-24 h-24 md:w-28 md:h-28 rounded-lg border border-indigo-200 bg-indigo-50 hover:bg-indigo-100 transition shadow-sm card-hover"
              onclick="window.location.href='public-mocks.html'">
              <svg class="w-8 h-8 mb-1 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="9"/><path d="M2 12h20M12 2c2.21 4 2.21 8 0 12M12 22c2.21-4 2.21-8 0-12"/>
              </svg>
              <span class="text-xs md:text-sm font-semibold text-indigo-800 mt-1">Public Mock Tests</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Marketplace: Filters + Grid -->
      <section id="market" class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Filters -->
        <aside class="md:col-span-1">
          <div class="bg-white rounded-xl p-4 shadow">
            <h4 class="font-bold mb-3 text-indigo-700">Filters</h4>
            <label class="block text-sm text-gray-600 mb-1">Category</label>
            <select id="filterCategory" class="w-full border rounded px-3 py-2 mb-3">
              <option value="">All Categories</option>
            </select>

            <label class="block text-sm text-gray-600 mb-1">Price Range (₦)</label>
            <div class="flex gap-2 mb-3">
              <input id="priceMin" type="number" placeholder="Min" class="w-1/2 border rounded px-2 py-2" />
              <input id="priceMax" type="number" placeholder="Max" class="w-1/2 border rounded px-2 py-2" />
            </div>

            <label class="block text-sm text-gray-600 mb-1">Sort by</label>
            <select id="sortBy" class="w-full border rounded px-3 py-2 mb-3">
              <option value="featured">Featured</option>
              <option value="price-asc">Price: Low → High</option>
              <option value="price-desc">Price: High → Low</option>
              <option value="rating">Top rated</option>
            </select>

            <button id="clearFilters" class="w-full bg-indigo-50 text-indigo-700 px-3 py-2 rounded hover:bg-indigo-100">Clear filters</button>
          </div>
        </aside>

        <!-- Products grid -->
        <div class="md:col-span-3">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-indigo-700">Products</h3>
            <div class="text-sm text-gray-500" id="productsCount">0 products</div>
          </div>

          <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

          <div id="noResults" class="hidden text-center p-8 text-gray-500">No products found.</div>
        </div>
      </section>

      <!-- Profile / Settings / Orders area (switchable) -->
      <section id="rightPane" class="mt-8">
        <div id="profile-section" class="hidden bg-white rounded-xl p-6 shadow">
          <h3 class="text-lg font-bold text-indigo-700">Profile & Settings</h3>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm text-gray-600">Full name</label>
              <input id="profileFullName" class="w-full border rounded px-3 py-2" placeholder="Alex Student" />
            </div>
            <div>
              <label class="text-sm text-gray-600">Email</label>
              <input id="profileEmail" class="w-full border rounded px-3 py-2" placeholder="alex@example.com" />
            </div>
          </div>
          <div class="mt-4">
            <button class="bg-indigo-600 text-white px-4 py-2 rounded" onclick="saveProfile()">Save</button>
          </div>
        </div>

        <div id="orders-section" class="hidden bg-white rounded-xl p-6 shadow">
          <h3 class="text-lg font-bold text-indigo-700">Orders</h3>
          <div id="ordersList" class="mt-4 space-y-3"></div>
        </div>

        <div id="seller-section" class="hidden bg-white rounded-xl p-6 shadow">
          <div id="sellerViewContent"></div>
        </div>
      </section>

    </div>
  </main>

  <!-- Cart drawer (Flowbite) -->
  <div id="cartDrawer" class="fixed right-0 top-0 h-full w-full md:w-96 transform translate-x-full transition-transform z-50">
    <div class="absolute inset-0 bg-black bg-opacity-40" onclick="toggleCartDrawer(false)"></div>
    <aside class="absolute right-0 top-0 h-full w-full md:w-96 bg-white shadow-xl p-6 overflow-y-auto">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Your Cart</h3>
        <button onclick="toggleCartDrawer(false)" class="text-gray-500 hover:text-indigo-700">&times;</button>
      </div>
      <div id="cartItems" class="mt-4 space-y-4"></div>
      <div id="cartEmpty" class="mt-6 text-center text-gray-500">Your cart is empty.</div>

      <div class="mt-6 border-t pt-4">
        <div class="flex justify-between items-center mb-4">
          <div class="text-sm text-gray-600">Subtotal</div>
          <div id="cartSubtotal" class="text-lg font-bold text-indigo-700">₦0</div>
        </div>
        <div class="flex gap-2">
          <button class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded" onclick="openCheckout()">Checkout</button>
          <button class="flex-1 border rounded px-4 py-2 text-indigo-700" onclick="clearCart()">Clear</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Product modal (Flowbite) -->
  <div id="productModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50">
    <div class="bg-white rounded-xl max-w-4xl w-full mx-4 overflow-hidden">
      <div class="grid grid-cols-1 md:grid-cols-2">
        <div class="p-4">
          <div id="modalGallery" class="w-full h-64 rounded overflow-hidden bg-gray-100 flex items-center justify-center product-image">
            <img id="modalImage" src="" alt="Product image" class="w-full h-full object-cover"/>
          </div>
          <div id="modalThumbnails" class="flex gap-2 mt-3 overflow-x-auto hide-scrollbar"></div>
        </div>
        <div class="p-6">
          <div class="flex justify-between items-start">
            <div>
              <h4 id="modalTitle" class="font-bold text-xl text-indigo-700"></h4>
              <div id="modalSeller" class="text-sm text-gray-500 mt-1 cursor-pointer" onclick="openSellerView(currentProduct?.sellerId)"></div>
            </div>
            <div class="text-lg font-bold text-indigo-700" id="modalPrice"></div>
          </div>

          <div class="mt-4 text-gray-700" id="modalDescription"></div>

          <div class="mt-4">
            <label class="block text-sm text-gray-600 mb-1">Quantity</label>
            <div class="flex items-center gap-2">
              <button class="px-3 py-1 border rounded" onclick="changeModalQty(-1)">-</button>
              <input id="modalQty" type="number" min="1" value="1" class="w-16 text-center border rounded" />
              <button class="px-3 py-1 border rounded" onclick="changeModalQty(1)">+</button>
            </div>
          </div>

          <div class="mt-6 flex gap-3">
            <button class="bg-indigo-600 text-white px-4 py-2 rounded" onclick="addModalToCart()">Add to cart</button>
            <button class="border px-4 py-2 rounded" onclick="buyNow()">Buy now</button>
            <button class="ml-auto text-gray-500" onclick="closeProductModal()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout modal -->
  <div id="checkoutModal" class="hidden fixed inset-0 z-60 flex items-center justify-center bg-black/60">
    <div class="bg-white rounded-xl max-w-2xl w-full mx-4 p-6">
      <h3 class="font-bold text-indigo-700 text-lg">Checkout</h3>
      <form id="checkoutForm" class="mt-4 grid grid-cols-1 gap-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="checkoutName" placeholder="Full name" class="border rounded px-3 py-2" required />
          <input id="checkoutEmail" placeholder="Email" class="border rounded px-3 py-2" required />
        </div>
        <input id="checkoutAddress" placeholder="Shipping address" class="border rounded px-3 py-2" required />
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <input id="checkoutCity" placeholder="City" class="border rounded px-3 py-2" required />
          <input id="checkoutState" placeholder="State" class="border rounded px-3 py-2" />
          <input id="checkoutPostal" placeholder="Postal code" class="border rounded px-3 py-2" />
        </div>
        <div class="mt-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded" type="submit">Pay & Place order (mock)</button>
          <button type="button" class="ml-2 border px-4 py-2 rounded" onclick="closeCheckout()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Minimal footer -->
  <footer class="mt-10 text-center text-sm text-gray-500 pb-8">© ExamGuard Marketplace — Demo frontend</footer>

  <!-- Scripts: marketplace logic -->
  <script>
    // ---------- Mock Data ----------
    const mockProducts = [
      {
        id: 'p1',
        title: 'ExamGuard Complete Past Questions — 2010-2025 (PDF)',
        price: 2500,
        currency: 'NGN',
        rating: 4.8,
        images: [
          'https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=800&q=60',
          'https://images.unsplash.com/photo-1544716278-e513176f20b5?auto=format&fit=crop&w=800&q=60'
        ],
        category: 'E-Books',
        sellerId: 's1',
        sellerName: 'ExamGuard Publications',
        description: 'Comprehensive past questions for campus exams across departments. Instant PDF download after purchase.',
        featured: true
      },
      {
        id: 'p2',
        title: 'Mock Test Bundle — 10 timed mock tests',
        price: 1800,
        currency: 'NGN',
        rating: 4.6,
        images: [
          'https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=800&q=60'
        ],
        category: 'Mock Tests',
        sellerId: 's2',
        sellerName: 'MockMasters',
        description: 'Practice under timed conditions with detailed reports and explanations.',
        featured: true
      },
      {
        id: 'p3',
        title: 'Exam Strategy Course (video)',
        price: 4500,
        currency: 'NGN',
        rating: 4.9,
        images: [
          'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=800&q=60'
        ],
        category: 'Courses',
        sellerId: 's3',
        sellerName: 'Coach Alex',
        description: 'A 5-hour on-demand course teaching exam strategy and time management.',
        featured: false
      },
      // ... add more products as needed
    ];

    const sellers = {
      s1: { id: 's1', name: 'ExamGuard Publications', about: 'Official ExamGuard content team. PDFs & study packs.' },
      s2: { id: 's2', name: 'MockMasters', about: 'High-quality mock tests with analytics.' },
      s3: { id: 's3', name: 'Coach Alex', about: 'Study coach and course author.' }
    };

    // ---------- App state ----------
    let products = mockProducts.slice();
    let cart = JSON.parse(localStorage.getItem('eg_cart') || '[]');
    let orders = JSON.parse(localStorage.getItem('eg_orders') || '[]');
    let currentProduct = null;

    // ---------- Utilities ----------
    function formatCurrency(n) { return '₦' + n.toLocaleString(); }
    function saveCart() { localStorage.setItem('eg_cart', JSON.stringify(cart)); updateCartUI(); }
    function saveOrders() { localStorage.setItem('eg_orders', JSON.stringify(orders)); }
    function toggleProfileDropdown() {
      document.getElementById('profileDropdown').classList.toggle('hidden');
    }
    function switchSection(section, mobile) {
      // hide all
      document.getElementById('profile-section').classList.add('hidden');
      document.getElementById('orders-section').classList.add('hidden');
      document.getElementById('seller-section').classList.add('hidden');
      // show requested
      if (section === 'settings' || section === 'profile') {
        document.getElementById('profile-section').classList.remove('hidden');
        window.scrollTo({top: 400, behavior: 'smooth'});
      } else if (section === 'orders') {
        openOrders();
      } else if (section === 'market' || section === 'home') {
        // nothing special; scroll up
        window.scrollTo({top: 0, behavior: 'smooth'});
        // optional: highlight marketplace area
      }
      // close mobile sidebar if asked
      if (mobile) document.getElementById('mobileSidebar').classList.add('-translate-x-full');
    }
    function logout() {
      alert('Demo: logged out (no backend). Refresh to simulate new session.');
    }

    // ---------- Product rendering ----------
    function populateFilterOptions() {
      const cats = Array.from(new Set(products.map(p => p.category)));
      const sel = document.getElementById('filterCategory');
      sel.innerHTML = '<option value="">All Categories</option>';
      cats.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function renderProducts(list) {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = '';
      if (!list.length) {
        document.getElementById('noResults').classList.remove('hidden');
        document.getElementById('productsCount').textContent = '0 products';
        return;
      } else {
        document.getElementById('noResults').classList.add('hidden');
        document.getElementById('productsCount').textContent = `${list.length} products`;
      }
      list.forEach(p => {
        const el = document.createElement('div');
        el.className = 'bg-white rounded-xl overflow-hidden shadow-sm p-3 flex flex-col card-hover transition-transform';
        el.innerHTML = `
          <div class="relative rounded overflow-hidden product-image">
            <img src="${p.images?.[0] || ''}" alt="${p.title}" class="w-full h-full object-cover" />
            <div class="absolute top-2 right-2 bg-white/80 text-xs rounded px-2 py-1 text-indigo-700">${p.rating} ★</div>
          </div>
          <div class="mt-3 flex-1">
            <h4 class="font-semibold text-indigo-700 text-sm">${p.title}</h4>
            <div class="text-xs text-gray-500 mt-1 line-clamp-2">${p.description}</div>
          </div>
          <div class="mt-3 flex items-center justify-between">
            <div class="text-indigo-700 font-bold">${formatCurrency(p.price)}</div>
            <div class="flex items-center gap-2">
              <button class="text-sm text-indigo-600 border px-3 py-1 rounded" onclick="openProductModal('${p.id}')">View</button>
              <button class="text-sm bg-indigo-600 text-white px-3 py-1 rounded" onclick="addToCart('${p.id}')">Add</button>
            </div>
          </div>
        `;
        grid.appendChild(el);
      });
    }

    // ---------- Filtering & search ----------
    function applyFilters() {
      const q = (document.getElementById('globalSearch').value || '').toLowerCase();
      const cat = document.getElementById('filterCategory').value;
      const min = parseFloat(document.getElementById('priceMin').value || 0);
      const maxVal = document.getElementById('priceMax').value;
      const max = maxVal ? parseFloat(maxVal) : Infinity;
      const sort = document.getElementById('sortBy').value;

      let out = products.filter(p => {
        const matchesQ = !q || (p.title + ' ' + p.description + ' ' + p.sellerName).toLowerCase().includes(q);
        const matchesCat = !cat || p.category === cat;
        const matchesPrice = p.price >= min && p.price <= max;
        return matchesQ && matchesCat && matchesPrice;
      });

      if (sort === 'price-asc') out.sort((a,b)=>a.price-b.price);
      else if (sort === 'price-desc') out.sort((a,b)=>b.price-a.price);
      else if (sort === 'rating') out.sort((a,b)=>b.rating-a.rating);
      else out.sort((a,b)=> (b.featured?1:0) - (a.featured?1:0));

      renderProducts(out);
    }

    // ---------- Cart ----------
    function updateCartUI() {
      const cnt = cart.reduce((s,i)=>s+i.qty,0);
      document.getElementById('cartCountBadge').textContent = cnt;
      const itemsEl = document.getElementById('cartItems');
      const cartEmpty = document.getElementById('cartEmpty');

      if (!cart.length) {
        itemsEl.innerHTML = '';
        cartEmpty.classList.remove('hidden');
      } else {
        cartEmpty.classList.add('hidden');
        itemsEl.innerHTML = '';
        cart.forEach(ci => {
          const p = products.find(x=>x.id===ci.id) || {};
          const row = document.createElement('div');
          row.className = 'flex items-center gap-3';
          row.innerHTML = `
            <img src="${p.images?.[0]||''}" class="w-14 h-14 rounded object-cover" />
            <div class="flex-1">
              <div class="font-semibold text-sm">${p.title}</div>
              <div class="text-xs text-gray-500">${formatCurrency(p.price)} × ${ci.qty}</div>
            </div>
            <div class="flex flex-col items-end gap-2">
              <div class="text-sm font-bold">${formatCurrency(p.price*ci.qty)}</div>
              <div class="flex gap-1">
                <button class="px-2 py-1 border rounded text-sm" onclick="changeCartQty('${ci.id}', -1)">-</button>
                <button class="px-2 py-1 border rounded text-sm" onclick="changeCartQty('${ci.id}', 1)">+</button>
                <button class="px-2 py-1 text-red-600" onclick="removeFromCart('${ci.id}')">Remove</button>
              </div>
            </div>
          `;
          itemsEl.appendChild(row);
        });
      }

      const subtotal = cart.reduce((s,i)=> {
        const p = products.find(x=>x.id===i.id) || {price:0};
        return s + (p.price * i.qty);
      }, 0);
      document.getElementById('cartSubtotal').textContent = formatCurrency(subtotal);
      document.getElementById('cartCountBadge').dataset.count = cnt;
    }

    function addToCart(productId, qty=1) {
      const idx = cart.findIndex(c=>c.id===productId);
      if (idx >= 0) cart[idx].qty += qty;
      else cart.push({ id: productId, qty: qty });
      saveCart();
      toggleCartDrawer(true);
    }

    function changeCartQty(productId, delta) {
      const idx = cart.findIndex(c=>c.id===productId);
      if (idx < 0) return;
      cart[idx].qty += delta;
      if (cart[idx].qty <= 0) cart.splice(idx,1);
      saveCart();
    }

    function removeFromCart(id) {
      cart = cart.filter(c=>c.id!==id);
      saveCart();
    }

    function clearCart() {
      if (!confirm('Clear cart?')) return;
      cart = [];
      saveCart();
    }

    function toggleCartDrawer(show) {
      const d = document.getElementById('cartDrawer');
      if (show) {
        d.classList.remove('translate-x-full');
        d.classList.add('!translate-x-0');
      } else {
        d.classList.add('translate-x-full');
        d.classList.remove('!translate-x-0');
      }
      updateCartUI();
    }

    // ---------- Product modal ----------
    function openProductModal(id) {
      const p = products.find(x=>x.id===id);
      if (!p) return;
      currentProduct = p;
      document.getElementById('modalImage').src = p.images?.[0] || '';
      document.getElementById('modalTitle').textContent = p.title;
      document.getElementById('modalDescription').textContent = p.description;
      document.getElementById('modalPrice').textContent = formatCurrency(p.price);
      document.getElementById('modalSeller').textContent = 'By ' + (p.sellerName || 'Unknown seller');
      document.getElementById('modalQty').value = 1;

      // thumbnails
      const thumbs = document.getElementById('modalThumbnails');
      thumbs.innerHTML = '';
      (p.images || []).forEach((src,i) => {
        const t = document.createElement('img');
        t.src = src;
        t.className = 'w-20 h-14 object-cover rounded cursor-pointer border';
        t.onclick = ()=> document.getElementById('modalImage').src = src;
        thumbs.appendChild(t);
      });

      document.getElementById('productModal').classList.remove('hidden');
    }

    function closeProductModal() {
      document.getElementById('productModal').classList.add('hidden');
    }

    function changeModalQty(delta) {
      const el = document.getElementById('modalQty');
      let val = parseInt(el.value || '1');
      val = Math.max(1, val + delta);
      el.value = val;
    }

    function addModalToCart() {
      const qty = parseInt(document.getElementById('modalQty').value || '1');
      addToCart(currentProduct.id, qty);
      closeProductModal();
    }

    function buyNow() {
      // quick checkout: add and open checkout
      const qty = parseInt(document.getElementById('modalQty').value || '1');
      addToCart(currentProduct.id, qty);
      closeProductModal();
      openCheckout();
    }

    // ---------- Seller view ----------
    function openSellerView(sellerId) {
      const s = sellers[sellerId];
      if (!s) return alert('Seller not found');
      const pane = document.getElementById('sellerViewContent');
      pane.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="w-20 h-20 rounded bg-indigo-50 flex items-center justify-center text-indigo-700 font-bold">${s.name.split(' ').map(n=>n[0]).slice(0,2).join('')}</div>
          <div>
            <h4 class="font-bold text-indigo-700">${s.name}</h4>
            <div class="text-sm text-gray-600">${s.about || ''}</div>
          </div>
        </div>
        <div class="mt-4">
          <h5 class="font-semibold">Products from ${s.name}</h5>
          <div id="sellerProducts" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
          <div class="mt-4">
            <button class="bg-indigo-600 text-white px-4 py-2 rounded" onclick="switchSection('market')">Back to marketplace</button>
          </div>
        </div>
      `;
      // render seller products
      const sp = products.filter(p=>p.sellerId===sellerId);
      const spEl = document.getElementById('sellerProducts');
      spEl.innerHTML = '';
      sp.forEach(p => {
        const el = document.createElement('div');
        el.className = 'p-3 bg-gray-50 rounded';
        el.innerHTML = `
          <div class="font-semibold text-sm text-indigo-700">${p.title}</div>
          <div class="text-xs text-gray-600">${formatCurrency(p.price)}</div>
          <div class="mt-2"><button class="text-sm text-indigo-600" onclick="openProductModal('${p.id}')">View</button></div>
        `;
        spEl.appendChild(el);
      });

      // show seller section
      document.getElementById('profile-section').classList.add('hidden');
      document.getElementById('orders-section').classList.add('hidden');
      document.getElementById('seller-section').classList.remove('hidden');
      window.scrollTo({top: 400, behavior: 'smooth'});
    }

    // ---------- Checkout & orders ----------
    function openCheckout() {
      toggleCartDrawer(false);
      document.getElementById('checkoutModal').classList.remove('hidden');
    }

    function closeCheckout() {
      document.getElementById('checkoutModal').classList.add('hidden');
    }

    document.getElementById('checkoutForm').addEventListener('submit', function(e) {
      e.preventDefault();
      if (!cart.length) return alert('Your cart is empty');
      const name = document.getElementById('checkoutName').value;
      const email = document.getElementById('checkoutEmail').value;
      const addr = document.getElementById('checkoutAddress').value;
      // build order
      const order = {
        id: 'ord_' + Date.now(),
        createdAt: new Date().toISOString(),
        name, email, addr,
        items: cart.map(ci=>({
          id: ci.id,
          qty: ci.qty,
          product: products.find(p=>p.id===ci.id)
        })),
        total: cart.reduce((s,i)=> {
          const p = products.find(x=>x.id===i.id) || {price:0};
          return s + p.price * i.qty;
        }, 0),
        status: 'Placed (mock)'
      };
      orders.unshift(order);
      saveOrders();
      cart = [];
      saveCart();
      closeCheckout();
      alert('Order placed (mock). Order id: ' + order.id);
      openOrders();
    });

    function openOrders() {
      document.getElementById('orders-section').classList.remove('hidden');
      document.getElementById('profile-section').classList.add('hidden');
      document.getElementById('seller-section').classList.add('hidden');
      const list = document.getElementById('ordersList');
      list.innerHTML = '';
      if (!orders.length) {
        list.innerHTML = '<div class="text-gray-500">No orders yet.</div>';
        return;
      }
      orders.forEach(o => {
        const el = document.createElement('div');
        el.className = 'p-3 border rounded mb-2';
        el.innerHTML = `
          <div class="flex justify-between">
            <div>
              <div class="font-semibold text-indigo-700">Order ${o.id}</div>
              <div class="text-xs text-gray-500">${new Date(o.createdAt).toLocaleString()}</div>
            </div>
            <div class="text-indigo-700 font-bold">${formatCurrency(o.total)}</div>
          </div>
          <div class="mt-2">
            <div class="text-sm text-gray-600">Status: ${o.status}</div>
            <div class="text-sm text-gray-600">Items: ${o.items.length}</div>
          </div>
        `;
        list.appendChild(el);
      });
      window.scrollTo({top: 400, behavior: 'smooth'});
    }

    // ---------- Profile ----------
    function saveProfile() {
      const name = document.getElementById('profileFullName').value;
      const email = document.getElementById('profileEmail').value;
      localStorage.setItem('eg_profile', JSON.stringify({name,email}));
      alert('Profile saved (local only).');
    }

    // ---------- Initialization ----------
    function init() {
      populateFilterOptions();
      renderProducts(products);
      updateCartUI();

      // restore profile
      const prof = JSON.parse(localStorage.getItem('eg_profile') || 'null');
      if (prof) {
        document.getElementById('profileFullName').value = prof.name || '';
        document.getElementById('profileEmail').value = prof.email || '';
        if (prof.name) document.getElementById('headerProfilePic').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(prof.name)}&background=ede9fe&color=3b82f6&size=128&rounded=true`;
      }

      // wire events
      document.getElementById('globalSearch').addEventListener('input', debounce(applyFilters, 250));
      document.getElementById('filterCategory').addEventListener('change', applyFilters);
      document.getElementById('priceMin').addEventListener('input', debounce(applyFilters, 250));
      document.getElementById('priceMax').addEventListener('input', debounce(applyFilters, 250));
      document.getElementById('sortBy').addEventListener('change', applyFilters);
      document.getElementById('clearFilters').addEventListener('click', () => {
        document.getElementById('filterCategory').value = '';
        document.getElementById('priceMin').value = '';
        document.getElementById('priceMax').value = '';
        document.getElementById('sortBy').value = 'featured';
        document.getElementById('globalSearch').value = '';
        applyFilters();
      });

      // wire hero search to main search
      const hero = document.getElementById('heroSearch');
      if (hero) hero.addEventListener('input', debounce(() => {
        document.getElementById('globalSearch').value = hero.value;
        applyFilters();
      }, 250));

      // initial filters apply
      applyFilters();
    }

    // ---------- Helpers ----------
    function debounce(fn, ms=200){ let t; return (...a)=>{ clearTimeout(t); t = setTimeout(()=>fn(...a), ms); }; }

    // ---------- Cart persistence on load ----------
    window.addEventListener('load', init);
  </script>
</body>
</html>
