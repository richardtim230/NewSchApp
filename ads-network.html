<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Ad Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #ad-container {
      height: 100%;
      min-height: 100vh;
      width: 100vw;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #ad-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ad-actions-bar {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      padding-bottom: max(env(safe-area-inset-bottom), 1.5rem);
      background: linear-gradient(to top, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0));
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 10;
      width: 100%;
    }
    .ad-actions-btns {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .ad-meta {
      color: #fff;
      text-align: center;
      margin-bottom: 1.2rem;
      text-shadow: 0 1px 6px #000b;
    }
    .ad-title {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .ad-desc {
      font-size: 1rem;
      opacity: .85;
    }
    .ad-img-full {
  width: auto;
  height: auto;
  object-fit: auto;
transform: scale(1.05);
  object-position: center;
  display: block;
  position: absolute;
  top: 0; left: 0;
  z-index: 1;
  background: #000; /* avoid gray borders */
  user-select: none;
  -webkit-user-drag: none;
}

        
    @media (max-width: 600px) {
      .ad-title { font-size: 1.05rem; }
      .ad-desc { font-size: 0.92rem; }
      .ad-actions-bar { padding-bottom: max(env(safe-area-inset-bottom), .5rem);}
    }
  </style>
</head>
<body class="overflow-hidden">
  <div id="ad-container"></div>
  <script>
    // Fallback sample ads
    const sampleAds = [
      {
        type: "image",
        content: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=1200",
        actions: [
          { type: "download", label: "Download", url: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=1200" },
          { type: "visit", label: "Visit Site", url: "https://unsplash.com/photos/Jztmx9yqjBw" },
          { type: "share", label: "Share" }
        ],
        meta: {
          title: "Explore the Mountains!",
          description: "Adventure awaits. Discover breathtaking views."
        }
      },
      {
        type: "url",
        content: "https://www.mozilla.org/en-US/firefox/new/",
        actions: [],
        meta: {
          title: "Fast, Private & Secure Browser",
          description: "Get Firefox now!"
        }
      },
      {
        type: "video",
        content: "https://www.w3schools.com/html/mov_bbb.mp4",
        actions: [
          { type: "visit", label: "Learn More", url: "https://www.w3schools.com/html/html5_video.asp" }
        ],
        meta: {
          title: "HTML5 Video Ad",
          description: "Watch this quick video ad!"
        }
      },
      {
        type: "html",
        content: `<div class="bg-gradient-to-r from-yellow-400 to-pink-400 rounded-lg p-6 shadow-lg h-full flex flex-col items-center justify-center">
          <h2 class="text-3xl font-bold text-white mb-2">Flash Sale!</h2>
          <p class="text-white mb-3">Save up to <span class="font-extrabold">60%</span> only today.</p>
          <a href="https://example.com/sale" target="_blank" class="inline-block px-5 py-2 bg-white text-pink-600 rounded font-bold shadow hover:bg-gray-100">Shop Sale</a>
        </div>`,
        actions: [],
        meta: {}
      },
      {
        type: "text",
        content: "Unlock premium features now and boost your productivity!",
        actions: [
          { type: "visit", label: "Upgrade", url: "https://example.com/upgrade" }
        ],
        meta: {
          title: "Go Premium"
        }
      }
    ];

    async function fetchRandomAdFromBackend() {
      try {
        const res = await fetch('https://examguard-jmvj.onrender.com/api/random-ad');
        if (!res.ok) throw new Error("No ad");
        const ad = await res.json();
        return ad;
      } catch {
        return null;
      }
    }

    async function loadRandomAd() {
      setLoading(true);
      let ad = await fetchRandomAdFromBackend();
      if (!ad) {
        // Fallback to a random sample ad
        ad = sampleAds[Math.floor(Math.random() * sampleAds.length)];
      }
      setLoading(false);

      // Handle redirect for URL ads
      if (ad.type === 'url') {
        window.location.href = ad.content;
        return;
      }

      // Render ad types
      switch (ad.type) {
        case 'image': return renderImageAd(ad);
        case 'video': return renderVideoAd(ad);
        case 'html':  return renderHtmlAd(ad);
        case 'text':  return renderTextAd(ad);
        default:      showError('Unknown ad type.');
      }
    }

    function setLoading(loading) {
      const c = document.getElementById('ad-container');
      c.innerHTML = loading
        ? `<div class="flex flex-col items-center justify-center h-full w-full" style="min-height:100vh;">
             <div class="animate-spin h-14 w-14 border-4 border-blue-400 border-t-transparent rounded-full mb-5"></div>
             <span class="text-white font-semibold text-xl drop-shadow">Loading Ad...</span>
           </div>`
        : "";
    }

    function showError(msg) {
      const c = document.getElementById('ad-container');
      c.innerHTML = `<div class="text-red-600 text-center py-12 text-2xl font-bold">${msg}</div>`;
    }

    function renderImageAd(ad) {
      const c = document.getElementById('ad-container');
      c.innerHTML = `
        <img src="${ad.content}" alt="Ad Image" class="ad-img-full" loading="eager" draggable="false" />
        <div class="ad-actions-bar">
          <div class="ad-actions-btns">
            ${(ad.actions || []).map(renderActionButton).join('')}
          </div>
          <div class="ad-meta">
            <div class="ad-title">${ad.meta?.title || ''}</div>
            <div class="ad-desc">${ad.meta?.description || ''}</div>
          </div>
        </div>
      `;
    }

    function renderVideoAd(ad) {
      const c = document.getElementById('ad-container');
      c.innerHTML = `
        <video controls autoplay class="ad-img-full" style="background:#111;">
          <source src="${ad.content}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div class="ad-actions-bar">
          <div class="ad-actions-btns">
            ${(ad.actions || []).map(renderActionButton).join('')}
          </div>
          <div class="ad-meta">
            <div class="ad-title">${ad.meta?.title || ''}</div>
            <div class="ad-desc">${ad.meta?.description || ''}</div>
          </div>
        </div>
      `;
    }

    function renderHtmlAd(ad) {
      const c = document.getElementById('ad-container');
      c.innerHTML = `<div style="width:100vw;height:100vh;overflow:auto;display:flex;align-items:center;justify-content:center;">${ad.content}</div>`;
    }

    function renderTextAd(ad) {
      const c = document.getElementById('ad-container');
      c.innerHTML = `
        <div class="flex flex-col h-full w-full items-center justify-center bg-gradient-to-br from-blue-700 via-gray-900 to-black">
          <div class="ad-meta mb-6">
            <div class="ad-title">${ad.meta?.title || ''}</div>
            <div class="ad-desc">${ad.content}</div>
          </div>
          <div class="ad-actions-btns">
            ${(ad.actions || []).map(renderActionButton).join('')}
          </div>
        </div>
      `;
    }

    function renderActionButton(action) {
      switch (action.type) {
        case 'download':
          return `<a href="${action.url || '#'}" download class="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow transition">${action.label || 'Download'}</a>`;
        case 'visit':
          return `<a href="${action.url}" target="_blank" rel="noopener" class="px-5 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow transition">${action.label || 'Visit'}</a>`;
        case 'share':
          return `<button onclick="shareAd()" class="px-5 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold shadow transition">${action.label || 'Share'}</button>`;
        default:
          return '';
      }
    }

    window.shareAd = function() {
      if (navigator.share) {
        navigator.share({
          title: document.title,
          text: 'Check out this ad!',
          url: window.location.href
        });
      } else {
        alert('Your browser does not support Web Share.');
      }
    };

    loadRandomAd();
  </script>
</body>
</html>
