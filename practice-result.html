<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Practice Result Summary</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .result-card { border-left: 4px solid #2563eb; background: #fff; box-shadow: 0 2px 16px #2563eb22; margin-bottom: 2rem; }
    .option { background: #f8fafc; color: #222; }
    .option.selected { border: 2px solid #2563eb; background: #e0e7ff; font-weight: bold; color: #2563eb; }
    .option.correct { border: 2px solid #16a34a; background: #dcfce7; color: #16a34a; font-weight: bold; }
    .option.incorrect { border: 2px solid #dc2626; background: #fee2e2; color: #dc2626; font-weight: bold; }
    .explanation { background: #f1f5f9; border-left: 4px solid #6366f1; padding: 1rem; margin-top: 1.2rem; border-radius: 0.7rem; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-white min-h-screen">
  <main class="max-w-2xl mx-auto px-3 py-10">
    <h1 class="text-3xl font-bold text-blue-900 mb-5">Practice Result Summary</h1>
    <div id="scoreSummary" class="mb-6"></div>
    <div id="cardsContainer"></div>
    <button onclick="window.location.href='tpp.html'" class="mt-8 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold">Retake Practice</button>
  </main>
  <script>
    const result = JSON.parse(localStorage.getItem("practiceResult") || "{}");
    const questions = JSON.parse(localStorage.getItem("practiceQuestions") || "[]");
    const answers = JSON.parse(localStorage.getItem("practiceAnswers") || "{}");

    // Show score summary
    document.getElementById("scoreSummary").innerHTML = `
      <div class="p-4 bg-blue-100 rounded-xl font-bold text-lg text-blue-900">
        Score: ${result.score || 0} / ${result.total || questions.length}
        <span class="ml-3 text-gray-700 font-semibold">Accuracy: ${Math.round(((result.score||0)/(result.total||questions.length))*100)}%</span>
      </div>
    `;

    // Render question cards
    const container = document.getElementById("cardsContainer");
    questions.forEach((q, i) => {
      const userAnswer = answers[q._id] || null;
      const correctAnswer = result.correctChoices?.[q._id] || q.correctAnswer || null;
      const explanation = q.explanation || result.explanations?.[q._id] || "No explanation provided.";
      let answeredClass = "";
      let feedbackText = "";
      // Option rendering
      let optsHtml = (q.options || q.choices || []).map(opt => {
        let cls = "option";
        if (opt === correctAnswer) cls += " correct";
        if (opt === userAnswer && userAnswer !== correctAnswer) cls += " incorrect";
        if (opt === userAnswer && userAnswer === correctAnswer) cls += " selected";
        return `<div class="${cls} rounded px-4 py-2 mb-2">${opt}</div>`;
      }).join('');
      // Feedback
      if (!userAnswer) {
        feedbackText = `<div class="text-red-600 font-medium mb-2">You did not answer this question.</div>`;
      } else if (userAnswer === correctAnswer) {
        feedbackText = `<div class="text-green-700 font-medium mb-2">Correct!</div>`;
      } else {
        feedbackText = `<div class="text-red-600 font-medium mb-2">Incorrect. Your Answer: <span class="font-semibold">${userAnswer}</span></div>`;
      }
      container.innerHTML += `
        <div class="result-card rounded-xl border-l-4 border-blue-500 bg-white shadow p-4 mb-6">
          <div class="font-bold text-lg mb-2">Q${i+1}: ${q.text || q.question || ""}</div>
          <div class="mb-2">${optsHtml}</div>
          ${feedbackText}
          <div class="explanation">
            <span class="font-bold text-blue-900">Explanation:</span>
            <span class="text-blue-900">${explanation}</span>
          </div>
        </div>
      `;
    });
  </script>
</body>
</html>
