<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Practice Result Summary</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .result-card { border-left: 4px solid #2563eb; background: #fff; box-shadow: 0 2px 16px #2563eb22; margin-bottom: 2rem; }
    .option { background: #f8fafc; color: #222; }
    .option.selected { border: 2px solid #2563eb; background: #e0e7ff; font-weight: bold; color: #2563eb; }
    .option.correct { border: 2px solid #16a34a; background: #dcfce7; color: #16a34a; font-weight: bold; }
    .option.incorrect { border: 2px solid #dc2626; background: #fee2e2; color: #dc2626; font-weight: bold; }
    .explanation { background: #f1f5f9; border-left: 4px solid #6366f1; padding: 1rem; margin-top: 1.2rem; border-radius: 0.7rem; }
    .hero-bg {
      background-image: url('sky.jpg');
      background-size: cover;
      background-position: center;
      position: relative;
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom right, rgba(30, 41, 59, 0.7) 0%, rgba(59, 130, 246, 0.4) 100%);
      z-index: 1;
      border-bottom-left-radius: 2rem;
      border-bottom-right-radius: 2rem;
    }
    .hero-content {
      position: relative;
      z-index: 2;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-white min-h-screen">
  <!-- HERO SECTION -->
  <section class="w-full h-44 md:h-64 hero-bg relative flex items-center justify-center mb-8 rounded-b-2xl overflow-hidden">
    <div class="hero-overlay"></div>
    <div class="hero-content flex flex-col items-center justify-center w-full text-center px-4">
      <h1 class="text-3xl md:text-5xl font-extrabold text-white drop-shadow-lg mb-2 tracking-wide" style="letter-spacing: 2px;">
        OAU ExamGuard Nigeria
      </h1>
    </div>
  </section>
  <!-- SCORE SUMMARY -->
  <main class="max-w-2xl mx-auto px-3 py-4">
    <div id="scoreSummary" class="mb-6"></div>
    <div id="cardsContainer"></div>
    <button onclick="window.location.href='tpp.html'" class="mt-8 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold">Retake Practice</button>
  </main>
  <script>
    const result = JSON.parse(localStorage.getItem("practiceResult") || "{}");
    const questions = JSON.parse(localStorage.getItem("practiceQuestions") || "[]");
    const answers = JSON.parse(localStorage.getItem("practiceAnswers") || "{}");

    // Show score summary
    document.getElementById("scoreSummary").innerHTML = `
      <div class="p-4 bg-blue-100 rounded-xl font-bold text-lg text-blue-900 flex flex-col md:flex-row items-center justify-between gap-3">
        <div>
          <span class="text-2xl md:text-3xl font-extrabold text-blue-900">Score: ${result.score || 0} / ${result.total || questions.length}</span>
        </div>
        <div>
          <span class="text-lg font-semibold text-indigo-700">Accuracy: ${Math.round(((result.score||0)/(result.total||questions.length))*100)}%</span>
        </div>
        <div>
          <span class="text-md font-medium text-gray-700">Questions: ${questions.length}</span>
        </div>
        <div>
          <span class="text-md font-medium text-green-700">Time Spent: ${result.timeSpent ? Math.round(result.timeSpent/60) + ' min' : '--'}</span>
        </div>
      </div>
    `;

    // Render question cards
    const container = document.getElementById("cardsContainer");
    questions.forEach((q, i) => {
      const userAnswer = answers[q._id] || null;
      const correctAnswer = result.correctChoices?.[q._id] || q.correctAnswer || null;
      const explanation = q.explanation || result.explanations?.[q._id] || "No explanation provided.";
      // Option rendering
      let optsHtml = (q.options || q.choices || []).map(opt => {
        let cls = "option";
        if (opt === correctAnswer) cls += " correct";
        if (opt === userAnswer && userAnswer !== correctAnswer) cls += " incorrect";
        if (opt === userAnswer && userAnswer === correctAnswer) cls += " selected";
        return `<div class="${cls} rounded px-4 py-2 mb-2">${opt}</div>`;
      }).join('');
      // Feedback
      let feedbackText = "";
      if (!userAnswer) {
        feedbackText = `<div class="text-red-600 font-medium mb-2">You did not answer this question.</div>`;
      } else if (userAnswer === correctAnswer) {
        feedbackText = `<div class="text-green-700 font-medium mb-2">Correct!</div>`;
      } else {
        feedbackText = `<div class="text-red-600 font-medium mb-2">Incorrect. Your Answer: <span class="font-semibold">${userAnswer}</span></div>`;
      }
      container.innerHTML += `
        <div class="result-card rounded-xl border-l-4 border-blue-500 bg-white shadow p-4 mb-6">
          <div class="font-bold text-lg mb-2">Q${i+1}: ${q.text || q.question || ""}</div>
          <div class="mb-2">${optsHtml}</div>
          ${feedbackText}
          <div class="explanation">
            <span class="font-bold text-blue-900">Explanation:</span>
            <span class="text-blue-900">${explanation}</span>
          </div>
        </div>
      `;
    });
  </script>
</body>
</html>
