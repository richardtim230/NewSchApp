<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign in — École des Roches</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Login page with role protection, accessible modal and toast notifications." />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

  <style>
    :root{
      --navy: #061728;
      --gold: #f6b83f;
      --bg: #f4f7fb;
      --card: #ffffff;
      --muted: #6b7280;
      --success: #16a34a;
      --danger: #dc2626;
      --info: #2563eb;
      --radius: 12px;
      --max-width: 980px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#071025;-webkit-font-smoothing:antialiased}
    a{color:inherit}
    img{max-width:100%;height:auto}

    /* Layout */
    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 20px;
    }

    .frame{
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns:420px 1fr;
      gap:28px;
      align-items:start;
    }

    @media (max-width:980px){
      .frame{ grid-template-columns: 1fr; padding: 12px; }
    }

    /* Left column: signin */
    .panel {
      background:var(--card);
      border-radius:var(--radius);
      padding:28px;
      box-shadow: 0 18px 46px rgba(2,11,24,0.08);
    }

    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }
    .logo {
      background:var(--gold);
      color:var(--navy);
      padding:10px 14px;
      border-radius:8px;
      font-family:'Playfair Display',serif;
      font-weight:700;
      font-size:18px;
    }
    .brand h1{font-size:18px;margin:0;font-family:'Playfair Display',serif;color:var(--navy)}
    .lead { color:var(--muted); font-size:13px; margin-top:6px }

    form .field{margin-top:12px}
    label{display:block;font-weight:700;font-size:13px;margin-bottom:8px}
    input[type="email"], input[type="password"], select {
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e6e9ef; font-size:14px; background:#fff;
    }

    .row { display:flex; gap:10px; align-items:center; }
    .checkbox { display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted) }

    .actions { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:18px; flex-wrap:wrap; }
    .btn { padding:10px 16px; border-radius:10px; border:0; cursor:pointer; font-weight:700; font-size:14px; }
    .btn-primary { background:var(--navy); color:#fff; }
    .btn-ghost { background:transparent; border:1px solid rgba(2,11,24,0.06); color:var(--navy) }
    .link-button { background:transparent; border:0; color:var(--info); cursor:pointer; font-weight:700 }

    .helper { margin-top:8px; font-size:13px; color:var(--muted) }

    /* Right column: info / demo protected area */
    .aside {
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border-radius:var(--radius);
      padding:22px;
      box-shadow: 0 10px 30px rgba(2,11,24,0.06);
      min-height:360px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .caps { text-transform:uppercase; color:var(--muted); font-size:12px; font-weight:700; letter-spacing:0.6px }

    .role-card { background:#fff; padding:12px; border-radius:10px; border:1px solid rgba(2,11,24,0.04); }
    .small { font-size:13px; color:var(--muted) }

    /* Protected demo area (hidden until auth) */
    .protected {
      display:none;
      margin-top:12px;
      border-radius:10px;
      padding:12px;
      background: linear-gradient(90deg, rgba(246,184,63,0.06), rgba(37,99,235,0.03));
    }

    .protected .welcome { font-weight:700; color:var(--navy) }

    /* Modal */
    .modal-backdrop {
      position:fixed; inset:0; background:rgba(2,11,24,0.45); display:none; align-items:center; justify-content:center; z-index:1200;
    }
    .modal {
      width:100%; max-width:540px; background:#fff; border-radius:12px; padding:18px; box-shadow:0 36px 80px rgba(2,11,24,0.26);
    }
    .modal h3{margin:0 0 8px 0}
    .modal p{color:var(--muted); font-size:14px}

    /* Toasts */
    .toast-wrap {
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:1300;
      display:flex;
      flex-direction:column;
      gap:10px;
      max-width:360px;
    }
    .toast {
      display:flex; gap:12px; align-items:flex-start; padding:12px 14px; border-radius:10px; color:#fff; box-shadow:0 10px 30px rgba(2,11,24,0.12);
      font-weight:600; font-size:14px;
    }
    .toast.info{ background:var(--info); }
    .toast.success{ background:var(--success); }
    .toast.warn{ background:#c2410c; }
    .toast.error{ background:var(--danger); }
    .toast button { background:transparent; border:0; color:rgba(255,255,255,0.95); cursor:pointer; font-weight:700 }

    /* small utilities */
    .muted { color:var(--muted); font-size:13px }
    .hidden { display:none }
  </style>
</head>
<body>

  <main class="wrap" id="root">
    <div class="frame" role="main">
      <!-- Sign-in panel -->
      <section class="panel" aria-labelledby="signin-title">
        <div class="brand" aria-hidden="false">
          <div class="logo">ER</div>
          <div>
            <h1 id="signin-title">Sign in</h1>
            <div class="lead">Access the admissions area, applicant portal and admin tools</div>
          </div>
        </div>

        <form id="login-form" autocomplete="on" novalidate>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required autocomplete="email" />
          </div>

          <div class="field">
            <label for="password">Password</label>
            <div style="position:relative">
              <input id="password" name="password" type="password" placeholder="••••••••" required autocomplete="current-password" />
              <button type="button" id="toggle-pass" aria-label="Toggle password visibility" style="position:absolute; right:8px; top:8px; border:0; background:transparent; cursor:pointer; color:var(--muted)">Show</button>
            </div>
          </div>

          <div class="field row" style="justify-content:space-between; align-items:center;">
            <label class="checkbox"><input type="checkbox" id="remember" /> Remember me</label>
            <button type="button" class="link-button" id="forgot-btn">Forgot password?</button>
          </div>

          <div class="actions">
            <div style="display:flex;gap:8px;">
              <button type="button" class="btn btn-ghost" id="demo-credentials">Use demo creds</button>
            </div>
            <div style="display:flex;gap:8px;">
              <button type="button" class="btn btn-ghost" id="register">Create account</button>
              <button type="submit" class="btn btn-primary" id="signin-btn">Sign in</button>
            </div>
          </div>

          <div class="helper">This demo supports role-based visibility: admin / admissions / applicant.</div>
        </form>

        <!-- Simple inline error area for immediate validation -->
        <div id="inline-error" class="muted" style="margin-top:12px; color:var(--danger); display:none" role="alert"></div>
      </section>

      <!-- Aside / Info & protected demo area -->
      <aside class="aside" aria-labelledby="info-title">
        <div class="caps" id="info-title">Secure access</div>
        <div class="small muted">This page demonstrates a login flow and client-side role protection for UI routing. Integrate with a secure server for production use (notes below).</div>

        <div class="role-card" aria-hidden="false">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:800">Demo roles</div>
              <div class="muted small">Try: admin@demo / admissions@demo / user@demo (password: Passw0rd!)</div>
            </div>
            <div style="text-align:right" class="small muted">JWT / session backed</div>
          </div>
          <div style="margin-top:10px" class="small muted">After login the protected area below reveals role-appropriate controls, and a JWT (or session) is stored. This is a client-side demo only.</div>
        </div>

        <!-- Protected demo area -->
        <div id="protected-area" class="protected" aria-live="polite">
          <div class="welcome">Welcome, <span id="user-name">—</span></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button id="logout" class="btn btn-ghost">Sign out</button>
            <button id="go-profile" class="btn btn-primary">Go to profile</button>
          </div>

          <div id="role-content" style="margin-top:12px">
            <!-- role-specific content appears here -->
          </div>
        </div>

        <div class="small muted" style="margin-top:auto; font-size:12px">
          Security notes:
          <ul style="margin:8px 0 0 16px; padding:0; color:var(--muted)">
            <li>Use HTTPS</li>
            <li>Prefer secure, httpOnly cookies for tokens</li>
            <li>Implement server-side session validation & rate limiting</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <!-- Modal: Forgot password -->
  <div id="modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal" role="document" tabindex="-1">
      <h3 id="modal-title">Reset password</h3>
      <p class="muted">Enter your account email and we'll send a password reset link.</p>

      <div style="margin-top:12px">
        <label for="reset-email">Email</label>
        <input id="reset-email" type="email" placeholder="you@example.com" />
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:14px">
        <button type="button" class="btn btn-ghost" id="modal-cancel">Cancel</button>
        <button type="button" class="btn btn-primary" id="modal-send">Send reset link</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toasts" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function(){
      // Utilities: toasts
      const toasts = document.getElementById('toasts');
      function showToast(type, message, opts = {}) {
        const id = 't' + Date.now();
        const el = document.createElement('div');
        el.className = 'toast ' + (type || 'info');
        el.setAttribute('role','status');
        el.id = id;
        el.innerHTML = `<div style="flex:1">${message}</div><div><button aria-label="Dismiss toast">✕</button></div>`;
        const btn = el.querySelector('button');
        btn.addEventListener('click', () => { el.remove(); });
        toasts.appendChild(el);
        const ttl = opts.ttl || (type === 'error' ? 7000 : 4000);
        setTimeout(() => {
          if (el.parentNode) el.remove();
        }, ttl);
      }

      // Modal (accessible focus trap)
      const modalBackdrop = document.getElementById('modal-backdrop');
      const modal = modalBackdrop.querySelector('.modal');
      const forgotBtn = document.getElementById('forgot-btn');
      const modalCancel = document.getElementById('modal-cancel');
      const modalSend = document.getElementById('modal-send');
      const resetEmail = document.getElementById('reset-email');

      let lastFocusBeforeModal = null;
      function openModal() {
        lastFocusBeforeModal = document.activeElement;
        modalBackdrop.style.display = 'flex';
        modalBackdrop.setAttribute('aria-hidden','false');
        // trap focus
        modal.tabIndex = -1;
        modal.focus();
        document.body.style.overflow = 'hidden';
        // close on backdrop click
        modalBackdrop.addEventListener('click', backdropClick);
        document.addEventListener('keydown', modalKeydown);
      }
      function closeModal() {
        modalBackdrop.style.display = 'none';
        modalBackdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        modalBackdrop.removeEventListener('click', backdropClick);
        document.removeEventListener('keydown', modalKeydown);
        if(lastFocusBeforeModal) lastFocusBeforeModal.focus();
      }
      function backdropClick(e){
        if(e.target === modalBackdrop) closeModal();
      }
      function modalKeydown(e){
        if(e.key === 'Escape') closeModal();
        // basic trap: keep focus inside modal
        if(e.key === 'Tab') {
          const focusable = modal.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');
          if(!focusable.length) return;
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
          else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
        }
      }

      forgotBtn.addEventListener('click', openModal);
      modalCancel.addEventListener('click', closeModal);

      modalSend.addEventListener('click', async () => {
        const email = resetEmail.value.trim();
        if(!email){ showToast('error','Please enter your email.'); resetEmail.focus(); return; }
        // Example: call /api/auth/forgot
        try {
          modalSend.disabled = true;
          modalSend.textContent = 'Sending...';
          // Fake API delay for demo
          await new Promise(r => setTimeout(r, 900));
          // TODO: replace with fetch('/api/auth/forgot', {method:'POST', body: JSON.stringify({email}), headers:{'Content-Type':'application/json'}})
          showToast('success','If an account exists we sent a reset link to ' + email);
          resetEmail.value = '';
          closeModal();
        } catch(err){
          console.error(err);
          showToast('error','Unable to send reset link right now.');
        } finally {
          modalSend.disabled = false;
          modalSend.textContent = 'Send reset link';
        }
      });

      // Password visibility toggle
      const togglePass = document.getElementById('toggle-pass');
      const passwordInput = document.getElementById('password');
      togglePass.addEventListener('click', () => {
        const isPwd = passwordInput.type === 'password';
        passwordInput.type = isPwd ? 'text' : 'password';
        togglePass.textContent = isPwd ? 'Hide' : 'Show';
      });

      // Demo credentials helper
      const demoBtn = document.getElementById('demo-credentials');
      demoBtn.addEventListener('click', () => {
        // Cycle between three demo users for convenience
        const seq = [
          {email:'admin@demo', pwd:'Passw0rd!', role:'admin', name:'Site Admin'},
          {email:'admissions@demo', pwd:'Passw0rd!', role:'admissions', name:'Admissions Officer'},
          {email:'user@demo', pwd:'Passw0rd!', role:'applicant', name:'Student Applicant'}
        ];
        // choose next by counting existing saved demo index
        const idx = (Number(localStorage.getItem('demo-index') || 0) % seq.length);
        const d = seq[idx];
        localStorage.setItem('demo-index', idx + 1);
        document.getElementById('email').value = d.email;
        document.getElementById('password').value = d.pwd;
        showToast('info', `Filled demo: ${d.email}`);
      });

      // Core: handle login
      const loginForm = document.getElementById('login-form');
      const inlineError = document.getElementById('inline-error');
      const signinBtn = document.getElementById('signin-btn');

      // For demo: simple in-memory demo user store (replace with real API)
      const DEMO_USERS = {
        'admin@demo': { password: 'Passw0rd!', role: 'admin', name: 'Site Admin' },
        'admissions@demo': { password: 'Passw0rd!', role: 'admissions', name: 'Admissions Officer' },
        'user@demo': { password: 'Passw0rd!', role: 'applicant', name: 'Student Applicant' }
      };

      // Storage helpers (note: for production prefer secure httpOnly cookies)
      function persistAuth(token, role, name, remember) {
        const storage = remember ? localStorage : sessionStorage;
        storage.setItem('auth_token', token);
        storage.setItem('auth_role', role);
        storage.setItem('auth_name', name);
      }
      function clearAuth() {
        // Clear both storage locations used by this demo
        localStorage.removeItem('auth_token'); localStorage.removeItem('auth_role'); localStorage.removeItem('auth_name');
        sessionStorage.removeItem('auth_token'); sessionStorage.removeItem('auth_role'); sessionStorage.removeItem('auth_name');
      }
      function getAuth() {
        return {
          token: sessionStorage.getItem('auth_token') || localStorage.getItem('auth_token'),
          role: sessionStorage.getItem('auth_role') || localStorage.getItem('auth_role'),
          name: sessionStorage.getItem('auth_name') || localStorage.getItem('auth_name')
        };
      }

      // Show protected UI based on role
      const protectedArea = document.getElementById('protected-area');
      const userNameEl = document.getElementById('user-name');
      const roleContent = document.getElementById('role-content');
      const logoutBtn = document.getElementById('logout');
      const goProfile = document.getElementById('go-profile');

      function renderProtected() {
        const auth = getAuth();
        if(!auth || !auth.token) {
          protectedArea.style.display = 'none';
          return;
        }
        protectedArea.style.display = 'block';
        userNameEl.textContent = auth.name || 'User';
        // role-specific UI
        const role = (auth.role || 'applicant');
        roleContent.innerHTML = ''; // reset

        // Common line
        const info = document.createElement('div');
        info.className = 'small muted';
        info.textContent = `Signed in as ${role.toUpperCase()}`;
        roleContent.appendChild(info);

        // Role switches
        if(role === 'admin') {
          const card = document.createElement('div');
          card.className = 'role-card';
          card.innerHTML = `<strong>Admin console</strong><div class="muted small">User management, site settings and logs.</div>
            <div style="margin-top:8px"><button class="btn btn-ghost" id="admin-users">Manage users</button> <button class="btn btn-ghost" id="admin-reports">Reports</button></div>`;
          roleContent.appendChild(card);
        }
        if(role === 'admissions') {
          const card = document.createElement('div');
          card.className = 'role-card';
          card.innerHTML = `<strong>Admissions dashboard</strong><div class="muted small">Review new applications and contact applicants.</div>
            <div style="margin-top:8px"><button class="btn btn-ghost" id="adm-review">Review queue</button> <button class="btn btn-ghost" id="adm-messages">Messages</button></div>`;
          roleContent.appendChild(card);
        }
        if(role === 'applicant') {
          const card = document.createElement('div');
          card.className = 'role-card';
          card.innerHTML = `<strong>Applicant portal</strong><div class="muted small">View application status and upload documents.</div>
            <div style="margin-top:8px"><button class="btn btn-ghost" id="app-status">Application status</button> <button class="btn btn-ghost" id="app-docs">Upload docs</button></div>`;
          roleContent.appendChild(card);
        }
      }

      logoutBtn.addEventListener('click', () => {
        clearAuth();
        renderProtected();
        showToast('info','You have been signed out.');
      });

      goProfile.addEventListener('click', ()=> {
        showToast('info','Profile navigation (placeholder)');
      });

      // Example of protecting a UI action by role
      function protectRole(allowedRoles, action) {
        const auth = getAuth();
        if(!auth || !auth.token) {
          showToast('error','Please sign in to continue.');
          return false;
        }
        const role = auth.role;
        if(!allowedRoles.includes(role)) {
          showToast('error','You do not have permission to access that resource.');
          return false;
        }
        action();
        return true;
      }

      // Login form submit - main logic
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        inlineError.style.display = 'none';
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const remember = document.getElementById('remember').checked;

        if(!email || !password) {
          inlineError.textContent = 'Please enter both email and password.';
          inlineError.style.display = 'block';
          return;
        }

        signinBtn.disabled = true;
        signinBtn.textContent = 'Signing in...';

        try {
          // Replace this demo block with a real fetch to your backend:
          // const res = await fetch('/api/auth/login', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email,password}) });
          // const json = await res.json();
          // if(!res.ok) throw new Error(json?.message || 'Login failed');

          // ---- Demo authentication (client-side only) ----
          await new Promise(r=>setTimeout(r,700)); // fake delay
          const user = DEMO_USERS[email];
          if(!user || user.password !== password) {
            throw new Error('Invalid credentials');
          }
          const fakeToken = 'demo-token-' + Date.now();
          persistAuth(fakeToken, user.role, user.name, remember);
          showToast('success','Signed in successfully');
          renderProtected();
          // Optionally navigate to a dashboard:
          // window.location.href = '/dashboard.html';
        } catch(err) {
          console.error(err);
          inlineError.textContent = err.message || 'Sign in failed';
          inlineError.style.display = 'block';
          showToast('error', 'Sign in failed: ' + (err.message || ''));
        } finally {
          signinBtn.disabled = false;
          signinBtn.textContent = 'Sign in';
        }
      });

      // On load, render protected area if already authenticated
      renderProtected();

      // Demo: allow clicking demo role buttons by delegating
      document.addEventListener('click', (e) => {
        const id = e.target.id;
        if(id === 'admin-users') protectRole(['admin'], ()=> showToast('info','Open user management'));
        if(id === 'admin-reports') protectRole(['admin'], ()=> showToast('info','Open reports'));
        if(id === 'adm-review') protectRole(['admissions','admin'], ()=> showToast('info','Open review queue'));
        if(id === 'adm-messages') protectRole(['admissions','admin'], ()=> showToast('info','Open messages'));
        if(id === 'app-status') protectRole(['applicant'], ()=> showToast('info','Open application status'));
        if(id === 'app-docs') protectRole(['applicant'], ()=> showToast('info','Open document upload'));
      });

      // Small helper: register button shows info (replace with proper registration page)
      document.getElementById('register').addEventListener('click', () => {
        showToast('info','Registration page not included in demo. Use the application form to register.');
      });

    })();
  </script>
</body>
</html>
