<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Results | ExamGuard ‚Äî Student</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <link rel="icon" href="logo.png">
  <style>
    :root{
      --bg-0:#f6f8ff; --bg-1:#eef2ff;
      --accent:#3b82f6; --accent-2:#6366f1; --muted:#6b7280;
      --card-bg:#ffffff; --radius:12px;
      --sidebar-w:300px;
      --max-page-width:1200px;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family:Inter,system-ui,Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; background:linear-gradient(180deg,var(--bg-0),var(--bg-1)); color:#072033; }
    /* Prevent any accidental horizontal scroll on mobile */
    html, body, #app { overflow-x: hidden; }

    a { color:inherit; text-decoration:none; }

    /* App layout */
    .app { display:flex; min-height:100vh; align-items:stretch; }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-w);
      min-width: var(--sidebar-w);
      background: linear-gradient(180deg,#0f172a 0%, #1e3a8a 100%);
      color:#fff; padding:20px 16px; position:fixed; left:0; top:0; bottom:0; z-index:100;
      box-shadow: 4px 0 28px rgba(15,23,42,0.12);
      transform: translateX(0); transition: transform .28s ease;
      display:flex; flex-direction:column; gap:14px; overflow-y:auto;
      -webkit-overflow-scrolling: touch;
    }
    .sidebar.hidden { transform: translateX(-110%); }
    .brand { display:flex; gap:12px; align-items:center; margin-bottom:6px; }
    .brand img { width:44px; height:44px; border-radius:10px; object-fit:cover; border:3px solid rgba(255,224,102,0.12); background:#fff; }
    .brand .title { font-weight:700; font-size:1.05rem; color:#ffe066; }
    .brand .subtitle { font-size:0.9rem; color:rgba(255,255,255,0.9); }

    .nav { display:flex; flex-direction:column; gap:8px; margin-top:6px; }
    .nav a {
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px;
      font-weight:700; font-size:0.98rem; color:#e6eefc; background:transparent;
      transition: background .12s, transform .08s;
    }
    .nav a.active, .nav a:hover { background: rgba(255,255,255,0.04); color:#ffe066; transform: translateX(3px); }

    .spacer { flex:1; }

    .profile { display:flex; gap:12px; align-items:center; padding-top:10px; border-top:1px solid rgba(255,255,255,0.04); }
    .profile img { width:44px; height:44px; border-radius:10px; object-fit:cover; border:2px solid #ffe066; }

    /* Topbar (fixed) */
    .topbar {
      position: fixed;
      left: var(--sidebar-w);
      top: 0;
      width: calc(100vw - var(--sidebar-w));
      z-index: 90;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 18px;
      backdrop-filter: blur(6px);
      background: rgba(255, 255, 255, 0.92);
      border-bottom: 1px solid rgba(11, 42, 60, 0.06);
      box-shadow: 0 6px 18px rgba(11, 42, 60, 0.04);
      min-height: 64px;
    }
    .page-title { font-weight:800; font-size:1.05rem; color:var(--accent-2); }
    .hamburger { display:none; background:var(--accent); color:#fff; border:none; padding:9px 12px; border-radius:10px; cursor:pointer; font-weight:800; font-size:1.05rem; }

    /* Main content */
    .main { margin-left: var(--sidebar-w); padding:20px; flex:1; transition: margin-left .28s; min-height:100vh; overflow-y:auto; -webkit-overflow-scrolling:touch; padding-top:90px; display:flex; justify-content:flex-start; }
    .container { width:100%; max-width:var(--max-page-width); margin:0 auto; padding-left:20px; padding-right:20px; box-sizing:border-box; }

    /* Layout: filters + content */
    .results-layout { display:grid; grid-template-columns: 320px 1fr; gap:18px; align-items:start; }
    .panel { background:var(--card-bg); border-radius:12px; padding:14px; box-shadow: 0 8px 20px rgba(11,42,60,0.04); border:1px solid rgba(11,42,60,0.03); }

    /* Filters panel */
    .filters h3 { margin:0 0 8px 0; font-weight:800; color:var(--accent-2); }
    .field { display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .field label { font-weight:700; font-size:0.9rem; color:#0b2033; }
    .field input, .field select { padding:10px 12px; border-radius:8px; border:1px solid #e6e9ef; font-size:0.95rem; }
    .actions { display:flex; gap:10px; margin-top:6px; justify-content:flex-end; }
    .btn { padding:10px 12px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#fff; font-weight:700; }
    .btn.ghost { background:transparent; color:var(--accent-2); border:1px solid rgba(59,130,246,0.08); }

    /* Results panel */
    .results-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
    .results-grid { display:grid; gap:12px; grid-auto-rows: minmax(80px, auto); }

    .result-card {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:14px;
      border-radius:12px;
      background:#fff;
      border:1px solid #eef3ff;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .result-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(59,130,246,0.06); }
    .result-meta { display:flex; flex-direction:column; gap:6px; max-width:70%; }
    .result-meta .title { font-weight:800; font-size:0.98rem; color:#072033; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .result-meta .sub { color:var(--muted); font-size:0.9rem; }

    .result-actions { display:flex; gap:8px; align-items:center; }

    .badge { padding:6px 8px; border-radius:8px; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#fff; font-weight:800; font-size:0.85rem; min-width:86px; text-align:center; }

    /* Empty state */
    .empty { text-align:center; padding:36px; color:var(--muted); }

    /* Responsive */
    @media (max-width: 980px) {
      .results-layout { grid-template-columns: 1fr; }
      .sidebar { transform: translateX(-110%); position:fixed; width:86vw; min-width:86vw; }
      .sidebar.open { transform: translateX(0); box-shadow: 0 24px 48px rgba(2,6,23,0.5); }
      .hamburger { display:inline-flex; }
      .topbar { left:0; width:100vw; }
      .main { margin-left:0; padding-top:80px; }
      .container { padding-left:12px; padding-right:12px; }
      .result-meta { max-width:100%; }
      .results-grid { grid-auto-rows: auto; }
      .badge { min-width:72px; padding:6px 10px; }
    }

    /* Mobile specific improvements (narrow phones) */
    @media (max-width: 480px) {
      .result-card {
        display:flex;
        flex-direction:column;
        align-items:flex-start;
        gap:10px;
        padding:12px;
        border-radius:12px;
      }
      .result-meta .title { font-size:1.00rem; white-space:normal; }
      .result-meta .sub { font-size:0.86rem; }
      .result-actions {
        width:100%;
        display:flex;
        gap:8px;
        justify-content:space-between;
        align-items:center;
        margin-top:6px;
      }
      .badge { min-width:56px; padding:6px 10px; font-size:0.85rem; }
      .btn { padding:8px 10px; font-size:0.92rem; }
      .panel { padding:12px; }
      .topbar { padding:10px 12px; }
      .hamburger { padding:8px 10px; }
      .container { padding-left:10px; padding-right:10px; }
    }

    /* Small helper */
    .muted { color:var(--muted); }
    .small { font-size:0.92rem; color:var(--muted); }

    /* Print friendly */
    @media print {
      .sidebar, .topbar, .hamburger { display:none !important; }
      .main { margin:0; padding:0; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" aria-label="Primary navigation">
      <div class="brand" aria-hidden="false">
        <img src="../logo.png" alt="Logo">
        <div>
          <div class="title">ExamGuard</div>
          <div class="subtitle">Student Portal</div>
        </div>
      </div>

      <nav class="nav" aria-label="Primary">
        <a href="#" class="active" onclick="nav(event)">üè† Dashboard</a>
        <a href="#" onclick="nav(event)">üìä Results</a>
        <a href="#" onclick="nav(event)">üìù Assignments</a>
        <a href="#" onclick="nav(event)">‚è∞ Timetable</a>
        <a href="#" onclick="nav(event)">üìÇ Resources</a>
        <a href="#" onclick="nav(event)">‚öôÔ∏è Settings</a>
      </nav>

      <div class="spacer" aria-hidden="true"></div>

      <div class="profile" role="region" aria-label="Student profile">
        <img src="../avatar.jpg" alt="Student avatar" id="studentAvatar">
        <div>
          <div class="name" id="studentName">Adaobi Chukwu</div>
          <div class="muted" id="studentClass">SS2 ‚Äî Biology</div>
        </div>
      </div>
    </aside>

    <!-- Topbar -->
    <div class="topbar" id="topbar">
      <div style="display:flex; gap:12px; align-items:center;">
        <button class="hamburger" id="hamburger" aria-label="Open menu">‚ò∞</button>
        <div>
          <div class="page-title" id="pageTitle">Results Portal</div>
          <div class="small muted">Central Results ‚Ä¢ Search & view student results</div>
        </div>
      </div>
      <div style="display:flex; gap:12px; align-items:center;">
        <img src="../avatar.jpg" alt="You" style="width:40px;height:40px;border-radius:8px;object-fit:cover;border:2px solid #fff;">
      </div>
    </div>

    <!-- Main -->
    <main class="main" id="main" role="main" tabindex="-1">
      <div class="container">
        <div class="results-layout">

          <!-- Filters -->
          <aside class="panel filters" aria-labelledby="filtersTitle">
            <h3 id="filtersTitle">Search student result</h3>
            <p class="small muted" style="margin-top:4px;margin-bottom:12px;">Enter one or more fields to find a student's published result.</p>

            <form id="searchForm" onsubmit="return false;">
              <div class="field">
                <label for="regNum">Registration number</label>
                <input id="regNum" name="regNum" placeholder="e.g. EG/2025/0001" />
              </div>

              <div class="field">
                <label for="session">Session</label>
                <select id="session" name="session">
                  <option value="">-- Select session --</option>
                  <option>2024/2025</option>
                  <option>2023/2024</option>
                  <option>2022/2023</option>
                </select>
              </div>

              <div class="field">
                <label for="term">Term</label>
                <select id="term" name="term">
                  <option value="">-- Select term --</option>
                  <option>First Term</option>
                  <option>Second Term</option>
                  <option>Third Term</option>
                </select>
              </div>

              <div class="field">
                <label for="classSelect">Class</label>
                <select id="classSelect" name="class">
                  <option value="">-- Select class --</option>
                  <option>JS3</option>
                  <option>SS1</option>
                  <option>SS2</option>
                  <option>SS3</option>
                </select>
              </div>

              <div class="field">
                <label for="scratch">Scratch card / PIN</label>
                <input id="scratch" name="scratch" placeholder="Optional scratch card code" />
              </div>

              <div style="display:flex; gap:8px; margin-top:8px;">
                <button id="searchBtn" class="btn" onclick="doSearch()">Search</button>
                <button type="button" class="btn ghost" onclick="clearFilters()">Reset</button>
              </div>
            </form>

            <hr style="margin:14px 0; border:none; border-top:1px solid #eef3ff;">

            <div>
              <div style="font-weight:800; margin-bottom:8px;">Quick lookup</div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn ghost" onclick="applyQuick('SS3','2024/2025')">SS3 ‚Ä¢ 24/25</button>
                <button class="btn ghost" onclick="applyQuick('SS2','2024/2025')">SS2 ‚Ä¢ 24/25</button>
                <button class="btn ghost" onclick="applyQuick('JS3','2023/2024')">JS3 ‚Ä¢ 23/24</button>
              </div>
            </div>

          </aside>

          <!-- Results area -->
          <section class="panel" aria-labelledby="resultsTitle">
            <div class="results-header">
              <div>
                <div style="font-weight:800" id="resultsTitle">Previously checked results</div>
                <div class="small muted" id="resultsSubtitle">Recent lookups appear here</div>
              </div>
              <div style="display:flex; gap:8px; align-items:center;">
                <input id="filterText" placeholder="Filter results..." style="padding:10px 12px; border-radius:10px; border:1px solid #e6e9ef;" oninput="filterList()" />
                <button class="btn ghost" onclick="printResults()">Print</button>
              </div>
            </div>

            <div class="results-grid" id="resultsGrid" aria-live="polite">
              <!-- dynamic result cards -->
            </div>

            <div id="emptyState" class="empty" style="display:none;">
              <div style="font-weight:800;margin-bottom:8px;">No results yet</div>
              <div class="small muted">Search using the form on the left to display a student's published result</div>
            </div>

          </section>

        </div>
      </div>
    </main>
  </div>

  <script>
    // Simulated sample data - in a real app this would be fetched from the server
    const SAMPLE_RESULTS = [
      {
        id: 'EG-2025-0001',
        name: 'Adaobi Chukwu',
        class: 'SS3',
        session: '2024/2025',
        term: 'First Term',
        publishedAt: '2025-01-28',
        note: 'Checked via scratch card'
      },
      {
        id: 'EG-2024-0345',
        name: 'Ifeanyi Okonkwo',
        class: 'SS2',
        session: '2024/2025',
        term: 'Second Term',
        publishedAt: '2025-02-02',
        note: 'Result released'
      },
      {
        id: 'EG-2023-0912',
        name: 'Chinelo Nwosu',
        class: 'JS3',
        session: '2023/2024',
        term: 'Third Term',
        publishedAt: '2024-12-12',
        note: 'Parent accessed'
      }
    ];

    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');
    const searchBtn = document.getElementById('searchBtn');
    const resultsGrid = document.getElementById('resultsGrid');
    const emptyState = document.getElementById('emptyState');
    const filterText = document.getElementById('filterText');

    // initial render
    let cached = [...SAMPLE_RESULTS];
    renderList(cached);

    function nav(e){
      e && e.preventDefault();
      // placeholder for navigation
      alert('Navigation placeholder ‚Äî implement as needed.');
    }

    function toggleSidebar(){
      sidebar.classList.toggle('open');
    }
    hamburger && hamburger.addEventListener('click', toggleSidebar);

    function doSearch(){
      const reg = document.getElementById('regNum').value.trim().toLowerCase();
      const session = document.getElementById('session').value.trim();
      const term = document.getElementById('term').value.trim();
      const cls = document.getElementById('classSelect').value.trim();
      const scratch = document.getElementById('scratch').value.trim();

      // Simulate lookup: try to find a matching sample result, otherwise show empty
      const found = SAMPLE_RESULTS.filter(r => {
        if (reg && !r.id.toLowerCase().includes(reg)) return false;
        if (session && r.session !== session) return false;
        if (term && r.term !== term) return false;
        if (cls && r.class !== cls) return false;
        // scratch ignored in sample
        return true;
      });

      // If no found and reg present - simulate a fetched result (demo)
      if (found.length === 0 && reg) {
        // create a demo result from the entered values
        const simulated = {
          id: reg.toUpperCase(),
          name: 'Unknown student',
          class: cls || 'SS2',
          session: session || '2024/2025',
          term: term || 'First Term',
          publishedAt: new Date().toISOString().slice(0,10),
          note: scratch ? 'Accessed via scratch' : 'Searched manually'
        };
        // prepend to cached & render
        cached.unshift(simulated);
        renderList(cached);
        showToast('Result retrieved (demo)', 'success');
        return;
      }

      if (found.length === 0) {
        renderList([]);
        showToast('No matching results found', 'error');
        return;
      }

      // add found results to top of cached (avoid duplicates by id)
      found.reverse().forEach(f => {
        if (!cached.find(c => c.id === f.id)) cached.unshift(f);
      });
      renderList(cached);
      showToast(`${found.length} result(s) added to list`, 'success');
    }

    function renderList(list){
      resultsGrid.innerHTML = '';
      if (!list || list.length === 0) {
        emptyState.style.display = 'block';
        return;
      }
      emptyState.style.display = 'none';
      list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.setAttribute('data-id', item.id);

        const meta = document.createElement('div');
        meta.className = 'result-meta';
        const t = document.createElement('div');
        t.className = 'title';
        t.textContent = item.name + ' ‚Äî ' + item.id;
        const s = document.createElement('div');
        s.className = 'sub';
        s.textContent = `${item.class} ‚Ä¢ ${item.session} ‚Ä¢ ${item.term} ‚Ä¢ Published: ${item.publishedAt}`;
        meta.appendChild(t);
        meta.appendChild(s);

        const actions = document.createElement('div');
        actions.className = 'result-actions';

        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = item.class;
        actions.appendChild(badge);

        const viewBtn = document.createElement('button');
        viewBtn.className = 'btn ghost';
        viewBtn.textContent = 'View';
        viewBtn.onclick = () => viewResult(item);
        actions.appendChild(viewBtn);

        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'btn';
        downloadBtn.textContent = 'Download';
        downloadBtn.onclick = () => downloadResult(item);
        actions.appendChild(downloadBtn);

        card.appendChild(meta);
        card.appendChild(actions);

        resultsGrid.appendChild(card);
      });
    }

    function viewResult(item){
      // For demo we're opening a modal-like new window with formatted info
      const html = `
        <html>
        <head><title>Result ‚Äî ${item.id}</title>
          <meta name="viewport" content="width=device-width,initial-scale=1" />
          <style>
            body{font-family:Inter,system-ui,Arial;padding:20px;color:#072033;background:#f6f8ff}
            .card{max-width:760px;margin:0 auto;background:#fff;padding:20px;border-radius:12px;border:1px solid #eef3ff}
            h1{margin:0 0 6px 0}
            .meta{color:#6b7280;margin-bottom:12px}
            table{width:100%;border-collapse:collapse}
            th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left}
            .close{position:fixed;right:18px;top:18px;padding:8px 10px;background:#ef4444;color:#fff;border-radius:8px;border:none}
          </style>
        </head>
        <body>
          <button class="close" onclick="window.close()">Close</button>
          <div class="card">
            <h1>${item.name}</h1>
            <div class="meta">${item.id} ‚Ä¢ ${item.class} ‚Ä¢ ${item.session} ‚Ä¢ ${item.term}</div>
            <div style="margin-bottom:12px;"><strong>Note:</strong> ${item.note || '‚Äî'}</div>
            <table>
              <thead><tr><th>Subject</th><th>Score</th><th>Grade</th></tr></thead>
              <tbody>
                <tr><td>Mathematics</td><td>78</td><td>A</td></tr>
                <tr><td>English</td><td>70</td><td>B</td></tr>
                <tr><td>Biology</td><td>65</td><td>B</td></tr>
                <tr><td>Civics</td><td>82</td><td>A</td></tr>
              </tbody>
            </table>
          </div>
        </body>
        </html>
      `;
      const w = window.open('', '_blank', 'noopener');
      w.document.write(html);
      w.document.close();
    }

    function downloadResult(item){
      // create a simple text content and download as .txt for demo
      const txt = `Result ‚Äî ${item.name} (${item.id})
Class: ${item.class}
Session: ${item.session}
Term: ${item.term}
Published: ${item.publishedAt}
Note: ${item.note || '‚Äî'}

Subjects:
Mathematics: 78 - A
English: 70 - B
Biology: 65 - B
Civics: 82 - A

--- End of result ---
`;
      const blob = new Blob([txt], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${item.id}_result.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('Download started', 'success');
    }

    function clearFilters(){
      document.getElementById('searchForm').reset();
    }

    function applyQuick(cls, session){
      document.getElementById('classSelect').value = cls;
      document.getElementById('session').value = session;
    }

    function printResults(){
      window.print();
    }

    // Simple filter textbox
    function filterList(){
      const q = filterText.value.trim().toLowerCase();
      if (!q) {
        renderList(cached);
        return;
      }
      const filtered = cached.filter(r => {
        return r.name.toLowerCase().includes(q) || r.id.toLowerCase().includes(q) || r.class.toLowerCase().includes(q) || r.session.toLowerCase().includes(q);
      });
      renderList(filtered);
    }

    // Toast helper
    let toastT;
    function showToast(msg, type='default', t=3000){
      // small ephemeral toast using topbar
      clearTimeout(toastT);
      const el = document.createElement('div');
      el.textContent = msg;
      el.style.position = 'fixed';
      el.style.right = '18px';
      el.style.bottom = '18px';
      el.style.padding = '10px 14px';
      el.style.borderRadius = '10px';
      el.style.color = '#fff';
      el.style.fontWeight = '700';
      el.style.zIndex = 9999;
      if (type === 'success') el.style.background = 'linear-gradient(90deg,#10b981,#059669)';
      else if (type === 'error') el.style.background = 'linear-gradient(90deg,#ef4444,#dc2626)';
      else el.style.background = '#111827';
      document.body.appendChild(el);
      toastT = setTimeout(()=> {
        el.style.transition = 'opacity .18s';
        el.style.opacity = 0;
        setTimeout(()=> el.remove(), 200);
      }, t);
    }

    // close sidebar on outside click (mobile)
    document.addEventListener('click', (ev) => {
      if (window.innerWidth > 980) return;
      if (!sidebar.classList.contains('open')) return;
      const inside = sidebar.contains(ev.target) || hamburger.contains(ev.target);
      if (!inside) sidebar.classList.remove('open');
    });

    // ensure cached shows sample results on load
    (function init(){
      cached = [...SAMPLE_RESULTS];
      renderList(cached);
    })();
  </script>
</body>
</html>
