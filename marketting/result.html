<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Results ‚Ä¢ ExamGuard ‚Äî Student</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <link rel="icon" href="../logo.png">
  <style>
    :root{
      --bg-0:#f6f8ff; --bg-1:#eef2ff;
      --accent:#3b82f6; --accent-2:#6366f1; --muted:#6b7280;
      --card-bg:#ffffff; --radius:12px;
      --sidebar-w:280px;
      --glass: rgba(255,255,255,0.7);
      --success: #10b981;
      --danger: #ef4444;
      --touch-size:48px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#0b2a44}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}

    /* App layout */
    .app{display:flex;min-height:100vh;align-items:stretch}
    .overlay { position:fixed; inset:0; background:rgba(2,6,23,0.45); z-index:80; display:none; }
    .overlay.visible { display:block; }

    /* Sidebar */
    .sidebar{
      width:var(--sidebar-w); min-width:var(--sidebar-w);
      background:linear-gradient(180deg,#0f172a 0%, #1e3a8a 100%);
      color:#fff;padding:22px 18px;position:fixed;left:0;top:0;bottom:0;z-index:100;
      display:flex;flex-direction:column;gap:16px;overflow-y:auto;border-right:1px solid rgba(255,255,255,0.04);
      transition:transform .22s ease;
    }
    .sidebar.hidden { transform: translateX(-110%); }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,224,102,0.12);background:#fff}
    .brand .title{font-weight:800;color:#ffe066}
    .nav{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:9px;font-weight:700;background:transparent;color:#e6eefc}
    .nav a.active,.nav a:hover{background:rgba(255,255,255,0.04);color:#ffe066;transform:translateX(4px)}
    .profile{display:flex;gap:12px;align-items:center;padding-top:10px;border-top:1px solid rgba(255,255,255,0.04)}
    .profile img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid #ffe066}

    /* Topbar */
    .topbar{
      position:fixed; left:var(--sidebar-w); top:0; width:calc(100vw - var(--sidebar-w)); z-index:90;
      display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;
      backdrop-filter: blur(6px); background: rgba(255,255,255,0.92); border-bottom:1px solid rgba(11,42,60,0.06);
      box-shadow:0 6px 18px rgba(11,42,60,0.04); min-height:64px;
    }
    .hamburger{display:none;background:var(--accent);color:#fff;border:none;padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:800;height:var(--touch-size);min-width:var(--touch-size);display:inline-grid;place-items:center}
    .page-title{font-weight:800;font-size:1.06rem;color:var(--accent-2)}
    .topbar .actions{display:flex;gap:10px;align-items:center}

    /* Main area */
    .main{margin-left:var(--sidebar-w);padding:22px;flex:1;padding-top:104px;min-height:100vh}
    .container{max-width:1200px;margin:0 auto}

    /* Grid and cards */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;align-items:start}
    .card{background:var(--card-bg);border-radius:var(--radius);padding:14px;border:1px solid rgba(11,42,60,0.04);box-shadow:0 10px 30px rgba(11,42,60,0.03)}
    .col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-9{grid-column:span 9}.col-12{grid-column:1 / -1}

    /* Form controls */
    .filters{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:0.85rem;font-weight:700;color:var(--muted)}
    .field input,.field select{padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:0.95rem;min-width:140px}
    .btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:700}
    .btn.ghost{background:transparent;color:var(--accent-2);border:1px solid rgba(59,130,246,0.08)}
    .btn.small{padding:9px 10px;font-size:0.95rem}

    /* KPIs */
    .kpis{display:flex;gap:12px;align-items:stretch}
    .kpi{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);display:flex;flex-direction:column;gap:8px;align-items:flex-start;min-width:120px}
    .kpi .num{font-size:1.4rem;font-weight:900;color:var(--accent-2)}
    .kpi .label{font-size:0.9rem;color:var(--muted);font-weight:700}

    /* Results table: desktop */
    .results-table-wrapper{margin-top:8px;overflow:auto;border-radius:8px}
    .results-table{width:100%;border-collapse:collapse;min-width:720px}
    .results-table th,.results-table td{padding:10px;border-bottom:1px solid #f1f5ff;text-align:left;font-size:0.95rem;vertical-align:middle}
    .results-table th{font-weight:800;background:#fbfdff}
    .grade-pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:800;color:#fff;font-size:0.9rem}
    .grade-A{background:linear-gradient(90deg,#10b981,#059669)} .grade-B{background:linear-gradient(90deg,#f59e0b,#f97316)} .grade-C{background:linear-gradient(90deg,#f97316,#ef4444)} .grade-D{background:#9ca3af}

    /* Subject cards */
    .subject-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
    .subject{padding:12px;border-radius:10px;background:#fff;border:1px solid #eef3ff;display:flex;flex-direction:column;gap:6px}
    .subject .sub-title{font-weight:800;color:#0b2a44}
    .subject .meta{color:var(--muted);font-size:0.9rem}

    /* Quick snapshot */
    .actions-row{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}

    /* Note */
    .note{padding:12px;border-radius:10px;background:linear-gradient(90deg,#fff,#fbfdff);border-left:4px solid var(--accent)}

    /* Accessibility */
    .nav a:focus, .btn:focus, .subject:focus { outline: 3px solid rgba(99,102,241,0.12); outline-offset:4px; }

    /* MOBILE STYLES */
    @media (max-width: 980px){
      .grid{grid-template-columns:repeat(6,1fr)}
      .col-3{grid-column:span 3}.col-4{grid-column:span 6}.col-6{grid-column:span 6}.col-9{grid-column:span 6}
      .hamburger{display:inline-grid}
      .topbar{left:0;width:100vw;padding:10px 12px}
      .sidebar{position:fixed;left:0;top:0;transform:translateX(-110%);width:86vw;min-width:86vw}
      .sidebar.open{transform:translateX(0);box-shadow:0 24px 48px rgba(2,6,23,0.5)}
      .main{margin-left:0;padding-top:88px}
      .kpis{flex-direction:column}
    }

    @media (max-width:720px){
      .container{padding:0 12px}
      .subject-grid{grid-template-columns:repeat(2,1fr)}
      .field input,.field select{min-width:0}
      .filters{gap:8px}
      .btn.small{width:100%}
      .card{padding:12px}
      .topbar{padding:10px}
      .page-title{font-size:0.98rem}

      /* Responsive table: hide the header and render each row as a stacked card */
      .results-table { min-width: unset; border:0 }
      .results-table thead { display:none }
      .results-table-wrapper { overflow:visible }
      .results-table tbody tr {
        display:block;
        margin-bottom:10px;
        padding:12px;
        background:#fff;
        border-radius:10px;
        box-shadow:0 6px 18px rgba(11,42,60,0.04);
        border:1px solid #eef3ff;
      }
      .results-table tbody tr td {
        display:flex;
        justify-content:space-between;
        padding:6px 0;
        border:0;
        font-size:0.96rem;
      }
      .results-table tbody tr td:first-child { font-weight:800; color:#0b2a44 }
      .results-table tbody tr td .muted { color:var(--muted) }
      .results-table tbody tr td[data-label]::before {
        content: attr(data-label);
        display:block;
        font-size:0.78rem;
        color:var(--muted);
        font-weight:700;
        margin-bottom:4px;
      }

      /* Make export actions full width */
      .card .small-actions { display:flex;flex-direction:column;gap:8px }
      .card .small-actions .btn { width:100% }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="overlay" id="overlay" aria-hidden="true"></div>

    <!-- Sidebar -->
    <aside class="sidebar open" id="sidebar" aria-label="Main navigation" role="navigation">
      <div class="brand" aria-hidden="false">
        <img src="../logo.png" alt="Logo">
        <div>
          <div class="title">ExamGuard</div>
          <div class="muted" style="font-weight:700;font-size:0.92rem">Central Result Portal</div>
        </div>
      </div>

      <nav class="nav" aria-label="Primary">
        <a href="student.html">üè† Dashboard</a>
        <a href="#" class="active">üìÑ Results</a>
        <a href="student.html#timetable">‚è∞ Timetable</a>
        <a href="student.html#resources">üìÇ Resources</a>
        <a href="student.html#messages">‚úâÔ∏è Messages</a>
        <a href="student.html#settings">‚öôÔ∏è Settings</a>
      </nav>

      <div style="flex:1"></div>

      <div class="profile" role="region" aria-label="Student profile">
        <img src="../avatar.jpg" alt="Student avatar">
        <div>
          <div class="name" id="sidebarName" style="font-weight:700">Adaobi Chukwu</div>
          <div class="muted" id="sidebarClass">SS2 ‚Äî Biology</div>
        </div>
      </div>
    </aside>

    <!-- Topbar -->
    <div class="topbar" id="topbar">
      <div style="display:flex;gap:12px;align-items:center">
        <button class="hamburger" id="hamburger" aria-label="Toggle menu" title="Open menu">‚ò∞</button>
        <div>
          <div class="page-title" id="pageTitle">Central Result Portal</div>
          <div class="muted" style="font-size:0.9rem">Search results quickly ‚Äî printable & exportable</div>
        </div>
      </div>

      <div class="actions">
        <div style="display:flex;gap:8px;align-items:center">
          <img src="../avatar.jpg" alt="You" style="width:44px;height:44px;border-radius:8px;object-fit:cover;border:2px solid #fff">
        </div>
      </div>
    </div>

    <!-- Main -->
    <main class="main" id="main" role="main" tabindex="-1">
      <div class="container">
        <!-- Filters -->
        <div class="card col-12" style="display:flex;flex-direction:column;gap:12px;margin-bottom:14px">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
            <div style="font-weight:800">Search / Lookup Results</div>
            <div class="muted">Find students by registration, session, term and class</div>
          </div>

          <div class="filters" role="search" aria-label="Search results">
            <div class="field" style="min-width:170px">
              <label for="regNo">Registration No</label>
              <input id="regNo" placeholder="e.g. EXM/2025/001" inputmode="text" />
            </div>

            <div class="field">
              <label for="session">Session</label>
              <select id="session" aria-label="Session">
                <option value="2024/2025">2024/2025</option>
                <option value="2023/2024">2023/2024</option>
                <option value="2022/2023">2022/2023</option>
              </select>
            </div>

            <div class="field">
              <label for="term">Term</label>
              <select id="term" aria-label="Term">
                <option>First</option>
                <option>Second</option>
                <option>Third</option>
              </select>
            </div>

            <div class="field">
              <label for="classSel">Class</label>
              <select id="classSel" aria-label="Class">
                <option>SS2</option>
                <option>SS1</option>
                <option>SS3</option>
              </select>
            </div>

            <div style="display:flex;gap:8px;align-items:end;margin-left:auto">
              <button class="btn small" id="searchBtn" aria-label="Search">Search</button>
              <button class="btn ghost small" id="clearBtn" aria-label="Clear">Clear</button>
            </div>
          </div>
        </div>

        <!-- Results header + KPIs -->
        <div class="grid" style="margin-bottom:12px;align-items:start">
          <div class="card col-9">
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
                <div>
                  <div style="font-weight:900;font-size:1.04rem" id="resultStudentName">--</div>
                  <div class="muted" id="resultStudentMeta">Registration ‚Ä¢ Class ‚Ä¢ Session</div>
                </div>
                <div style="text-align:right">
                  <div class="muted">Result status</div>
                  <div style="font-weight:900;color:var(--accent-2);font-size:1.1rem" id="resultStatus">‚Äî</div>
                </div>
              </div>

              <div class="kpis" style="width:100%">
                <div class="kpi">
                  <div class="label">Cumulative Average</div>
                  <div class="num" id="kpiAvg">--%</div>
                  <div class="muted">Position in class: <strong id="kpiRank">--</strong></div>
                </div>
                <div class="kpi">
                  <div class="label">Total Subjects</div>
                  <div class="num" id="kpiSubjects">--</div>
                  <div class="muted">Passed: <strong id="kpiPassed">--</strong></div>
                </div>
                <div class="kpi">
                  <div class="label">Attendance</div>
                  <div class="num" id="kpiAtt">--%</div>
                  <div class="muted">Days attended: <strong id="kpiDays">--</strong></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card col-3">
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="font-weight:800">Export / Print</div>
              <div class="muted" style="font-size:0.95rem">Create a printable report or export CSV</div>
              <div class="small-actions" style="margin-top:8px">
                <button class="btn" id="printBtn" aria-label="Print report">Print Report</button>
                <button class="btn ghost" id="exportBtn" aria-label="Export as CSV">Export CSV</button>
                <button class="btn ghost" id="downloadPdfBtn" aria-label="Download PDF">Download PDF</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Score breakdown -->
        <div class="grid">
          <div class="card col-9">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:800">Subject Breakdown</div>
              <div class="muted">Detailed scores & remarks</div>
            </div>

            <div class="results-table-wrapper" id="tableWrapper" role="region" aria-label="Subject results">
              <table class="results-table" id="resultsTable" aria-live="polite">
                <thead>
                  <tr>
                    <th>Subject</th>
                    <th>CA</th>
                    <th>Exam</th>
                    <th>Total</th>
                    <th>Grade</th>
                    <th>Remark</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- rows populated by JS -->
                </tbody>
              </table>
            </div>

            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:12px">
              <div class="note" style="flex:1">
                <div style="font-weight:800">Teacher comment</div>
                <div id="teacherComment" class="muted" style="margin-top:6px">‚Äî</div>
              </div>

              <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;min-width:160px">
                <div class="muted">Overall Grade</div>
                <div style="font-weight:900;font-size:1.6rem;color:var(--accent-2)" id="overallGrade">‚Äî</div>
                <div class="muted">CGPA: <strong id="overallGPA">--</strong></div>
              </div>
            </div>
          </div>

          <div class="card col-3">
            <div style="font-weight:800">Quick Snapshot</div>

            <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
              <div style="display:flex;justify-content:space-between"><div class="muted">Highest score</div><div id="snapHigh">--</div></div>
              <div style="display:flex;justify-content:space-between"><div class="muted">Lowest score</div><div id="snapLow">--</div></div>
              <div style="display:flex;justify-content:space-between"><div class="muted">No. of A's</div><div id="snapA">--</div></div>
              <div style="display:flex;justify-content:space-between"><div class="muted">No. of F's</div><div id="snapF">--</div></div>
              <div style="margin-top:8px"><button class="btn small" onclick="scrollToTable()">View full</button></div>
            </div>

            <div style="margin-top:12px">
              <div style="font-weight:800">Previous Semesters</div>
              <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                <button class="btn ghost small">Second Semester</button>
                <button class="btn ghost small">First Semester 2025</button>
                <button class="btn ghost small">Third Term 2024</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Subjects cards -->
        <div class="card col-12" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">Subjects / Quick details</div>
            <div class="muted">Tap a subject for breakdown</div>
          </div>

          <div class="subject-grid" id="subjectGrid" style="margin-top:12px">
            <!-- populated via JS -->
          </div>
        </div>

      </div>
    </main>
  </div>

  <script>
    // Demo data (replace with real fetch)
    const sampleResult = {
      regNo: 'EXM/2025/001',
      name: 'Adaobi Chukwu',
      class: 'SS2',
      session: '2024/2025',
      term: 'First',
      status: 'Published',
      attendance: 92,
      days: 120,
      gpa: 3.8,
      overallGrade: 'A',
      avgPercent: 86,
      rank: '3 / 45',
      teacherComment: 'Excellent performance. Keep up the consistent effort.',
      subjects: [
        { name: 'Mathematics', ca: 18, exam: 72, total: 90, grade: 'A', remark: 'Excellent' },
        { name: 'English', ca: 15, exam: 64, total: 79, grade: 'B', remark: 'Good' },
        { name: 'Biology', ca: 17, exam: 68, total: 85, grade: 'A', remark: 'Very good' },
        { name: 'Chemistry', ca: 14, exam: 58, total: 72, grade: 'B', remark: 'Good' },
        { name: 'Physics', ca: 12, exam: 50, total: 62, grade: 'C', remark: 'Satisfactory' },
        { name: 'Civic', ca: 16, exam: 70, total: 86, grade: 'A', remark: 'Excellent' }
      ]
    };

    // Elements
    const regNoEl = document.getElementById('regNo');
    const sessionEl = document.getElementById('session');
    const termEl = document.getElementById('term');
    const classEl = document.getElementById('classSel');
    const searchBtn = document.getElementById('searchBtn');
    const clearBtn = document.getElementById('clearBtn');

    const resultStudentName = document.getElementById('resultStudentName');
    const resultStudentMeta = document.getElementById('resultStudentMeta');
    const resultStatus = document.getElementById('resultStatus');
    const kpiAvg = document.getElementById('kpiAvg');
    const kpiRank = document.getElementById('kpiRank');
    const kpiSubjects = document.getElementById('kpiSubjects');
    const kpiPassed = document.getElementById('kpiPassed');
    const kpiAtt = document.getElementById('kpiAtt');
    const kpiDays = document.getElementById('kpiDays');

    const resultsTableBody = document.querySelector('#resultsTable tbody');
    const overallGradeEl = document.getElementById('overallGrade');
    const overallGPAEl = document.getElementById('overallGPA');
    const teacherComment = document.getElementById('teacherComment');
    const snapHigh = document.getElementById('snapHigh');
    const snapLow = document.getElementById('snapLow');
    const snapA = document.getElementById('snapA');
    const snapF = document.getElementById('snapF');
    const subjectGrid = document.getElementById('subjectGrid');

    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');
    const overlay = document.getElementById('overlay');

    // Sidebar toggle with body lock
    function openSidebar(){
      sidebar.classList.add('open');
      sidebar.classList.remove('hidden');
      overlay.classList.add('visible');
      document.body.classList.add('no-scroll');
    }
    function closeSidebar(){
      sidebar.classList.remove('open');
      sidebar.classList.add('hidden');
      overlay.classList.remove('visible');
      document.body.classList.remove('no-scroll');
    }
    hamburger.addEventListener('click', ()=>{
      if(sidebar.classList.contains('open')) closeSidebar();
      else openSidebar();
    });
    overlay.addEventListener('click', closeSidebar);

    // Add no-scroll helper style to body when sidebar open (injected)
    (function ensureNoScrollStyle(){
      const s = document.createElement('style');
      s.textContent = 'body.no-scroll{overflow:hidden;height:100vh;touch-action:none}';
      document.head.appendChild(s);
    })();

    // Helpers
    function gradeClass(grade){
      if(grade==='A') return 'grade-A';
      if(grade==='B') return 'grade-B';
      if(grade==='C') return 'grade-C';
      return 'grade-D';
    }

    function createRowCells(subject){
      // return array of tds that include data-label attributes (for mobile stacked view)
      const tdSubject = document.createElement('td');
      tdSubject.textContent = subject.name;
      tdSubject.setAttribute('data-label','Subject');

      const tdCA = document.createElement('td');
      tdCA.textContent = subject.ca;
      tdCA.setAttribute('data-label','CA');

      const tdExam = document.createElement('td');
      tdExam.textContent = subject.exam;
      tdExam.setAttribute('data-label','Exam');

      const tdTotal = document.createElement('td');
      tdTotal.textContent = subject.total;
      tdTotal.setAttribute('data-label','Total');

      const tdGrade = document.createElement('td');
      const span = document.createElement('span');
      span.className = 'grade-pill ' + gradeClass(subject.grade);
      span.textContent = subject.grade;
      tdGrade.appendChild(span);
      tdGrade.setAttribute('data-label','Grade');

      const tdRemark = document.createElement('td');
      tdRemark.innerHTML = `<span class="muted">${subject.remark}</span>`;
      tdRemark.setAttribute('data-label','Remark');

      return [tdSubject, tdCA, tdExam, tdTotal, tdGrade, tdRemark];
    }

    function populate(result){
      // Header & KPIs
      resultStudentName.textContent = result.name;
      resultStudentMeta.textContent = `${result.regNo} ‚Ä¢ ${result.class} ‚Ä¢ ${result.session} ‚Äî ${result.term} term`;
      resultStatus.textContent = result.status;
      kpiAvg.textContent = result.avgPercent + '%';
      kpiRank.textContent = result.rank;
      kpiSubjects.textContent = result.subjects.length;
      kpiPassed.textContent = result.subjects.filter(s => s.total >= 50).length;
      kpiAtt.textContent = result.attendance + '%';
      kpiDays.textContent = result.days;

      // Table
      resultsTableBody.innerHTML = '';
      let high = -Infinity, low = Infinity, countA=0, countF=0;
      result.subjects.forEach(s => {
        const tr = document.createElement('tr');
        const tds = createRowCells(s);
        tds.forEach(t => tr.appendChild(t));
        resultsTableBody.appendChild(tr);

        high = Math.max(high, s.total);
        low = Math.min(low, s.total);
        if(s.grade === 'A') countA++;
        if(s.grade === 'F') countF++;
      });

      overallGradeEl.textContent = result.overallGrade;
      overallGPAEl.textContent = result.gpa;
      teacherComment.textContent = result.teacherComment;
      snapHigh.textContent = high === -Infinity ? '--' : high;
      snapLow.textContent = low === Infinity ? '--' : low;
      snapA.textContent = countA;
      snapF.textContent = countF;

      // subjects cards
      subjectGrid.innerHTML = '';
      result.subjects.forEach(s => {
        const div = document.createElement('div');
        div.className = 'subject';
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="sub-title">${s.name}</div>
            <div class="meta">${s.total}%</div>
          </div>
          <div class="meta">CA: ${s.ca} ‚Ä¢ Exam: ${s.exam}</div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><span class="grade-pill ${gradeClass(s.grade)}">${s.grade}</span></div>
            <div class="muted">${s.remark}</div>
          </div>
        `;
        div.tabIndex = 0;
        div.addEventListener('click', ()=>{ toast(`${s.name}: ${s.total} ‚Äî ${s.remark}`) });
        subjectGrid.appendChild(div);
      });
    }

    // Basic toast (small)
    function toast(msg, timeout=2200){
      let t = document.getElementById('egToast');
      if(!t){
        t = document.createElement('div');
        t.id = 'egToast';
        Object.assign(t.style,{position:'fixed',right:'16px',bottom:'16px',padding:'10px 12px',background:'#111827',color:'#fff',borderRadius:'8px',zIndex:9999,fontWeight:700});
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(t._t);
      t._t = setTimeout(()=> t.style.display='none', timeout);
    }

    // Export CSV
    function exportCSV(result){
      const rows = [
        ['RegNo','Name','Class','Session','Term','Subject','CA','Exam','Total','Grade','Remark']
      ];
      result.subjects.forEach(s => {
        rows.push([result.regNo,result.name,result.class,result.session,result.term,s.name,s.ca,s.exam,s.total,s.grade,s.remark]);
      });
      const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${result.regNo || 'result'}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Print
    function printReport(){
      window.print();
    }

    function scrollToTable(){ document.querySelector('#tableWrapper').scrollIntoView({behavior:'smooth', block:'center'}); }

    // Wire buttons
    searchBtn.addEventListener('click', (e)=>{
      const q = regNoEl.value.trim();
      if(q) sampleResult.regNo = q;
      // Here you would call your API with reg/session/term/class
      populate(sampleResult);
      // If on small screen, close sidebar
      if(window.innerWidth <= 980) closeSidebar();
    });

    clearBtn.addEventListener('click', ()=> {
      regNoEl.value=''; sessionEl.selectedIndex=0; termEl.selectedIndex=0; classEl.selectedIndex=0;
      // clear UI
      resultsTableBody.innerHTML = '';
      resultStudentName.textContent='--';
      resultStudentMeta.textContent='Registration ‚Ä¢ Class ‚Ä¢ Session';
      resultStatus.textContent='‚Äî';
      kpiAvg.textContent='--%';
      kpiRank.textContent='--';
      kpiSubjects.textContent='--';
      kpiPassed.textContent='--';
      kpiAtt.textContent='--%';
      kpiDays.textContent='--';
      subjectGrid.innerHTML='';
      overallGradeEl.textContent='‚Äî';
      overallGPAEl.textContent='--';
      teacherComment.textContent='‚Äî';
      snapHigh.textContent='--';
      snapLow.textContent='--';
      snapA.textContent='--';
      snapF.textContent='--';
    });

    document.getElementById('exportBtn').addEventListener('click', ()=> exportCSV(sampleResult));
    document.getElementById('printBtn').addEventListener('click', printReport);
    document.getElementById('downloadPdfBtn').addEventListener('click', ()=> printReport());

    // Init with example
    populate(sampleResult);

    // Improve viewport resizing: if user resizes to desktop show sidebar
    window.addEventListener('resize', () => {
      if(window.innerWidth > 980){
        sidebar.classList.remove('hidden');
        sidebar.classList.add('open');
        overlay.classList.remove('visible');
        document.body.classList.remove('no-scroll');
      } else {
        // collapse by default
        sidebar.classList.add('hidden');
        sidebar.classList.remove('open');
      }
    });

  </script>
</body>
</html>
