<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Teacher Dashboard | ExamGuard</title>
  <meta name="viewport" content="width=device-width,initial-scale=0.901" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <link rel="icon" href="../logo.png">
  <style>
    /* Reused styling from others.html with small teacher-focused tweaks */
    :root{
      --bg-0:#f6f8ff; --bg-1:#eef2ff;
      --accent:#3b82f6; --accent-2:#6366f1; --muted:#6b7280;
      --card-bg:#ffffff; --sidebar-w:300px;
      --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));-webkit-font-smoothing:antialiased;color:#0b2a44}
    a{color:inherit;text-decoration:none}
    .app{display:flex;min-height:100vh;align-items:stretch}
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.45);z-index:50;display:none}
    .overlay.visible{display:block}

    /* Sidebar (desktop instant show) */
    .sidebar{
      width:var(--sidebar-w);min-width:var(--sidebar-w);
      background:linear-gradient(180deg,#0f172a 0%, #1e3a8a 100%);color:#fff;padding:20px 16px;position:fixed;left:0;top:0;bottom:0;z-index:100;
      box-shadow:4px 0 28px rgba(15,23,42,0.12);display:flex;flex-direction:column;gap:14px;overflow-y:auto;transition:none;
    }
    @media (max-width:720px){
      .sidebar{transform:translateX(-110%);transition:transform .28s ease;position:fixed;width:86vw;min-width:86vw}
      .sidebar.hidden{transform:translateX(-110%)}
      .sidebar.open{transform:translateX(0);box-shadow:0 24px 48px rgba(2,6,23,0.5)}
    }

    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:3px solid rgba(255,224,102,0.12);background:#fff}
    .brand .title{font-weight:800;font-size:1.05rem;color:#ffe066}
    .nav{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .nav a{display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;font-weight:700;font-size:1rem;color:#e6eefc}
    .nav a.active,.nav a:hover{background:rgba(255,255,255,0.04);color:#ffe066}

    /* teacher submenu inside sidebar */
    .subnav{display:flex;flex-direction:column;gap:6px;margin-top:8px;padding-top:8px;border-top:1px dashed rgba(255,255,255,0.04)}
    .subnav a{padding:10px;border-radius:8px;color:var(--accent-2);font-weight:700;background:transparent}
    .subnav a.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff}

    .spacer{flex:1}
    .profile{display:flex;gap:12px;align-items:center;padding-top:10px;border-top:1px solid rgba(255,255,255,0.04)}
    .profile img{width:48px;height:48px;border-radius:10px;object-fit:cover;border:2px solid #ffe066}

    /* Topbar */
    .topbar{position:fixed;left:var(--sidebar-w);top:0;width:calc(100vw - var(--sidebar-w));z-index:90;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;backdrop-filter:blur(6px);background:rgba(255,255,255,0.86);border-bottom:1px solid rgba(11,42,60,0.06);box-shadow:0 6px 18px rgba(11,42,60,0.04);min-height:64px}
    @media (max-width:720px){.topbar{left:0;width:100vw;padding:10px 12px;min-height:56px}}

    .hamburger{display:none;background:var(--accent);color:#fff;border:none;padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:800}
    @media (max-width:980px){.hamburger{display:inline-flex}}

    .page-title{font-weight:800;font-size:1.05rem;color:var(--accent-2)}
    .small{font-size:0.92rem;color:var(--muted)}

    .main{margin-left:var(--sidebar-w);padding:20px;flex:1;transition:margin-left .28s;min-height:100vh;padding-top:90px;overflow-y:auto}
    @media (max-width:720px){.main{margin-left:0;padding:14px;padding-top:80px}}

    /* Content layout */
    .content{display:flex;flex-direction:column;gap:12px}
    .section{background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid #eef3ff}
    .section h2{margin:0 0 8px 0;font-size:1.05rem}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}

    .card{background:#fff;border-radius:12px;padding:12px;border:1px solid #eef3ff;display:flex;flex-direction:column;gap:8px}
    .card .title{font-weight:800}
    .card .meta{color:var(--muted);font-size:0.92rem}

    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:9px 12px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:800}
    .btn.ghost{background:transparent;color:var(--accent-2);border:1px solid rgba(59,130,246,0.08)}

    /* forms & tables */
    table{width:100%;border-collapse:collapse}
    table th, table td{padding:8px;border-bottom:1px solid #f1f5fb;text-align:left}
    input[type="text"], input[type="number"], select, textarea{padding:8px;border-radius:8px;border:1px solid #e6e9ef;width:100%}

    /* modals */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:9999;padding:12px}
    .modal.active{display:flex}
    .modal .panel{background:#fff;border-radius:12px;max-width:980px;width:100%;overflow:hidden;box-shadow:0 20px 60px rgba(2,6,23,0.25)}
    .modal .head{padding:12px 16px;border-bottom:1px solid #eef3ff;background:#f8fbff;display:flex;justify-content:space-between;align-items:center}
    .modal .body{padding:14px;max-height:72vh;overflow:auto}

    .muted-small{font-size:0.9rem;color:var(--muted)}
    .empty{padding:28px;text-align:center;color:var(--muted);border:1px dashed #eef3ff;border-radius:12px}

    :focus{outline:3px solid rgba(99,102,241,0.18);outline-offset:2px;border-radius:6px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="overlay" id="overlay" aria-hidden="true"></div>

    <aside class="sidebar" id="sidebar" aria-label="Main navigation" role="navigation" aria-hidden="false">
      <div class="brand">
        <img src="../logo.png" alt="Logo">
        <div>
          <div class="title">Teacher Portal</div>
          <div class="small">ExamGuard ‚Ä¢ Faculty</div>
        </div>
      </div>

      <nav class="nav" aria-label="Primary">
        <a href="teacher-dashboard.html" class="active">üè† Home</a>

        <div class="subnav" role="menu" aria-label="Teacher sections">
          <a href="#overview" data-tab="overview" class="sidebar-tab" role="menuitem">üìä Overview</a>
          <a href="#classes" data-tab="classes" class="sidebar-tab" role="menuitem">üë©‚Äçüè´ Classes</a>
          <a href="#attendance" data-tab="attendance" class="sidebar-tab" role="menuitem">üìù Attendance</a>
          <a href="#assignments" data-tab="assignments" class="sidebar-tab" role="menuitem">üóÇ Assignments</a>
          <a href="#gradebook" data-tab="gradebook" class="sidebar-tab" role="menuitem">üìö Gradebook</a>
          <a href="#exams" data-tab="exams" class="sidebar-tab" role="menuitem">üñ• Exams</a>
          <a href="#resources" data-tab="resources" class="sidebar-tab" role="menuitem">üìÇ Resources</a>
          <a href="#messages" data-tab="messages" class="sidebar-tab" role="menuitem">‚úâÔ∏è Messages</a>
          <a href="#settings" data-tab="settings" class="sidebar-tab" role="menuitem">‚öôÔ∏è Settings</a>
        </div>
      </nav>

      <div class="spacer" aria-hidden="true"></div>

      <div class="profile">
        <img src="../avatar.jpg" alt="Teacher avatar">
        <div>
          <div style="font-weight:800" id="teacherName">Mr. Emeka</div>
          <div class="muted-small" id="teacherDept">Biology ‚Ä¢ Grade 10</div>
        </div>
      </div>
    </aside>

    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center;">
        <button class="hamburger" id="hamburger" aria-label="Open menu">‚ò∞</button>
        <div>
          <div class="page-title">Teacher Dashboard</div>
          <div class="small muted">Manage classes, assessments & communications</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center;">
        <div class="muted-small">Term: 2025 / 2026</div>
        <img src="../avatar.jpg" alt="you" style="width:44px;height:44px;border-radius:8px;border:2px solid #fff">
      </div>
    </div>

    <main class="main" id="main" role="main" tabindex="-1">
      <div class="content" id="contentArea">
        <!-- Overview -->
        <section id="overview" class="section tab-section" role="region" aria-labelledby="ovTitle">
          <h2 id="ovTitle">Overview</h2>
          <div class="muted-small">Quick stats and recent activity</div>

          <div style="margin-top:12px" class="grid">
            <div class="card">
              <div class="small muted">Classes</div>
              <div style="font-weight:900;font-size:1.2rem" id="statClasses">--</div>
              <div class="muted-small">Active this term</div>
            </div>

            <div class="card">
              <div class="small muted">Students</div>
              <div style="font-weight:900;font-size:1.2rem" id="statStudents">--</div>
              <div class="muted-small">Total across classes</div>
            </div>

            <div class="card">
              <div class="small muted">Pending submissions</div>
              <div style="font-weight:900;font-size:1.2rem" id="statPending">--</div>
              <div class="muted-small">Awaiting grading</div>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:800">Recent activity</div>
              <div class="muted-small">All actions</div>
            </div>
            <div style="margin-top:8px" id="activityList"></div>
          </div>
        </section>

        <!-- Classes -->
        <section id="classes" class="section tab-section" role="region" aria-labelledby="classesTitle" style="display:none">
          <h2 id="classesTitle">Classes</h2>
          <div class="muted-small">Your classes and rosters</div>

          <div style="margin-top:12px" class="controls">
            <select id="classSelect"></select>
            <button class="btn" id="newClassBtn">Create class</button>
            <button class="btn ghost" id="exportRosterBtn">Export roster</button>
          </div>

          <div style="margin-top:12px" id="rosterWrap">
            <div class="card" id="rosterCard">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div><strong id="rosterTitle">Class</strong></div>
                <div class="muted-small" id="rosterMeta">-- students</div>
              </div>

              <div style="margin-top:10px">
                <table id="rosterTable" aria-label="Class roster">
                  <thead><tr><th>#</th><th>Name</th><th>Admission</th><th>Contact</th><th>Actions</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Attendance -->
        <section id="attendance" class="section tab-section" role="region" aria-labelledby="attTitle" style="display:none">
          <h2 id="attTitle">Attendance</h2>
          <div class="muted-small">Mark attendance quickly</div>

          <div style="margin-top:12px" class="controls">
            <select id="attClassSelect"></select>
            <input type="date" id="attDate">
            <button class="btn" id="loadAttendanceBtn">Load</button>
          </div>

          <div style="margin-top:12px" id="attendanceWrap"></div>
        </section>

        <!-- Assignments -->
        <section id="assignments" class="section tab-section" role="region" aria-labelledby="assignTitle" style="display:none">
          <h2 id="assignTitle">Assignments</h2>
          <div class="muted-small">Create assignments, collect submissions & grade</div>

          <div style="margin-top:12px" class="controls">
            <button class="btn" id="newAssignBtn">New assignment</button>
            <button class="btn ghost" id="viewSubmissionsBtn">View submissions</button>
          </div>

          <div style="margin-top:12px" id="assignList"></div>
        </section>

        <!-- Gradebook -->
        <section id="gradebook" class="section tab-section" role="region" aria-labelledby="gradeTitle" style="display:none">
          <h2 id="gradeTitle">Gradebook</h2>
          <div class="muted-small">Enter grades and export reports</div>

          <div style="margin-top:12px" class="controls">
            <select id="gradeClassSelect"></select>
            <select id="gradeAssessmentSelect"><option>Assessment A</option></select>
            <button class="btn" id="saveGradesBtn">Save grades</button>
            <button class="btn ghost" id="exportGradesBtn">Export CSV</button>
          </div>

          <div style="margin-top:12px" id="gradebookWrap"></div>
        </section>

        <!-- Exams -->
        <section id="exams" class="section tab-section" role="region" aria-labelledby="examTitle" style="display:none">
          <h2 id="examTitle">Exams</h2>
          <div class="muted-small">Schedule CBT exams and view sessions</div>

          <div style="margin-top:12px" class="controls">
            <button class="btn" id="scheduleExamBtn">Schedule exam</button>
            <button class="btn ghost" id="manageSessionsBtn">Manage sessions</button>
          </div>

          <div style="margin-top:12px" id="examList"></div>
        </section>

        <!-- Resources -->
        <section id="resources" class="section tab-section" role="region" aria-labelledby="resTitle" style="display:none">
          <h2 id="resTitle">Resources</h2>
          <div class="muted-small">Upload lesson materials and link to classes</div>

          <div style="margin-top:12px" class="controls">
            <input type="text" id="resSearch" placeholder="Search resources">
            <button class="btn" id="uploadResBtn">Upload</button>
          </div>

          <div style="margin-top:12px" id="resGrid"></div>
        </section>

        <!-- Messages -->
        <section id="messages" class="section tab-section" role="region" aria-labelledby="msgTitle" style="display:none">
          <h2 id="msgTitle">Messages</h2>
          <div class="muted-small">Send announcements to classes or individual students</div>

          <div style="margin-top:12px" class="controls">
            <select id="msgTarget"><option value="class">Class</option><option value="student">Student</option></select>
            <button class="btn" id="newMsgBtn">New message</button>
          </div>

          <div style="margin-top:12px" id="msgList"></div>
        </section>

        <!-- Settings -->
        <section id="settings" class="section tab-section" role="region" aria-labelledby="setTitle" style="display:none">
          <h2 id="setTitle">Settings</h2>
          <div class="muted-small">Manage profile and notification preferences</div>

          <form id="teacherSettings" style="margin-top:12px;display:grid;gap:8px;max-width:720px">
            <label>Display name<input type="text" id="setName"></label>
            <label>Department<input type="text" id="setDept"></label>
            <label>Email<input type="text" id="setEmail"></label>
            <div style="display:flex;gap:8px;justify-content:flex-end">
              <button type="button" class="btn ghost" id="resetSettings">Reset</button>
              <button type="submit" class="btn" id="saveSettings">Save</button>
            </div>
          </form>
        </section>
      </div>
    </main>

    <!-- Shared modals -->
    <div class="modal" id="itemModal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="panel" role="document">
        <div class="head">
          <div id="itemModalTitle" style="font-weight:800">Details</div>
          <div><button class="btn ghost" id="closeItemModal">Close</button></div>
        </div>
        <div class="body" id="itemModalBody"></div>
      </div>
    </div>

    <div class="modal" id="formModal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="panel" role="document">
        <div class="head">
          <div id="formModalTitle" style="font-weight:800">Form</div>
          <div><button class="btn ghost" id="closeFormModal">Close</button></div>
        </div>
        <div class="body" id="formModalBody">
          <!-- dynamic content -->
        </div>
      </div>
    </div>

  </div>

  <script>
    (function () {
      // Sidebar mobile handlers (same pattern used earlier)
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const hamburger = document.getElementById('hamburger');
      if (hamburger) {
        hamburger.addEventListener('click', () => {
          sidebar.classList.remove('hidden');
          sidebar.classList.add('open');
          overlay.classList.add('visible');
          document.body.classList.add('no-scroll');
        });
        overlay.addEventListener('click', () => {
          sidebar.classList.remove('open');
          sidebar.classList.add('hidden');
          overlay.classList.remove('visible');
          document.body.classList.remove('no-scroll');
        });
      }

      // Tab system driven by sidebar .sidebar-tab
      const sidebarTabs = Array.from(document.querySelectorAll('.sidebar-tab'));
      const tabSections = Array.from(document.querySelectorAll('.tab-section'));

      function setActiveTab(name, push = true) {
        sidebarTabs.forEach(t => {
          const is = t.dataset.tab === name;
          t.classList.toggle('active', is);
          t.setAttribute('aria-current', is ? 'true' : 'false');
        });
        tabSections.forEach(s => s.style.display = s.id === name ? '' : 'none');
        if (push) history.replaceState(null, '', '#' + name);
        // close mobile sidebar if needed
        if (window.innerWidth <= 720) {
          sidebar.classList.remove('open');
          sidebar.classList.add('hidden');
          overlay.classList.remove('visible');
          document.body.classList.remove('no-scroll');
        }
        // focus a primary control in section
        const sec = document.getElementById(name);
        if (sec) {
          const focusable = sec.querySelector('button, input, select, a');
          if (focusable) focusable.focus();
        }
      }

      sidebarTabs.forEach(t => {
        t.addEventListener('click', (e) => {
          e.preventDefault();
          setActiveTab(t.dataset.tab);
        });
      });

      // Initialize tab from hash (deep linking)
      const initial = (location.hash || '').replace('#', '') || 'overview';
      setActiveTab(initial, false);
      window.addEventListener('hashchange', () => {
        const h = (location.hash || '').replace('#', '') || 'overview';
        setActiveTab(h, false);
      });

      // Mock data for teacher
      const classes = [
        { id: 'C1', name: 'SS2-Biology', students: [
          { id:'S001', name:'Adaobi Chukwu', admission:'ADM001', contact:'0801000001' },
          { id:'S002', name:'Chinonso Okafor', admission:'ADM002', contact:'0801000002' },
          { id:'S003', name:'Mercy A', admission:'ADM003', contact:'0801000003' },
        ]},
        { id: 'C2', name: 'SS2-Maths', students: [
          { id:'S011', name:'John Doe', admission:'ADM011', contact:'0801000011' },
          { id:'S012', name:'Jane Roe', admission:'ADM012', contact:'0801000012' },
        ]}
      ];

      const assignments = [
        { id:'A001', title:'Cell Structure', classId:'C1', due:'2026-03-20', submissions:2 },
        { id:'A002', title:'Algebra Quiz', classId:'C2', due:'2026-03-22', submissions:1 }
      ];

      const exams = [
        { id:'E001', title:'Biology ‚Äî Term Exam', classId:'C1', date:'2026-04-05', duration:90 }
      ];

      const resources = [
        { id:'R001', title:'Cell Notes (PDF)', type:'pdf', uploaded:'2026-02-01' }
      ];

      const messages = [
        { id:'M001', to:'C1', subject:'Reminder', body:'Submit assignment by Friday', time:'2026-03-01' }
      ];

      // Overview render
      function renderOverview() {
        document.getElementById('statClasses').textContent = classes.length;
        const totalStudents = classes.reduce((s, c) => s + c.students.length, 0);
        document.getElementById('statStudents').textContent = totalStudents;
        document.getElementById('statPending').textContent = assignments.reduce((s,a)=>s + (a.submissions === 0 ? 1 : 0), 0);
        const act = document.getElementById('activityList');
        act.innerHTML = '';
        const recent = [
          'Assignment "Cell Structure" created',
          'Exam "Biology ‚Äî Term Exam" scheduled',
          'Grade submission pending for SS2-Biology'
        ];
        const ul = document.createElement('ul');
        recent.forEach(r => { const li = document.createElement('li'); li.textContent = r; ul.appendChild(li); });
        act.appendChild(ul);
      }

      // Classes render
      const classSelect = document.getElementById('classSelect');
      function renderClassOptions() {
        classSelect.innerHTML = '';
        classes.forEach(c => {
          const opt = document.createElement('option'); opt.value = c.id; opt.textContent = c.name; classSelect.appendChild(opt);
        });
        // also populate selects used in other sections
        ['attClassSelect','gradeClassSelect'].forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          el.innerHTML = '';
          classes.forEach(c => { const o = document.createElement('option'); o.value = c.id; o.textContent = c.name; el.appendChild(o); });
        });
        // initial roster display
        if (classes.length) {
          showRoster(classes[0].id);
          document.getElementById('rosterTitle').textContent = classes[0].name;
          document.getElementById('rosterMeta').textContent = `${classes[0].students.length} students`;
          document.getElementById('classSelect').value = classes[0].id;
        }
      }

      function showRoster(classId) {
        const cls = classes.find(c=>c.id === classId);
        const tbody = document.querySelector('#rosterTable tbody');
        tbody.innerHTML = '';
        if (!cls) return;
        cls.students.forEach((s, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${idx+1}</td><td>${s.name}</td><td>${s.admission}</td><td>${s.contact}</td><td><button class="btn ghost" data-action="profile" data-id="${s.id}">Profile</button></td>`;
          tbody.appendChild(tr);
        });
        document.getElementById('rosterTitle').textContent = cls.name;
        document.getElementById('rosterMeta').textContent = `${cls.students.length} students`;
      }

      // Attendance render
      function loadAttendance(classId, date) {
        const cls = classes.find(c=>c.id===classId);
        const wrap = document.getElementById('attendanceWrap');
        wrap.innerHTML = '';
        if (!cls) { wrap.innerHTML = '<div class="empty">Select a class</div>'; return; }
        const tbl = document.createElement('table');
        tbl.innerHTML = '<thead><tr><th>#</th><th>Student</th><th>Present</th><th>Notes</th></tr></thead>';
        const tb = document.createElement('tbody');
        cls.students.forEach((s, i) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${i+1}</td><td>${s.name}</td>
            <td><input type="checkbox" data-id="${s.id}" checked></td>
            <td><input type="text" data-id="${s.id}" placeholder="notes"></td>`;
          tb.appendChild(tr);
        });
        tbl.appendChild(tb);
        const submit = document.createElement('div'); submit.style.marginTop='8px';
        submit.innerHTML = `<button class="btn" id="saveAttBtn">Save attendance</button> <button class="btn ghost" id="clearAttBtn">Clear</button>`;
        wrap.appendChild(tbl); wrap.appendChild(submit);
      }

      // Assignments list
      function renderAssignments() {
        const wrap = document.getElementById('assignList');
        wrap.innerHTML = '';
        assignments.forEach(a => {
          const c = document.createElement('article'); c.className = 'card';
          c.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">${a.title}</div><div class="muted-small">${classes.find(c=>c.id===a.classId)?.name || '‚Äî'}</div></div><div class="muted-small">Due ${a.due}</div></div>
            <div style="margin-top:8px;display:flex;gap:8px"><button class="btn" data-action="viewAssign" data-id="${a.id}">View</button><button class="btn ghost" data-action="grade" data-id="${a.id}">Grade</button></div>`;
          wrap.appendChild(c);
        });
      }

      // Gradebook render: editable table
      function renderGradebook(classId) {
        const wrap = document.getElementById('gradebookWrap');
        wrap.innerHTML = '';
        const cls = classes.find(c=>c.id===classId);
        if (!cls) { wrap.innerHTML = '<div class="empty">Select a class</div>'; return; }
        // sample assessment header
        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = '<tr><th>#</th><th>Student</th><th>Assessment</th><th>Score</th></tr>';
        const tbody = document.createElement('tbody');
        cls.students.forEach((s, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${idx+1}</td><td>${s.name}</td><td>Assessment A</td><td><input type="number" min="0" max="100" data-student="${s.id}" value=""></td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(thead); table.appendChild(tbody);
        wrap.appendChild(table);
      }

      // Exams render
      function renderExams() {
        const wrap = document.getElementById('examList');
        wrap.innerHTML = '';
        exams.forEach(e => {
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">${e.title}</div><div class="muted-small">${classes.find(c=>c.id===e.classId)?.name || ''}</div></div><div class="muted-small">${e.date}</div></div>
            <div style="margin-top:8px;display:flex;gap:8px"><button class="btn" data-action="openExam" data-id="${e.id}">Open</button><button class="btn ghost" data-action="editExam" data-id="${e.id}">Edit</button></div>`;
          wrap.appendChild(c);
        });
      }

      // Resources render
      function renderResources() {
        const wrap = document.getElementById('resGrid');
        wrap.innerHTML = '';
        const g = document.createElement('div'); g.className = 'grid';
        resources.forEach(r => {
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div style="font-weight:800">${r.title}</div><div class="muted-small">${r.type} ‚Ä¢ Uploaded ${r.uploaded}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn" data-action="download" data-id="${r.id}">Download</button><button class="btn ghost" data-action="link" data-id="${r.id}">Link to class</button></div>`;
          g.appendChild(c);
        });
        wrap.appendChild(g);
      }

      // Messages render
      function renderMessages() {
        const wrap = document.getElementById('msgList');
        wrap.innerHTML = '';
        messages.forEach(m => {
          const c = document.createElement('article'); c.className = 'card';
          c.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">${m.subject}</div><div class="muted-small">${m.to}</div></div><div class="muted-small">${m.time}</div></div>
            <div style="margin-top:8px" class="muted-small">${m.body}</div>
            <div style="margin-top:8px;display:flex;gap:8px"><button class="btn" data-action="reply" data-id="${m.id}">Reply</button><button class="btn ghost" data-action="archive" data-id="${m.id}">Archive</button></div>`;
          wrap.appendChild(c);
        });
      }

      // Initial renders & UI wiring
      function init() {
        renderOverview();
        renderClassOptions();
        renderAssignments();
        renderExams();
        renderResources();
        renderMessages();
        renderGradebook(classes[0]?.id);
        // populate selects
        document.getElementById('attClassSelect').value = classes[0]?.id || '';
        document.getElementById('gradeClassSelect').value = classes[0]?.id || '';
      }

      // Event listeners (delegated pattern)
      document.body.addEventListener('click', (e) => {
        const t = e.target;
        // roster profile
        if (t.matches('button[data-action="profile"]')) {
          const id = t.dataset.id;
          let found;
          classes.forEach(c => { const s = c.students.find(x=>x.id===id); if (s) found = s; });
          if (found) openItemModal(`<div style="font-weight:800">${found.name}</div><div class="muted-small">Admission: ${found.admission}</div><div style="margin-top:8px">Contact: ${found.contact}</div>`);
        }

        // assignments actions
        if (t.matches('button[data-action="viewAssign"]')) {
          const id = t.dataset.id;
          const a = assignments.find(x=>x.id===id);
          if (a) openItemModal(`<div style="font-weight:800">${a.title}</div><div class="muted-small">Class: ${classes.find(c=>c.id===a.classId)?.name}</div><div style="margin-top:8px">Due: ${a.due}</div>`);
        }
        if (t.matches('button[data-action="grade"]')) {
          const id = t.dataset.id;
          openFormModal('Grade submissions', `<p>Open grading interface for ${id} (mock)</p><div style="display:flex;gap:8px"><button class="btn" id="closeFormInline">Close</button></div>`);
        }

        // gradebook & export
        if (t.id === 'exportGradesBtn') {
          // simple CSV export of gradebook inputs
          const rows = [['Student','Assessment','Score']];
          const inputs = document.querySelectorAll('#gradebookWrap input[type="number"]');
          inputs.forEach(inp => {
            const tr = inp.closest('tr');
            const name = tr.children[1].textContent;
            const assessment = tr.children[2].textContent;
            rows.push([name, assessment, inp.value || '']);
          });
          const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
          const blob = new Blob([csv], {type:'text/csv'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = 'gradebook.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        }

        // exam actions
        if (t.matches('button[data-action="openExam"]')) {
          const id = t.dataset.id;
          const ex = exams.find(x=>x.id===id);
          openItemModal(`<div style="font-weight:800">${ex.title}</div><div class="muted-small">${ex.date} ‚Ä¢ ${ex.duration} mins</div><div style="margin-top:8px"><button class="btn" onclick="window.location.href='/cbt-session.html?exam=${encodeURIComponent(id)}'">Open session</button></div>`);
        }

        // resources actions
        if (t.matches('button[data-action="download"]')) {
          alert('Download resource (implement).');
        }
        if (t.matches('button[data-action="link"]')) {
          openFormModal('Link resource', `<p>Link resource to class (mock).</p><div style="display:flex;gap:8px"><button class="btn" id="closeFormInline">Close</button></div>`);
        }

        // messages
        if (t.matches('button[data-action="reply"]')) {
          openFormModal('Reply', `<label>Message<textarea style="width:100%;height:120px;border:1px solid #e6e9ef;border-radius:8px"></textarea></label><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn">Send</button></div>`);
        }

        // simple create actions
        if (t.id === 'newClassBtn') {
          openFormModal('Create class', `<form id="createClassForm"><label>Class name<input type="text" id="newClassName" required></label><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Create</button></div></form>`);
          setTimeout(()=> {
            const f = document.getElementById('createClassForm');
            if (f) f.addEventListener('submit', (ev) => {
              ev.preventDefault();
              const name = document.getElementById('newClassName').value.trim();
              if (!name) return alert('Enter class name');
              const id = 'C' + Math.floor(Math.random()*1000);
              classes.push({ id, name, students: [] });
              renderClassOptions();
              closeFormModal();
              alert('Class created: ' + name);
            });
          }, 60);
        }

        if (t.id === 'newAssignBtn') {
          openFormModal('New assignment', `<form id="newAForm"><label>Title<input type="text" id="aTitle" required></label><label>Class<select id="aClass">${classes.map(c=>`<option value="${c.id}">${c.name}</option>`).join('')}</select></label><label>Due<input type="date" id="aDue" required></label><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Create</button></div></form>`);
          setTimeout(()=> {
            const f = document.getElementById('newAForm');
            if (f) f.addEventListener('submit', (ev)=> {
              ev.preventDefault();
              const title = document.getElementById('aTitle').value.trim();
              const cls = document.getElementById('aClass').value;
              const due = document.getElementById('aDue').value;
              assignments.push({ id: 'A' + Math.floor(Math.random()*9999), title, classId: cls, due, submissions: 0 });
              renderAssignments();
              closeFormModal();
              alert('Assignment created');
            });
          }, 60);
        }

        // modal inline close button
        if (t.id === 'closeFormInline' || t.id === 'closeItemInline') {
          closeFormModal();
          closeItemModal();
        }
      });

      // Select change handlers
      document.getElementById('classSelect').addEventListener('change', (e)=> showRoster(e.target.value));
      document.getElementById('loadAttendanceBtn').addEventListener('click', ()=> {
        const cid = document.getElementById('attClassSelect').value;
        const date = document.getElementById('attDate').value || new Date().toISOString().slice(0,10);
        loadAttendance(cid, date);
      });

      document.getElementById('saveGradesBtn').addEventListener('click', ()=> {
        alert('Grades saved (mock).');
      });

      // Open/close modals helpers
      const itemModal = document.getElementById('itemModal');
      const itemModalBody = document.getElementById('itemModalBody');
      const closeItemModalBtn = document.getElementById('closeItemModal');
      function openItemModal(html) {
        itemModalBody.innerHTML = html;
        itemModal.classList.add('active');
        itemModal.setAttribute('aria-hidden','false');
        setTimeout(()=> closeItemModalBtn.focus(), 50);
      }
      function closeItemModal() {
        itemModal.classList.remove('active');
        itemModal.setAttribute('aria-hidden','true');
      }
      closeItemModalBtn.addEventListener('click', closeItemModal);

      const formModal = document.getElementById('formModal');
      const formModalBody = document.getElementById('formModalBody');
      const closeFormModalBtn = document.getElementById('closeFormModal');
      function openFormModal(titleHtml, bodyHtml) {
        document.getElementById('formModalTitle').textContent = titleHtml;
        formModalBody.innerHTML = bodyHtml || '';
        formModal.classList.add('active');
        formModal.setAttribute('aria-hidden','false');
      }
      function closeFormModal() {
        formModal.classList.remove('active');
        formModal.setAttribute('aria-hidden','true');
        formModalBody.innerHTML = '';
      }
      closeFormModalBtn.addEventListener('click', closeFormModal);

      // Close modals on Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          [itemModal, formModal].forEach(m => m.classList.remove('active'));
          overlay.classList.remove('visible');
        }
      });

      // Prevent accidental navigation when teaching (example)
      window.addEventListener('beforeunload', (e) => {
        // basic guard; in production check unsaved state
        if (false) { e.preventDefault(); e.returnValue = ''; }
      });

      // init UI
      init();

      // handle responsive initial sidebar state
      function handleResize() {
        if (window.innerWidth > 720) {
          sidebar.classList.remove('hidden');
          sidebar.classList.remove('open');
          overlay.classList.remove('visible');
          document.body.classList.remove('no-scroll');
        } else {
          sidebar.classList.add('hidden');
        }
      }
      window.addEventListener('resize', handleResize);
      handleResize();

      // simple deep-link navigation helper exposed in window for some dynamic buttons
      window.eg = { setActiveTab };

    })();
  </script>
</body>
</html>
