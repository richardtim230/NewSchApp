<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Others | ExamGuard ‚Äî Library, Hostel, Transport, Feeding, Birthdays</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <link rel="icon" href="../logo.png">
  <style>
    :root{
      --bg-0:#f6f8ff; --bg-1:#eef2ff;
      --accent:#3b82f6; --accent-2:#6366f1; --muted:#6b7280;
      --card-bg:#ffffff; --sidebar-w:300px;
      --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));-webkit-font-smoothing:antialiased;color:#0b2a44}
    a{color:inherit;text-decoration:none}
    .app{display:flex;min-height:100vh;align-items:stretch}
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.45);z-index:50;display:none}
    .overlay.visible{display:block}

    /* Sidebar (desktop instant show) */
    .sidebar{
      width:var(--sidebar-w);min-width:var(--sidebar-w);
      background:linear-gradient(180deg,#0f172a 0%, #1e3a8a 100%);color:#fff;padding:20px 16px;position:fixed;left:0;top:0;bottom:0;z-index:100;
      box-shadow:4px 0 28px rgba(15,23,42,0.12);display:flex;flex-direction:column;gap:14px;overflow-y:auto;transition:none;
    }
    @media (max-width:720px){
      .sidebar{transform:translateX(-110%);transition:transform .28s ease;position:fixed;width:86vw;min-width:86vw}
      .sidebar.hidden{transform:translateX(-110%)}
      .sidebar.open{transform:translateX(0);box-shadow:0 24px 48px rgba(2,6,23,0.5)}
    }

    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:3px solid rgba(255,224,102,0.12);background:#fff}
    .brand .title{font-weight:800;font-size:1.05rem;color:#ffe066}
    .nav{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .nav a{display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;font-weight:700;font-size:1rem;color:#e6eefc}
    .nav a.active,.nav a:hover{background:rgba(255,255,255,0.04);color:#ffe066}

    /* "Others" submenu (now inside sidebar) */
    .subnav{display:flex;flex-direction:column;gap:6px;margin-top:8px;padding-top:8px;border-top:1px dashed rgba(255,255,255,0.04)}
    .subnav a{padding:10px;border-radius:8px;color:var(--accent-2);font-weight:700;background:transparent}
    .subnav a.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff}

    .spacer{flex:1}
    .profile{display:flex;gap:12px;align-items:center;padding-top:10px;border-top:1px solid rgba(255,255,255,0.04)}
    .profile img{width:48px;height:48px;border-radius:10px;object-fit:cover;border:2px solid #ffe066}

    /* Topbar */
    .topbar{position:fixed;left:var(--sidebar-w);top:0;width:calc(100vw - var(--sidebar-w));z-index:90;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;backdrop-filter:blur(6px);background:rgba(255,255,255,0.86);border-bottom:1px solid rgba(11,42,60,0.06);box-shadow:0 6px 18px rgba(11,42,60,0.04);min-height:64px}
    @media (max-width:720px){.topbar{left:0;width:100vw;padding:10px 12px;min-height:56px}}

    .hamburger{display:none;background:var(--accent);color:#fff;border:none;padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:800}
    @media (max-width:980px){.hamburger{display:inline-flex}}

    .page-title{font-weight:800;font-size:1.05rem;color:var(--accent-2)}
    .small{font-size:0.92rem;color:var(--muted)}

    .main{margin-left:var(--sidebar-w);padding:20px;flex:1;transition:margin-left .28s;min-height:100vh;padding-top:90px;overflow-y:auto}
    @media (max-width:720px){.main{margin-left:0;padding:14px;padding-top:80px}}

    /* Content area */
    .content{display:flex;flex-direction:column;gap:12px}
    .section{background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid #eef3ff}
    .section h2{margin:0 0 8px 0;font-size:1.05rem}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}

    .card{background:#fff;border-radius:12px;padding:12px;border:1px solid #eef3ff;display:flex;flex-direction:column;gap:8px}
    .card .title{font-weight:800}
    .card .meta{color:var(--muted);font-size:0.92rem}

    /* small controls */
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:9px 12px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:800}
    .btn.ghost{background:transparent;color:var(--accent-2);border:1px solid rgba(59,130,246,0.08)}

    /* search/filter */
    .search-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .search-row input[type="search"], .search-row select{padding:8px;border-radius:8px;border:1px solid #e6e9ef;width:100%}

    /* modals */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:9999;padding:12px}
    .modal.active{display:flex}
    .modal .panel{background:#fff;border-radius:12px;max-width:900px;width:100%;overflow:hidden;box-shadow:0 20px 60px rgba(2,6,23,0.25)}
    .modal .head{padding:12px 16px;border-bottom:1px solid #eef3ff;background:#f8fbff;display:flex;justify-content:space-between;align-items:center}
    .modal .body{padding:14px;max-height:70vh;overflow:auto}

    .muted-small{font-size:0.9rem;color:var(--muted)}
    .empty{padding:28px;text-align:center;color:var(--muted);border:1px dashed #eef3ff;border-radius:12px}

    /* accessibility */
    :focus{outline:3px solid rgba(99,102,241,0.18);outline-offset:2px;border-radius:6px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="overlay" id="overlay" aria-hidden="true"></div>

    <aside class="sidebar" id="sidebar" aria-label="Main navigation" role="navigation" aria-hidden="false">
      <div class="brand">
        <img src="../logo.png" alt="logo">
        <div>
          <div class="title">Student Portal</div>
          <div class="small">Services</div>
        </div>
      </div>

      <nav class="nav" aria-label="primary">
        <a href="student.html">üè† Dashboard</a>
        <a href="/marketting/school-fees.html">üí≥ Fees</a>
        <a href="/marketting/cbt-exam.html">üñ•Ô∏è Exams</a>
        <!-- 'Others' top link remains but we also expose the subsection links below -->
        <a href="#library" class="active">üîó Others</a>

        <!-- Sub-menu for Others moved into the sidebar (clicking switches main content tabs) -->
        <div class="subnav" role="menu" aria-label="Other services submenu">
          <a href="#library" data-tab="library" class="sidebar-tab" role="menuitem">üìö Library</a>
          <a href="#hostel" data-tab="hostel" class="sidebar-tab" role="menuitem">üè† Hostel</a>
          <a href="#transport" data-tab="transport" class="sidebar-tab" role="menuitem">üöå Transportation</a>
          <a href="#feeding" data-tab="feeding" class="sidebar-tab" role="menuitem">üçΩÔ∏è Feeding</a>
          <a href="#birthdays" data-tab="birthdays" class="sidebar-tab" role="menuitem">üéÇ Birthdays</a>
        </div>
      </nav>

      <div class="spacer" aria-hidden="true"></div>

      <div class="profile">
        <img src="../avatar.jpg" alt="student" style="width:44px;height:44px;border-radius:8px">
        <div>
          <div style="font-weight:800" id="studentName">Adaobi Chukwu</div>
          <div class="muted-small" id="studentClass">SS2 ‚Äî Biology</div>
        </div>
      </div>
    </aside>

    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center;">
        <button class="hamburger" id="hamburger" aria-label="Open menu">‚ò∞</button>
        <div>
          <div class="page-title">Others</div>
          <div class="small muted">Library, Hostel, Transport, Feeding & Birthdays</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center;">
        <img src="../avatar.jpg" alt="you" style="width:44px;height:44px;border-radius:8px;border:2px solid #fff">
      </div>
    </div>

    <main class="main" id="main" role="main" tabindex="-1">
      <div class="content" id="contentArea">
        <!-- Library -->
        <section id="library" class="section tab-section" role="region" aria-labelledby="libTitle">
          <h2 id="libTitle">Library</h2>
          <div class="muted-small">Search catalogue, request books and view current loans.</div>

          <div style="margin-top:12px" class="search-row">
            <input type="search" id="libSearch" placeholder="Search by title, author or ISBN" aria-label="Search library">
            <select id="libFilter">
              <option value="">All categories</option>
              <option>Science</option>
              <option>Mathematics</option>
              <option>Literature</option>
              <option>History</option>
            </select>
            <button class="btn" id="libNewReq">Request book</button>
          </div>

          <div style="margin-top:12px" id="libGridWrap">
            <div class="grid" id="libGrid" aria-live="polite"></div>
          </div>
        </section>

        <!-- Hostel -->
        <section id="hostel" class="section tab-section" role="region" aria-labelledby="hostelTitle" style="display:none">
          <h2 id="hostelTitle">Hostel</h2>
          <div class="muted-small">Room assignments, availability and lodging requests.</div>

          <div style="margin-top:12px" class="controls">
            <button class="btn" id="hostelAvailableBtn">Show available rooms</button>
            <button class="btn ghost" id="hostelApplyBtn">Apply for lodging</button>
          </div>

          <div style="margin-top:12px" id="hostelGridWrap">
            <div class="grid" id="hostelGrid"></div>
          </div>
        </section>

        <!-- Transportation -->
        <section id="transport" class="section tab-section" role="region" aria-labelledby="transportTitle" style="display:none">
          <h2 id="transportTitle">Transportation</h2>
          <div class="muted-small">Routes, schedules and bus reservations.</div>

          <div style="margin-top:12px" class="search-row">
            <select id="routeFilter">
              <option value="">All routes</option>
              <option value="A">Route A ‚Äî North</option>
              <option value="B">Route B ‚Äî East</option>
              <option value="C">Route C ‚Äî West</option>
            </select>
            <button class="btn" id="reserveSeatBtn">Reserve seat</button>
          </div>

          <div style="margin-top:12px" id="routesWrap">
            <div class="grid" id="routesGrid"></div>
          </div>
        </section>

        <!-- Feeding -->
        <section id="feeding" class="section tab-section" role="region" aria-labelledby="feedingTitle" style="display:none">
          <h2 id="feedingTitle">Feeding</h2>
          <div class="muted-small">Daily menus, meal plans and special dietary requests.</div>

          <div style="margin-top:12px" class="controls">
            <button class="btn" id="viewMenuBtn">View this week menu</button>
            <button class="btn ghost" id="dietReqBtn">Submit dietary request</button>
          </div>

          <div style="margin-top:12px" id="menuWrap"></div>
        </section>

        <!-- Birthdays -->
        <section id="birthdays" class="section tab-section" role="region" aria-labelledby="bdayTitle" style="display:none">
          <h2 id="bdayTitle">Birthdays</h2>
          <div class="muted-small">Celebrate classmates ‚Äî upcoming and recent birthdays.</div>

          <div style="margin-top:12px" id="bdayWrap"></div>
        </section>
      </div>
    </main>

    <!-- Generic details modal used for items -->
    <div class="modal" id="detailModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="detailTitle">
      <div class="panel" role="document">
        <div class="head">
          <div id="detailTitle" style="font-weight:800">Details</div>
          <div><button class="btn ghost" id="closeDetailBtn">Close</button></div>
        </div>
        <div class="body" id="detailBody"></div>
      </div>
    </div>

    <!-- Simple booking/request modal -->
    <div class="modal" id="formModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="formTitle">
      <div class="panel" role="document">
        <div class="head">
          <div id="formTitle" style="font-weight:800">Request</div>
          <div><button class="btn ghost" id="closeFormBtn">Close</button></div>
        </div>
        <div class="body">
          <form id="genericForm">
            <div style="display:grid;gap:8px">
              <label>Reason / Note<input type="text" id="formNote" required style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef"></label>
              <label>Contact phone<input type="tel" id="formPhone" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef"></label>
              <div style="display:flex;gap:8px;justify-content:flex-end">
                <button type="button" class="btn ghost" id="cancelFormBtn">Cancel</button>
                <button type="submit" class="btn" id="submitFormBtn">Submit</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

  </div>

  <script>
    (function () {
      // Sidebar mobile handlers (consistent pattern used earlier)
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const hamburger = document.getElementById('hamburger');
      if (hamburger) {
        hamburger.addEventListener('click', () => {
          sidebar.classList.remove('hidden');
          sidebar.classList.add('open');
          overlay.classList.add('visible');
          document.body.classList.add('no-scroll');
        });
        overlay.addEventListener('click', () => {
          sidebar.classList.remove('open');
          sidebar.classList.add('hidden');
          overlay.classList.remove('visible');
          document.body.classList.remove('no-scroll');
        });
      }

      // Sidebar-driven tab system
      const sidebarTabs = Array.from(document.querySelectorAll('.sidebar-tab'));
      const tabSections = Array.from(document.querySelectorAll('.tab-section'));

      function setActiveTab(name, push = true) {
        // Update sidebar links
        sidebarTabs.forEach(t => {
          const is = t.dataset.tab === name;
          t.classList.toggle('active', is);
          t.setAttribute('aria-current', is ? 'true' : 'false');
        });
        // Show the matching section
        tabSections.forEach(s => {
          s.style.display = s.id === name ? '' : 'none';
        });
        if (push) history.replaceState(null, '', '#' + name);
        // Ensure on mobile the sidebar is closed after selection
        if (window.innerWidth <= 720) {
          sidebar.classList.remove('open');
          sidebar.classList.add('hidden');
          overlay.classList.remove('visible');
          document.body.classList.remove('no-scroll');
        }
        // focus first interactive element in the active section
        const sec = document.getElementById(name);
        if (sec) {
          const focusable = sec.querySelector('button, [href], input, select, textarea');
          if (focusable) focusable.focus();
        }
      }

      sidebarTabs.forEach(t => {
        t.addEventListener('click', (e) => {
          e.preventDefault();
          const name = t.dataset.tab;
          setActiveTab(name);
        });
      });

      // Initialize from hash (deep linking)
      const initialHash = (location.hash || '').replace('#', '') || 'library';
      setActiveTab(initialHash, false);

      // update if user navigates history
      window.addEventListener('hashchange', () => {
        const h = (location.hash || '').replace('#', '') || 'library';
        setActiveTab(h, false);
      });

      // Modal helpers
      const detailModal = document.getElementById('detailModal');
      const detailBody = document.getElementById('detailBody');
      const closeDetailBtn = document.getElementById('closeDetailBtn');
      const formModal = document.getElementById('formModal');
      const closeFormBtn = document.getElementById('closeFormBtn');
      const cancelFormBtn = document.getElementById('cancelFormBtn');
      const genericForm = document.getElementById('genericForm');

      function openDetail(html) {
        detailBody.innerHTML = html;
        detailModal.classList.add('active');
        detailModal.setAttribute('aria-hidden', 'false');
        setTimeout(()=> closeDetailBtn.focus(), 50);
      }
      function closeDetail() {
        detailModal.classList.remove('active');
        detailModal.setAttribute('aria-hidden', 'true');
      }
      closeDetailBtn.addEventListener('click', closeDetail);

      function openForm(title, callback) {
        document.getElementById('formTitle').textContent = title || 'Request';
        genericForm._callback = callback;
        formModal.classList.add('active');
        formModal.setAttribute('aria-hidden', 'false');
        setTimeout(()=> document.getElementById('formNote').focus(), 50);
      }
      function closeForm() {
        formModal.classList.remove('active');
        formModal.setAttribute('aria-hidden', 'true');
        genericForm.reset();
      }
      closeFormBtn.addEventListener('click', closeForm);
      cancelFormBtn.addEventListener('click', closeForm);
      genericForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const note = document.getElementById('formNote').value.trim();
        const phone = document.getElementById('formPhone').value.trim();
        if (!note) {
          alert('Please enter a note or reason.');
          return;
        }
        if (typeof genericForm._callback === 'function') genericForm._callback({ note, phone });
        closeForm();
        alert('Request submitted. The administration will respond shortly.');
      });

      // Sample data for sections (same as before)
      const libraryBooks = [
        { id:'B001', title:'Biology Concepts', author:'E. Faraday', cat:'Science', available:true, isbn:'978-1' },
        { id:'B002', title:'Algebra Essentials', author:'M. N' , cat:'Mathematics', available:false, isbn:'978-2' },
        { id:'B003', title:'English Literature', author:'A. Bronte', cat:'Literature', available:true, isbn:'978-3' },
        { id:'B004', title:'World History', author:'S. King', cat:'History', available:true, isbn:'978-4' }
      ];

      const hostelRooms = [
        { id:'H101', block:'A', type:'Single', occupant:null },
        { id:'H102', block:'A', type:'Double', occupant:'Student A' },
        { id:'H201', block:'B', type:'Single', occupant:null },
        { id:'H202', block:'B', type:'Double', occupant:'Student B' }
      ];

      const routes = [
        { id:'A', name:'Route A ‚Äî North', schedule:'06:30, 07:30, 15:30', seats:40 },
        { id:'B', name:'Route B ‚Äî East', schedule:'06:45, 07:45, 15:45', seats:40 },
        { id:'C', name:'Route C ‚Äî West', schedule:'07:00, 08:00, 16:00', seats:40 }
      ];

      const menus = [
        { day:'Monday', breakfast:'Pancakes', lunch:'Jollof rice & chicken', dinner:'Spaghetti' },
        { day:'Tuesday', breakfast:'Bread & eggs', lunch:'Beans & plantain', dinner:'Rice stew' },
        { day:'Wednesday', breakfast:'Yoghurt & oats', lunch:'Efo riro', dinner:'Fufu & soup' },
        { day:'Thursday', breakfast:'Akamu & akara', lunch:'Fried rice', dinner:'Porridge' },
        { day:'Friday', breakfast:'Bread & tea', lunch:'Pasta', dinner:'Chicken soup' }
      ];

      const birthdays = [
        { name:'Chinonso', date:'2026-03-02', class:'SS2' },
        { name:'Mercy', date:'2026-03-05', class:'SS2' },
        { name:'Daniel', date:'2026-04-01', class:'SS1' }
      ];

      // Renderers (same as before)
      function renderLibrary(list = libraryBooks) {
        const grid = document.getElementById('libGrid');
        grid.innerHTML = '';
        list.forEach(b=>{
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div class="title">${b.title}</div><div class="meta">${b.author} ‚Ä¢ ${b.cat}</div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <button class="btn" data-id="${b.id}" data-action="view">View</button>
              <button class="btn ghost" data-id="${b.id}" data-action="${b.available ? 'request' : 'waitlist'}">${b.available ? 'Request' : 'Join waitlist'}</button>
            </div>
          `;
          grid.appendChild(c);
        });
      }

      function renderHostel() {
        const grid = document.getElementById('hostelGrid');
        grid.innerHTML = '';
        hostelRooms.forEach(r=>{
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div class="title">${r.id} ‚Äî Block ${r.block}</div><div class="meta">${r.type} ‚Ä¢ ${r.occupant ? 'Occupied' : 'Available'}</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn ghost" data-id="${r.id}" data-action="details">Details</button>
              ${r.occupant ? '' : `<button class="btn" data-id="${r.id}" data-action="book">Apply</button>`}
            </div>`;
          grid.appendChild(c);
        });
      }

      function renderRoutes(list = routes) {
        const grid = document.getElementById('routesGrid');
        grid.innerHTML = '';
        list.forEach(rt=>{
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div class="title">${rt.name}</div><div class="meta">Schedule: ${rt.schedule}</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" data-id="${rt.id}" data-action="reserve">Reserve seat</button>
              <button class="btn ghost" data-id="${rt.id}" data-action="view">View</button>
            </div>`;
          grid.appendChild(c);
        });
      }

      function renderMenu() {
        const wrap = document.getElementById('menuWrap');
        wrap.innerHTML = '';
        const g = document.createElement('div'); g.className='grid';
        menus.forEach(m=>{
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div style="font-weight:800">${m.day}</div><div class="muted-small">Breakfast: ${m.breakfast}</div><div class="muted-small">Lunch: ${m.lunch}</div><div class="muted-small">Dinner: ${m.dinner}</div>`;
          g.appendChild(c);
        });
        wrap.appendChild(g);
      }

      function renderBirthdays() {
        const wrap = document.getElementById('bdayWrap');
        wrap.innerHTML = '';
        if (birthdays.length === 0) {
          wrap.innerHTML = '<div class="empty">No upcoming birthdays</div>';
          return;
        }
        const g = document.createElement('div'); g.className='grid';
        birthdays.forEach(b=>{
          const c = document.createElement('article'); c.className='card';
          c.innerHTML = `<div style="font-weight:800">${b.name}</div><div class="muted-small">${new Date(b.date).toLocaleDateString()} ‚Ä¢ ${b.class}</div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" data-action="wish" data-name="${b.name}">Send wish</button>
              <button class="btn ghost" data-action="view" data-name="${b.name}">View</button>
            </div>`;
          g.appendChild(c);
        });
        wrap.appendChild(g);
      }

      // Initial render
      renderLibrary();
      renderHostel();
      renderRoutes();
      renderMenu();
      renderBirthdays();

      // Delegate click actions
      document.body.addEventListener('click', (e) => {
        const t = e.target;
        // library actions
        if (t.matches('button[data-action="view"]') && t.closest('#libGrid')) {
          const id = t.dataset.id;
          const book = libraryBooks.find(b => b.id === id);
          if (book) openDetail(`<div style="font-weight:800">${book.title}</div><div class="muted-small">${book.author} ‚Ä¢ ${book.cat}</div><div style="margin-top:8px">ISBN: ${book.isbn}</div><div style="margin-top:10px">${book.available ? '<strong>Available</strong>' : '<strong>Not available</strong>'}</div>`);
        }
        if (t.matches('button[data-action="request"]')) {
          const id = t.dataset.id;
          openForm('Request book', ({note, phone}) => {
            console.log('Book request', id, note, phone);
          });
        }
        if (t.matches('button[data-action="waitlist"]')) {
          const id = t.dataset.id;
          alert('You were added to the waitlist for book ' + id);
        }

        // hostel actions
        if (t.matches('button[data-action="details"]') && t.closest('#hostelGrid')) {
          const id = t.dataset.id;
          const room = hostelRooms.find(r => r.id === id);
          if (room) openDetail(`<div style="font-weight:800">Room ${room.id}</div><div class="muted-small">Block ${room.block} ‚Ä¢ ${room.type}</div><div style="margin-top:8px">${room.occupant ? 'Occupied by ' + room.occupant : 'Currently available'}</div>`);
        }
        if (t.matches('button[data-action="book"]')) {
          const id = t.dataset.id;
          openForm('Hostel application', (data) => {
            console.log('Hostel apply', id, data);
            alert('Hostel application submitted for ' + id);
          });
        }

        // transport actions
        if (t.matches('button[data-action="reserve"]')) {
          const id = t.dataset.id;
          openForm('Reserve seat ‚Äî Route ' + id, (data) => {
            console.log('Reserve', id, data);
            alert('Seat reserved on route ' + id);
          });
        }
        if (t.matches('#reserveSeatBtn')) {
          openForm('Reserve seat', (data) => alert('Seat reservation request submitted.'));
        }

        // Feeding
        if (t.matches('#viewMenuBtn')) {
          // switch to feeding tab if not active
          setActiveTabIfNeeded('feeding');
        }
        if (t.matches('#dietReqBtn')) {
          openForm('Dietary request', (data) => alert('Dietary request submitted.'));
        }

        // birthdays
        if (t.matches('button[data-action="wish"]')) {
          const name = t.dataset.name;
          openForm('Send birthday wish', data => {
            alert(`Birthday wish sent to ${name}.`);
          });
        }

        // generic: detail view for routes
        if (t.matches('button[data-action="view"]') && t.closest('#routesGrid')) {
          const id = t.dataset.id;
          const rt = routes.find(r => r.id === id);
          if (rt) openDetail(`<div style="font-weight:800">${rt.name}</div><div class="muted-small">Schedule: ${rt.schedule}</div><div style="margin-top:8px">Seats: ${rt.seats}</div>`);
        }
      });

      // Utility to switch tab if not active
      function setActiveTabIfNeeded(name) {
        const current = (location.hash || '').replace('#', '') || 'library';
        if (current !== name) {
          history.replaceState(null, '', '#' + name);
          const ev = new Event('hashchange'); window.dispatchEvent(ev);
        }
      }

      // Search/filter handlers
      document.getElementById('libSearch').addEventListener('input', (e) => {
        const q = e.target.value.trim().toLowerCase();
        const cat = document.getElementById('libFilter').value;
        const filtered = libraryBooks.filter(b => {
          if (cat && b.cat !== cat) return false;
          if (!q) return true;
          return (b.title + ' ' + b.author + ' ' + b.isbn).toLowerCase().includes(q);
        });
        renderLibrary(filtered);
      });
      document.getElementById('libFilter').addEventListener('change', () => {
        document.getElementById('libSearch').dispatchEvent(new Event('input'));
      });
      document.getElementById('libNewReq').addEventListener('click', () => openForm('Request new book', data => console.log('Requesting book', data)));

      document.getElementById('hostelAvailableBtn').addEventListener('click', () => {
        const avail = hostelRooms.filter(r => !r.occupant);
        if (!avail.length) { alert('No available rooms currently'); return; }
        openDetail(`<div style="font-weight:800">Available rooms</div><ul>${avail.map(a=>`<li>${a.id} ‚Ä¢ ${a.type} ‚Ä¢ Block ${a.block}</li>`).join('')}</ul>`);
      });
      document.getElementById('hostelApplyBtn').addEventListener('click', () => openForm('Hostel application', (d) => alert('Hostel application noted')));

      // route filter
      document.getElementById('routeFilter').addEventListener('change', (e) => {
        const v = e.target.value;
        if (!v) renderRoutes(routes);
        else renderRoutes(routes.filter(r => r.id === v));
      });

      // Keyboard / accessibility: close modals on Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          [detailModal, formModal].forEach(m => m.classList.remove('active'));
          overlay.classList.remove('visible');
        }
      });

      // Close modals clicking overlay
      overlay.addEventListener('click', () => {
        [detailModal, formModal].forEach(m => m.classList.remove('active'));
      });

      // Close modal buttons also hide overlay if present
      closeDetailBtn.addEventListener('click', ()=> {
        detailModal.classList.remove('active');
      });
      closeFormBtn.addEventListener('click', ()=> {
        formModal.classList.remove('active');
      });

      // Ensure correct tab gets activated on first load (handles cases when loaded without hash)
      if (!location.hash) history.replaceState(null, '', '#library');

    })();
  </script>
</body>
</html>
