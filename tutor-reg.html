<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OAU ExamGuard — Tutor Registration</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <style>
    .input-label { font-weight: 600; font-size: 15px; color: #6366f1; }
    .input-base {
      background: #f3f4f6; border: 1.5px solid #a7f3d0; border-radius: 10px;
      font-size: 17px; padding: 1rem; box-sizing: border-box; width: 100%;
      transition: border .16s;
    }
    .input-base:focus { border-color: #6366f1; outline: none; }
    .specialty-pill {
      background: #6366f1; color: #fff; border-radius: 13px; font-size: 14px;
      padding: 4px 13px; margin: 0 8px 8px 0; display: inline-block; font-weight: 500;
      box-shadow: 0 1px 2px rgba(99,102,241,0.06); cursor: pointer;
    }
    .specialty-pill.selected { background: #3b82f6; color: #fff; border:2px solid #fff; }
    .bg-form-section {
      background: #fff; border-radius: 16px;
      box-shadow: 0 6px 28px rgba(99,102,241,0.09), 0 2px 10px rgba(31,41,55,.10);
    }
    .sidebar-gradient {
      background: linear-gradient(135deg,#f1f5fe 70%, #e0e7ff 98%);
      border-top-right-radius: 2.2rem; border-bottom-right-radius: 2.2rem;
      box-shadow: 3px 0 28px 0 rgba(99,102,241,0.06);
    }
    @keyframes fadeInDown { from {opacity: 0;transform: translateY(-12px);} to {opacity: 1;transform: none;} }
    .animate-fadeInDown {animation:fadeInDown .65s;}
    @media (max-width: 1023px) { .sidebar-gradient {display:none;} }
    .avatar-preview { width:86px; height:86px; border-radius:12px; object-fit:cover; border:1px solid #e6e6e6; }
    .password-toggle { cursor:pointer; color:#6366f1; }
  </style>
</head>
<body class="h-full bg-slate-50 font-sans">

  <!-- HEADER -->
  <header class="bg-white/90 border-b shadow-md fixed top-0 left-0 right-0 z-40 w-full">
    <div class="flex items-center justify-between w-full max-w-full px-3 sm:px-6 md:px-10 py-2 md:py-3 mx-auto" style="max-width:2000px;">
      <div class="flex items-center gap-4">
        <span class="text-indigo-800 font-extrabold text-xl sm:text-2xl flex items-center gap-2">
          <img src="https://ui-avatars.com/api/?name=OAU&background=ede9fe&color=3b82f6&size=40" alt="logo" class="w-8 h-8 rounded-full" />
          OAU ExamGuard
        </span>
        <span class="text-xs sm:text-sm text-gray-500 pl-2 sm:pl-4 font-medium border-l border-gray-200 hidden sm:inline-block">Request a Tutor</span>
      </div>
      <nav class="hidden sm:flex gap-4 font-semibold items-center">
        <a href="#" class="hover:text-indigo-600 text-indigo-700 transition">Dashboard</a>
        <a href="#" class="hover:text-indigo-700 text-gray-700 transition">Earnings</a>
        <a href="#" class="hover:text-indigo-700 text-gray-700 transition">Transfer</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <div class="relative z-10 w-full overflow-hidden" style="min-height:260px;">
    <div class="relative max-w-3xl mx-auto pt-32 pb-16 px-3 flex flex-col items-center text-center">
      <div class="mb-5 flex items-center gap-4">
        <span class="rounded-full bg-gradient-to-br from-green-400 via-blue-400 to-indigo-500 text-white px-4 py-2 text-lg md:text-xl shadow font-bold tracking-tight">
          <i class="fa-solid fa-user-plus mr-2"></i> Become a Tutor
        </span>
      </div>
      <h1 class="font-extrabold text-3xl sm:text-4xl md:text-5xl leading-tight text-indigo-900 mb-4 z-10">
        Inspire. Mentor. Earn.<br>
        <span class="bg-gradient-to-r from-indigo-500 via-purple-500 to-emerald-400 text-transparent bg-clip-text">Join ExamGuard’s Elite Panel.</span>
      </h1>
      <p class="text-lg md:text-2xl text-indigo-800 font-semibold mb-4 max-w-xl mx-auto">Share your expertise, help students excel, and grow your reputation among Nigeria's top educators.</p>
      <a href="#tutorRegForm" class="mt-8 inline-flex items-center gap-2 rounded-full bg-gradient-to-tr from-indigo-600 via-blue-500 to-emerald-500 text-white shadow-lg font-bold px-8 py-3">
        <span>Get Started</span> <i class="fa fa-arrow-down"></i>
      </a>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-2 lg:px-8 pt-10 pb-16 flex flex-col lg:flex-row gap-8 animate-fadeInDown">
    <!-- SIDEBAR -->
    <aside class="sidebar-gradient w-full max-w-[350px] p-8 hidden lg:flex flex-col gap-8 sticky top-32 h-fit border border-indigo-50">
      <div>
        <div class="flex items-center gap-2 font-bold text-indigo-700 text-xl mb-3">
          <i class="fa-solid fa-user-plus"></i> Tutor Registration Guide
        </div>
        <ul class="list-disc pl-5 text-md text-slate-700 space-y-2">
          <li>Use your real name and a valid email address.</li>
          <li>Select specialties reflecting your best teaching areas.</li>
          <li>Highlight achievements and awards for better ranking.</li>
          <li>Upload a clear, professional profile photo.</li>
          <li>Pick a unique username and secure password for your dashboard.</li>
        </ul>
      </div>
      <div>
        <div class="font-bold text-base text-indigo-700 mb-2 flex gap-2 items-center"><i class="fa-solid fa-award"></i> Why register?</div>
        <ul class="text-base text-slate-600 space-y-1">
          <li>✓ Get matched with students needing your skills</li>
          <li>✓ Increase visibility for campus & national awards</li>
          <li>✓ Join OAU's elite teaching community</li>
        </ul>
      </div>
      <div>
        <div class="flex items-center gap-2 text-indigo-600 font-bold"><i class="fa-solid fa-circle-question"></i>Need help?</div>
        <div class="text-base text-slate-600 mt-1">Reach out at <a href="mailto:support@examguard.com" class="text-indigo-700 underline hover:text-indigo-900">support@examguard.com</a></div>
      </div>
    </aside>

    <!-- FORM -->
    <section class="flex-1">
      <form id="tutorRegForm" class="bg-form-section px-8 py-10 shadow-md mt-0" autocomplete="off">
        <!-- Login Credentials -->
        <div class="mb-8">
          <h2 class="text-2xl font-bold text-indigo-800 mb-2">Account Credentials</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-7">
            <div>
              <label class="input-label mb-2">Username *</label>
              <input id="username" name="username" required maxlength="30" class="input-base" placeholder="Choose a unique username" />
              <p class="text-xs text-slate-400 mt-1">Used to log in to your tutor dashboard.</p>
            </div>
            <div>
              <label class="input-label mb-2">Password *</label>
              <div class="relative">
                <input id="password" name="password" type="password" required minlength="6" class="input-base pr-28" placeholder="Create a strong password" />
                <span id="togglePass" class="absolute right-4 top-3 password-toggle" title="Show / hide password"><i class="fa fa-eye"></i></span>
              </div>
              <p id="pwdStrength" class="text-xs text-slate-400 mt-1"></p>
            </div>
            <div>
              <label class="input-label mb-2">Confirm Password *</label>
              <input id="confirmPassword" name="confirmPassword" type="password" required minlength="6" class="input-base" placeholder="Repeat password" />
            </div>
          </div>
        </div>

        <!-- Personal Details -->
        <div class="mb-8">
          <h2 class="text-2xl font-bold text-indigo-800 mb-2">Personal Details</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-7">
            <div>
              <label class="input-label mb-2">Full Name *</label>
              <input id="fullname" name="fullname" required maxlength="60" class="input-base" placeholder="Type your full name" />
            </div>
            <div>
              <label class="input-label mb-2">Email *</label>
              <input id="email" name="email" required type="email" maxlength="80" class="input-base" placeholder="Email address" />
            </div>
            <div>
              <label class="input-label mb-2">Phone *</label>
              <input id="phone" name="phone" required type="tel" maxlength="20" class="input-base" placeholder="Phone number" />
            </div>
            <div>
              <label class="input-label mb-2">LinkedIn Profile</label>
              <input id="linkedin" name="linkedin" type="url" class="input-base" placeholder="LinkedIn URL" />
            </div>
          </div>
        </div>

        <!-- Tutor Profile -->
        <div class="mb-8">
          <h2 class="text-xl font-bold text-indigo-800 mb-2">Tutor Profile</h2>
          <div class="mb-4">
            <label class="input-label mb-2">Summary/About *</label>
            <textarea id="about" name="about" required class="input-base" rows="3" maxlength="350" placeholder="Brief profile, teaching style, key achievement"></textarea>
          </div>
          <div class="mb-4">
            <label class="input-label mb-2">Upload Photo *</label>
            <div class="flex items-center gap-3">
              <input id="avatar" name="avatar" type="file" accept="image/*" required class="input-base px-0 bg-transparent border-none text-sm" />
              <img id="avatarPreview" class="avatar-preview hidden" alt="Preview" />
            </div>
            <p class="text-xs text-slate-500 mt-2">We will upload your photo to ExamGuide and use it on your profile.</p>
          </div>
        </div>

        <!-- Specialties -->
        <div class="mb-8">
          <h2 class="text-xl font-bold text-indigo-800 mb-2">Specialties & Subjects</h2>
          <div class="mb-2 text-sm text-gray-700">Select your tutoring specialties (up to 4). Or type to add new ones:</div>
          <div id="specialtiesArea" class="flex flex-wrap gap-2 mb-2"></div>
          <input id="specialtyInput" type="text" class="input-base text-sm mb-1 w-44 inline-block" placeholder="Add new specialty..." />
          <p class="text-xs text-slate-500 mt-1">Tip: Click pills to toggle selection.</p>
        </div>

        <!-- Achievements -->
        <div class="mb-8">
          <h2 class="text-xl font-bold text-indigo-800 mb-2">Achievements & Credentials</h2>
          <div class="mb-2 text-sm text-gray-700">Highlight recognitions, awards, publications, or outstanding records:</div>
          <div id="achArea" class="flex flex-col gap-2 mb-2"></div>
          <div class="flex gap-2">
            <input id="achInput" type="text" class="input-base text-sm mb-1" placeholder="e.g. Best WAEC Tutor Award 2023" />
            <button type="button" id="addAchBtn" class="bg-indigo-500 text-white rounded px-3 py-2 text-sm">Add</button>
          </div>
          <p class="text-xs text-slate-500 mt-1">You can add up to 6 achievements.</p>
        </div>

        <div class="mb-5 text-right">
          <button type="submit" class="bg-indigo-700 hover:bg-indigo-900 shadow text-white text-lg px-10 py-3 rounded-xl font-bold mt-1 transition active:scale-95" id="submitBtn">
            <span id="submitBtnText">Submit Application</span>
            <svg id="spinner" class="hidden animate-spin w-5 h-5 inline-block ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
          </button>
        </div>

        <div id="formMsg" class="mt-3 text-center text-base font-semibold"></div>
      </form>
    </section>
  </main>

  <footer class="text-center text-xs text-gray-400 mt-20 mb-7">&copy; OAU ExamGuard — Tutors</footer>

<script>
/* Frontend integrates with backend:
   - Image upload: POST /api/images (expects FormData { image })
   - Tutor application: POST /api/tutors/register (JSON)
   We now collect username & password and include them in the payload.
*/
const API_BASE = "https://examguide.onrender.com";

const popularSpecialties = [
  "Mathematics", "English", "Physics", "Chemistry", "Biology", "WAEC/UTME Prep",
  "Computer Science", "Essay Writing", "Olympiad Coaching", "Robotics",
  "Practical Science", "JAMB Prep", "IGCSE", "A-Levels", "Python Coding", "Interview Prep"
];

const specialtiesArea = document.getElementById('specialtiesArea');
const specialtyInput = document.getElementById('specialtyInput');
let selectedSpecialties = [];

function renderSpecialties() {
  specialtiesArea.innerHTML = "";
  const combined = popularSpecialties.concat(selectedSpecialties.filter(s => !popularSpecialties.includes(s)));
  combined.forEach(sp => {
    const isSelected = selectedSpecialties.includes(sp);
    const span = document.createElement('span');
    span.className = 'specialty-pill' + (isSelected ? ' selected' : '');
    span.textContent = sp;
    span.onclick = () => toggleSpecialty(sp);
    specialtiesArea.appendChild(span);
  });
}

window.toggleSpecialty = function(sp) {
  if (selectedSpecialties.includes(sp)) selectedSpecialties = selectedSpecialties.filter(s => s !== sp);
  else if (selectedSpecialties.length < 4) selectedSpecialties.push(sp);
  renderSpecialties();
};

specialtyInput.addEventListener('keydown', e => {
  if (e.key === "Enter" || e.key === "," || e.key === "Tab") {
    e.preventDefault();
    let val = specialtyInput.value.trim();
    if (val && !selectedSpecialties.includes(val) && selectedSpecialties.length < 4) {
      selectedSpecialties.push(val);
      specialtyInput.value = "";
      renderSpecialties();
    }
  }
});
specialtyInput.addEventListener('blur', () => {
  let val = specialtyInput.value.trim();
  if (val && !selectedSpecialties.includes(val) && selectedSpecialties.length < 4) {
    selectedSpecialties.push(val);
    specialtyInput.value = "";
    renderSpecialties();
  }
});

// Achievements
const achArea = document.getElementById('achArea');
const achInput = document.getElementById('achInput');
const addAchBtn = document.getElementById('addAchBtn');
let achievements = [];

function renderAchievements() {
  achArea.innerHTML = "";
  achievements.forEach((a, idx) => {
    const wrapper = document.createElement('div');
    wrapper.className = "flex items-center gap-2";
    wrapper.innerHTML = `<span class="inline-block px-3 py-2 rounded bg-indigo-50 text-indigo-900 font-semibold text-sm">${escapeHtml(a)}</span>`;
    const btn = document.createElement('button');
    btn.type = "button";
    btn.className = "text-red-500 px-2 py-1";
    btn.innerHTML = '<i class="fa fa-times"></i>';
    btn.onclick = () => { removeAch(idx); };
    wrapper.appendChild(btn);
    achArea.appendChild(wrapper);
  });
}

window.removeAch = function(idx) {
  achievements.splice(idx, 1);
  renderAchievements();
};

addAchBtn.addEventListener('click', () => {
  let val = achInput.value.trim();
  if (val && achievements.length < 6) {
    achievements.push(val);
    achInput.value = "";
    renderAchievements();
  }
});

// Avatar preview & validation
const avatarInput = document.getElementById('avatar');
const avatarPreview = document.getElementById('avatarPreview');
avatarInput.addEventListener('change', () => {
  const file = avatarInput.files[0];
  if (!file) { avatarPreview.classList.add('hidden'); return; }
  if (!file.type.startsWith('image/')) {
    alert('Please select an image file for your photo.');
    avatarInput.value = "";
    avatarPreview.classList.add('hidden');
    return;
  }
  const reader = new FileReader();
  reader.onload = (ev) => {
    avatarPreview.src = ev.target.result;
    avatarPreview.classList.remove('hidden');
  };
  reader.readAsDataURL(file);
});

// Password toggle & strength hint
const pwd = document.getElementById('password');
const togglePass = document.getElementById('togglePass');
const pwdStrength = document.getElementById('pwdStrength');

togglePass.addEventListener('click', () => {
  const t = pwd.type === 'password' ? 'text' : 'password';
  pwd.type = t;
  togglePass.innerHTML = t === 'text' ? '<i class="fa fa-eye-slash"></i>' : '<i class="fa fa-eye"></i>';
});

pwd.addEventListener('input', () => {
  const s = strength(pwd.value);
  pwdStrength.textContent = s.text;
  pwdStrength.style.color = s.color;
});

function strength(p) {
  if (!p) return { text: '', color: '#6b7280' };
  const len = p.length;
  const strong = /(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}/;
  const medium = /(?=.*[a-z])(?=.*\d).{6,}/;
  if (strong.test(p)) return { text: 'Strong password', color: '#047857' };
  if (medium.test(p)) return { text: 'Medium strength', color: '#b45309' };
  if (len >= 6) return { text: 'Weak (add mixed case, digits, symbols)', color: '#b91c1c' };
  return { text: 'Too short', color: '#b91c1c' };
}

// Escape helper
function escapeHtml(unsafe) {
  return unsafe.replace(/[&<"']/g, function(m) {
    return ({'&':'&amp;','<':'&lt;','"':'&quot;',"'":'&#039;'}[m]);
  });
}

// UI helpers
const formMsg = document.getElementById('formMsg');
const submitBtn = document.getElementById('submitBtn');
const submitBtnText = document.getElementById('submitBtnText');
const spinner = document.getElementById('spinner');

function setLoading(isLoading) {
  submitBtn.disabled = isLoading;
  spinner.classList.toggle('hidden', !isLoading);
  submitBtnText.textContent = isLoading ? 'Submitting...' : 'Submit Application';
}

// Upload image to backend image endpoint; returns url string
async function uploadImageToServer(file) {
  const fd = new FormData();
  fd.append('image', file);
  const res = await fetch(`${API_BASE}/api/images`, {
    method: 'POST',
    body: fd
  });
  if (!res.ok) {
    const text = await res.text();
    throw new Error(`Image upload failed: ${res.status} ${text}`);
  }
  const json = await res.json();
  if (!json || !json.url) throw new Error('Image upload returned unexpected response');
  return json.url;
}

// Submit application JSON to tutors endpoint
async function submitTutorApplication(payload) {
  const res = await fetch(`${API_BASE}/api/tutors/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  const json = await res.json();
  if (!res.ok) {
    const message = json?.message || json?.error || res.statusText || 'Unknown error';
    throw new Error(message);
  }
  return json;
}

// Form submission
document.getElementById('tutorRegForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  formMsg.textContent = '';
  formMsg.style.color = '#111827';

  // Collect fields
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const fullname = document.getElementById('fullname').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const about = document.getElementById('about').value.trim();
  const linkedin = document.getElementById('linkedin').value.trim();

  // client-side validations
  if (!username || !password || !confirmPassword) { formMsg.textContent = 'Please provide username and password.'; return; }
  if (password.length < 6) { formMsg.textContent = 'Password must be at least 6 characters.'; return; }
  if (password !== confirmPassword) { formMsg.textContent = 'Passwords do not match.'; return; }
  if (!fullname || !email || !phone || !about) { formMsg.textContent = 'Please fill all required fields.'; return; }
  if (selectedSpecialties.length === 0) { formMsg.textContent = "Select at least one specialty."; return; }
  if (achievements.length === 0) { formMsg.textContent = "Add at least one achievement."; return; }

  const avatarFile = avatarInput.files[0];
  if (!avatarFile || !avatarFile.type.startsWith("image/")) { formMsg.textContent = "Upload a valid photo."; return; }

  setLoading(true);

  try {
    // 1) Upload avatar image
    let avatarUrl = "";
    try {
      avatarUrl = await uploadImageToServer(avatarFile);
    } catch (imgErr) {
      console.warn('Image upload failed, attempting to send data URL as avatar:', imgErr);
      const dataUrl = await fileToDataUrl(avatarFile);
      avatarUrl = dataUrl;
    }

    // 2) Build payload including credentials
    const payload = {
      username,
      password,
      fullname,
      email,
      phone,
      specialties: selectedSpecialties,
      about,
      achievements,
      avatar: avatarUrl,
      social: { linkedin },
      // keep role as tutor; backend tutors/register may ignore some fields,
      // but we include them so backend can use them if updated.
      role: "tutor"
    };

    const result = await submitTutorApplication(payload);
    formMsg.style.color = "#065f46"; // green
    formMsg.textContent = result?.message || "Application submitted successfully. We'll contact you by email.";
    // Reset form
    document.getElementById('tutorRegForm').reset();
    selectedSpecialties = [];
    achievements = [];
    renderSpecialties();
    renderAchievements();
    avatarPreview.classList.add('hidden');
  } catch (err) {
    console.error("Submit error:", err);
    formMsg.style.color = "#9b1c1c";
    formMsg.textContent = err.message || "Submission failed. Try again.";
  } finally {
    setLoading(false);
  }
});

// Helper: file -> data URL
function fileToDataUrl(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onerror = () => { reader.abort(); reject(new Error('Problem reading file')); };
    reader.onload = () => resolve(reader.result);
    reader.readAsDataURL(file);
  });
}

// Init
document.addEventListener('DOMContentLoaded', () => {
  renderSpecialties();
  renderAchievements();
});
</script>

</body>
</html>
