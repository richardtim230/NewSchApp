<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Tutor Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']]
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
      }
    };
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root { --primary:#2563eb; --secondary:#f1f5f9; --user:#dcfce7; --bot:#f3f4f6; --font:'Segoe UI',Arial,sans-serif;}
    body {background:var(--secondary);font-family:var(--font);margin:0;display:flex;min-height:100vh;align-items:center;justify-content:center;}
    .chat-container {background:#fff;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,0.09);width:100%;max-width:455px;min-width:310px;display:flex;flex-direction:column;height:692px;padding:0;overflow:hidden;}
    .chat-header {background:var(--primary);color:#fff;padding:15px 20px 13px 20px;font-size:1.18rem;font-weight:bold;text-align:left;display:flex;align-items:center;gap:13px;letter-spacing:0.2px;justify-content:space-between;}
    .profile-avatar {width:38px;height:38px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px #2221;margin-left:2px;}
    .chat-topicbar {display:flex;align-items:center;padding:8px 13px;background:#f8fafc;border-bottom:1px solid #e5e7eb;gap:10px;position:relative;min-height:47px;}
    .topic-plus-btn {background:var(--primary);color:#fff;border:none;border-radius:50%;width:33px;height:33px;font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-right:2px;}
    .topic-dropdown {display:none;position:absolute;left:40px;top:44px;background:#fff;box-shadow:0 4px 16px #2563eb19;border-radius:12px;z-index:21;min-width:110px;flex-direction:column;gap:0;border:1px solid #e5e7eb;}
    .topic-dropdown.show {display:flex;}
    .topic-btn {padding:12px 21px;background:none;border:none;color:#2563eb;outline:none;font-size:1rem;font-weight:520;cursor:pointer;text-align:left;transition:background 0.13s;}
    .topic-btn.active,.topic-btn:hover {background:#e6edfa;color:#1747a7;}
    .chat-messages {flex:1;overflow-y:auto;padding:15px 13px 5px 13px;background:var(--secondary);display:flex;flex-direction:column;gap:18px;position:relative;}
    .message-row {display:flex;align-items:flex-end;gap:12px;}
    .message-row.user {justify-content:flex-end;}
    .message-row.prof {justify-content:flex-start;}
    .message-avatar {width:27px;height:27px;border-radius:50%;object-fit:cover;}
    .message-bubble {max-width:96%;margin:8px 0;padding:14px 19px;border-radius:16px 16px 4px 16px;font-size:0.93rem;background:var(--bot);color:#112;line-height:1.52;word-break:break-word;min-width:70px;overflow:auto;box-sizing:border-box;}
    .message-row.user .message-bubble {background:var(--user);color:#25633e;border-radius:16px 16px 16px 4px;}
    .rich-block {margin:10px 0;padding:0 2vw;font-size:0.92em;}
    .rich-block h1,.rich-block h2,.rich-block h3,.rich-block h4 {margin:0.4em 0 0.1em 0;}
    .rich-block ul,.rich-block ol {margin-bottom:0.12em;padding-left:1em;}
    .rich-block li {margin-bottom:0.18em;line-height:1.37;font-size:0.92em;}
    .rich-block table {border:1px solid #c6c8d0;border-radius:6px;width:99%;margin:0.4em 0;background:#fff;}
    .rich-block th,.rich-block td {border:1px solid #e4e5eb;padding:6px 11px;}
    .math {font-size:1.09em;background:none!important;}
    .message-meta {font-size:0.81rem;color:#777;margin:4px 0 0 0;text-align:right;margin-right:8px;display:flex;align-items:center;gap:2px;}
    .message-row.prof .message-meta {text-align:left;margin-left:8px;}
    .message-status {font-size:.94rem;margin-left:4px;vertical-align:middle;color:#3897f0;}
    .typing-indicator {font-size:0.98rem;color:#789;margin-left:10px;animation:typingBlink 1.2s infinite;background:none;margin-top:2px;}
    @keyframes typingBlink {0%{opacity:1;}50%{opacity:0.42;}100%{opacity:1;}}
    .loadmore-btn {margin:2px auto 0 auto;display:block;padding:7px 19px;font-size:.96rem;background:#eff2fa;color:#2563eb;border:none;border-radius:8px;cursor:pointer;box-shadow:1px 3px 8px 0 #a4b2db16;}
    .loadmore-btn:hover {background:#e0e0ee;}
    .chat-input-bar-container {width:86%;max-width:300px;margin:0 auto 0 auto;}
    .chat-input-bar {display:flex;align-items:flex-start;padding:8px 4px 8px 6px;background:#fff;border-top:1px solid #e5e7eb;gap:4px;position:relative;width:100%;min-width:170px;}
    .chat-input {padding:9px 10px;font-size:.99rem;border-radius:16px;border:1px solid #e5e7eb;outline:none;transition:border 0.2s;flex:1;resize:vertical;min-height:30px;max-height:84px;line-height:1.54;}
    .chat-input:focus {border-color:var(--primary);}
    .send-btn {background:var(--primary);color:#fff;border:none;border-radius:50%;width:35px;height:35px;cursor:pointer;display:flex;justify-content:center;align-items:center;font-size:1.16rem;}
    .send-btn:active {background:#1747a7;}
    .emoji-btn,.attach-btn {background:none;border:none;font-size:1.12rem;color:#7d8dae;cursor:pointer;width:25px;height:31px;margin-right:2px;margin-top:2px;display:flex;align-items:center;justify-content:center;}
    .emoji-picker {position:absolute;bottom:54px;left:-5px;background:#fff;border:1px solid #e5e7eb;box-shadow:0 2px 16px rgba(0,0,0,0.08);padding:7px 7px;border-radius:14px;display:none;z-index:10;}
    .emoji-picker.active {display:grid;grid-template-columns:repeat(8,1fr);gap:7px;max-width:250px;left:-21px;}
    .emoji-picker span {cursor:pointer;font-size:1.02rem;}
    .emoji-picker span:hover {transform:scale(1.15);background:#f1f5f9;border-radius:2px;}
    .attach-preview {max-width:120px;max-height:60px;border-radius:7px;margin:2px 0 0 0;display:block;}
    .attachment-link {color:#2563eb;font-size:0.87rem;display:flex;align-items:center;text-decoration:none;margin-top:0px;}
    .attachment-link i {margin-right:3px;}
    .login-screen {width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:var(--secondary);position:absolute;top:0;left:0;z-index:55;flex-direction:column;}
    .login-card {background:#fff;padding:30px 18px 26px 18px;border-radius:14px;box-shadow:0 5px 24px #2563eb14;min-width:225px;max-width:275px;display:flex;flex-direction:column;align-items:center;gap:10px;}
    .login-card input {font-size:.97rem;width:98%;padding:9px;border-radius:8px;border:1px solid #e5e7eb;outline:none;margin-bottom:7px;margin-top:2px;}
    .login-card .login-btn {width:93%;padding:10px;background:#2563eb;color:#fff;border:none;border-radius:8px;font-size:.93rem;margin-top:10px;cursor:pointer;}
    .login-card .login-btn:hover {background:#193a7a;}
    .user-info-bar {display:flex;align-items:center;gap:7px;font-size:.97rem;font-weight:510;}
    @media(max-width:630px) {.chat-container {max-width:98vw;}.chat-input-bar-container {max-width:93vw;}}
    @media(max-width:480px) {.chat-container {height:100vh;max-width:99vw;border-radius:0;}.chat-input-bar-container{width:96vw;}.message-bubble{max-width:99vw;padding:14px 2vw;font-size:1.04rem;}.rich-block{margin:10px 0;padding:0 2vw;}}
  </style>
</head>
<body>
  <div id="loginScreen" class="login-screen" style="display:none;">
    <form class="login-card" id="loginForm">
      <img src="https://avatars.githubusercontent.com/u/645549?v=4" alt="Academic Tutor" class="profile-avatar" style="width:50px;height:50px;">
      <div style="margin-bottom:8px;font-weight:580;font-size:1.03rem;">Academic Tutor Login</div>
      <input type="text" id="loginUsername" placeholder="Username" autocomplete="username" required>
      <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password" required>
      <button type="submit" class="login-btn">Login</button>
      <div id="loginError" style="color:red;font-size:.97em;min-height:15px;"></div>
    </form>
  </div>
  <div class="chat-container" id="chatContainer" style="display:none;">
    <div class="chat-header">
      <span><i class="fas fa-graduation-cap"></i> Academic Tutor</span>
      <span class="user-info-bar" id="userInfoBar"></span>
    </div>
    <div class="chat-topicbar">
      <button class="topic-plus-btn" id="topicPlusBtn" title="Choose topic">+</button>
      <div class="topic-dropdown" id="topicDropdown"></div>
      <span id="selectedTopic" style="font-size:1.02rem;font-weight:540;color:#2563eb;"></span>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="typing-indicator" id="typingIndicator" style="display:none;">Professor is typing...</div>
    </div>
    <button id="loadMoreBtn" class="loadmore-btn" style="display:none;">Load More</button>
    <div class="chat-input-bar-container">
      <form class="chat-input-bar" id="chatForm" autocomplete="off">
        <button type="button" class="emoji-btn" id="emojiBtn" title="Emoji Picker"><i class="fa-regular fa-face-grin"></i></button>
        <div class="emoji-picker" id="emojiPicker"></div>
        <button type="button" class="attach-btn" id="attachBtn" title="Attach image"><i class="fa-solid fa-paperclip"></i></button>
        <input type="file" style="display:none;" id="attachInput" accept="image/*"/>
        <textarea class="chat-input" id="chatInput" rows="2" placeholder="Type your academic question... (Shift+Enter for newline, $math$ or block \[math\])" autocomplete="off"></textarea>
        <button type="submit" class="send-btn" title="Send"><i class="fa-solid fa-paper-plane"></i></button>
      </form>
    </div>
  </div>
  <script src="ai-chat.js"></script>
</body>
</html>
