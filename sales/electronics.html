<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Electronics - Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.5.1/flowbite.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Navbar -->
  <header class="bg-white shadow-md fixed top-0 left-0 w-full z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
      <h1 class="text-2xl font-bold text-blue-600">Market<span class="text-gray-900">Place</span></h1>
      <nav class="hidden md:flex gap-8 font-medium">
        <a href="/" class="hover:text-blue-600 transition">Home</a>
        <a href="/shop" class="hover:text-blue-600 transition">Shop</a>
        <a href="/categories" class="hover:text-blue-600 transition">Categories</a>
        <a href="/contact" class="hover:text-blue-600 transition">Contact</a>
      </nav>
      <div class="flex gap-4">
        <a href="/signin" class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition">Sign In</a>
        <a href="/signup" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Sign Up</a>
      </div>
    </div>
  </header>

  <!-- Hero Banner -->
  <section class="relative bg-center bg-no-repeat bg-cover h-64 flex items-center justify-center mt-16"
           style="background-image: url('https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=1600&q=80');">
    <div class="absolute inset-0 bg-black/50"></div>
    <h1 class="relative z-10 text-4xl md:text-5xl font-extrabold text-white">Electronics</h1>
  </section>

  <!-- Filter + Sort -->
  <section class="max-w-7xl mx-auto px-6 py-8 flex flex-col md:flex-row justify-between items-center gap-4">
    <div class="flex gap-2">
      <select id="productTypeFilter" class="px-4 py-2 border rounded-lg">
        <option value="">All Products</option>
        <option value="Phones">Phones</option>
        <option value="Laptops">Laptops</option>
        <option value="Accessories">Accessories</option>
      </select>
      <select id="sortSelect" class="px-4 py-2 border rounded-lg">
        <option value="latest">Sort by: Latest</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="rating">Rating</option>
      </select>
    </div>
    <input id="searchInput" type="text" placeholder="Search within electronics..." 
           class="px-4 py-2 border rounded-lg w-full md:w-72 focus:ring-2 focus:ring-blue-500 outline-none">
  </section>

  <!-- Product Grid -->
  <section id="productGrid" class="max-w-7xl mx-auto px-6 py-8 grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
    <!-- Products will be loaded here -->
  </section>

  <!-- Pagination -->
  <div class="max-w-7xl mx-auto px-6 py-8 flex justify-center">
    <nav id="paginationNav" class="inline-flex space-x-2"></nav>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-300 py-10">
    <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-3 gap-8">
      <div>
        <h3 class="text-xl font-bold text-white">Marketplace</h3>
        <p class="mt-3 text-sm">Discover electronics and more with trust & safety guaranteed.</p>
      </div>
      <div>
        <h3 class="font-semibold text-white">Quick Links</h3>
        <ul class="mt-3 space-y-2 text-sm">
          <li><a href="#" class="hover:text-white">About Us</a></li>
          <li><a href="#" class="hover:text-white">Categories</a></li>
          <li><a href="#" class="hover:text-white">Support</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-semibold text-white">Follow Us</h3>
        <div class="flex gap-4 mt-3">
          <a href="#" class="hover:text-white">üåê</a>
          <a href="#" class="hover:text-white">üê¶</a>
          <a href="#" class="hover:text-white">üì∏</a>
        </div>
      </div>
    </div>
    <div class="text-center text-sm text-gray-500 mt-10">¬© 2025 Marketplace. All rights reserved.</div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.5.1/flowbite.min.js"></script>
  <script>
    // API endpoint for electronics category
    const API_URL = "https://examguide.onrender.com/api/bloggerDashboard/public/posts";
    const POSTS_PER_PAGE = 12;
    let currentPage = 1;
    let productData = [];
    let totalPages = 1;

    // Fetch products from backend
    async function fetchProducts({ category = "Electronics", page = 1, search = "", type = "", sort = "latest" } = {}) {
      let url = `${API_URL}?category=${encodeURIComponent(category)}&page=${page}&limit=${POSTS_PER_PAGE}`;
      try {
        const res = await fetch(url);
        let products = res.ok ? await res.json() : [];
        // Filter by type (sub-category)
        if (type) products = products.filter(p => (p.category || "").toLowerCase() === type.toLowerCase());
        // Search filter
        if (search) {
          const q = search.toLowerCase();
          products = products.filter(p =>
            (p.title && p.title.toLowerCase().includes(q)) ||
            (p.category && p.category.toLowerCase().includes(q)) ||
            (p.summary && p.summary.toLowerCase().includes(q)) ||
            (p.description && p.description.toLowerCase().includes(q))
          );
        }
        // Sort
        if (sort === "price-low") products.sort((a, b) => (parseInt(a.price) || 0) - (parseInt(b.price) || 0));
        else if (sort === "price-high") products.sort((a, b) => (parseInt(b.price) || 0) - (parseInt(a.price) || 0));
        else if (sort === "rating") products.sort((a, b) => ((parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0)));
        else products.sort((a, b) => new Date(b.date) - new Date(a.date)); // latest
        productData = products;
        renderProducts(products);
        // Pagination: assume backend supports /public/posts/count
        await renderPagination(category);
      } catch (e) {
        document.getElementById("productGrid").innerHTML = `<div class="col-span-4 text-center text-gray-500 py-12">Could not load products.</div>`;
      }
    }

    // Render products
    function renderProducts(products) {
      const grid = document.getElementById("productGrid");
      if (!products.length) {
        grid.innerHTML = `<div class="col-span-4 text-center text-gray-500 py-12">No products found.</div>`;
        return;
      }
      grid.innerHTML = products.map(p => {
        // Seller info: fallback to author fields if available
        let seller = p.seller || p.author || p.authorName || "Seller";
        // Faculty/department display (handle both string and object)
        let faculty = p.faculty?.name || p.faculty || "";
        let department = p.department?.name || p.department || "";
        // Format posted date
        let posted = p.posted || (p.date ? new Date(p.date).toLocaleDateString() : "");
        let price = p.price ? `‚Ç¶${p.price}` : (p.price || "");
        let img = p.imageUrl || (p.images && p.images[0]) || "https://flowbite.s3.amazonaws.com/docs/gallery/square/image-1.jpg";
        let rating = p.rating || ("‚≠ê " + (p.likes || 0));
        return `
          <div class="bg-white rounded-xl shadow overflow-hidden hover:shadow-lg transition flex flex-col">
            <img src="${img}" class="h-48 w-full object-cover" alt="${p.title}">
            <div class="p-4 flex flex-col flex-1">
              <h3 class="font-bold text-lg text-blue-800">${p.title}</h3>
              <p class="text-yellow-600 font-semibold">${price}</p>
              <p class="text-gray-500 text-sm">${faculty ? faculty + " ‚Ä¢ " : ""}${department ? department + " ‚Ä¢ " : ""}${posted}</p>
              <div class="flex items-center gap-2 mt-2">
                <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">${seller}</span>
                <span class="flex items-center text-sm text-yellow-600">${rating}</span>
              </div>
              <p class="mt-2 text-gray-700 text-sm">${p.description || p.summary || ""}</p>
              <div class="flex gap-3 mt-4">
                <button class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">View & Chat</button>
                <button class="flex-1 px-3 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">Send Offer</button>
              </div>
              <a href="#" class="block text-right text-red-500 text-sm mt-2 hover:underline">Report</a>
            </div>
          </div>
        `;
      }).join("");
    }

    // Render pagination
    async function renderPagination(category) {
      const pag = document.getElementById('paginationNav');
      pag.innerHTML = '';
      try {
        const res = await fetch(`https://examguide.onrender.com/api/bloggerDashboard/public/posts/count?category=${encodeURIComponent(category)}`);
        const data = res.ok ? await res.json() : { count: productData.length };
        const count = data.count || productData.length;
        totalPages = Math.max(1, Math.ceil(count / POSTS_PER_PAGE));
        // Build pagination links
        for (let i = 1; i <= totalPages; i++) {
          pag.innerHTML += `<a href="#" class="px-3 py-2 bg-white border rounded hover:bg-gray-100${i === currentPage ? ' font-bold bg-yellow-100' : ''}" onclick="changePage(${i});return false;">${i}</a>`;
        }
      } catch {
        pag.innerHTML = `<a href="#" class="px-3 py-2 bg-white border rounded hover:bg-gray-100 font-bold bg-yellow-100">1</a>`;
      }
    }

    // Change page
    window.changePage = function(page) {
      currentPage = page;
      doFetch();
    }

    // Do fetch with current filters
    function doFetch() {
      const category = "Electronics";
      const type = document.getElementById("productTypeFilter").value;
      const search = document.getElementById("searchInput").value.trim();
      const sort = document.getElementById("sortSelect").value;
      fetchProducts({ category, page: currentPage, search, type, sort });
    }

    // Event listeners for filters/search
    document.addEventListener("DOMContentLoaded", function() {
      doFetch();
      document.getElementById("productTypeFilter").addEventListener("change", function() { currentPage = 1; doFetch(); });
      document.getElementById("sortSelect").addEventListener("change", function() { currentPage = 1; doFetch(); });
      document.getElementById("searchInput").addEventListener("keyup", function(e) {
        if (e.key === "Enter") { currentPage = 1; doFetch(); }
      });
    });
  </script>
</body>
</html>
