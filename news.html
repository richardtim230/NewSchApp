<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Tutor Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    window.MathJax = {...}; // unchanged
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --primary:#2563eb; --secondary:#f1f5f9;
      --user:#dcfce7; --bot:#f3f4f6;
      --font:'Segoe UI',Arial,sans-serif;
    }
    body {background:var(--secondary);font-family:var(--font);margin:0;display:flex;min-height:100vh;align-items:center;justify-content:center;}
    .chat-container {
      background:#fff; border-radius:24px; box-shadow:0 8px 24px rgba(0,0,0,0.09);
      width:100%; max-width:455px; min-width:310px; display:flex; flex-direction:column; height:700px; padding:0; overflow:hidden;
    }
    .chat-header {
      background:var(--primary); color:#fff; padding:15px 20px 13px 20px; font-size:1.24rem; font-weight:bold; text-align:center;
      display:flex; align-items:center; justify-content:space-between; border-radius:24px 24px 0 0; min-height:57px; position:relative;
    }
    .menu-btn { background:none; border:none; color:#fff; font-size:1.4rem; margin-right:12px; cursor:pointer; }
    .header-title { flex:1; text-align:center; font-size:1.25rem; letter-spacing:0.6px;}
    .header-profile { display:flex; align-items:center; gap:7px; }
    .profile-avatar {width:38px;height:38px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px #2221;margin-left:2px;}
    .username-bar { font-size:1rem; font-weight:500; color:#fff; margin-left:3px; }
    .chat-messages { ... /* unchanged, but see bubble changes below */ }
    .message-row {display:flex;align-items:flex-end;gap:12px;}
    .message-row.user {justify-content:flex-end;}
    .message-row.prof {justify-content:flex-start;}
    .message-avatar {width:35px;height:35px;border-radius:50%;object-fit:cover;margin-bottom:8px;}
    .message-bubble {
      max-width:69vw; margin:8px 0; padding:16px 24px; border-radius:20px 20px 6px 20px; font-size:1rem;
      background:var(--bot); color:#112; word-break:break-word; box-shadow:0 2px 7px #c8d9ee22;
    }
    .message-row.user .message-bubble {
      background:var(--user); color:#25633e; border-radius:20px 20px 20px 6px;
    }
    .message-meta {font-size:0.82rem;color:#999;margin-top:2px;}
    .chat-header .header-profile { align-items:center; }
    .chat-topicbar { display:none; } /* hide existing topic bar for now */
    .side-btns { position:absolute; right:10px; top:70px; display:flex; flex-direction:column; gap:16px; }
    .side-btn { background:#e6edfa; color:#2563eb; border:none; border-radius:50%; width:38px; height:38px; font-size:1.3rem; cursor:pointer; box-shadow:0 2px 7px #c8d9ee22;}
    .side-btn:active { background:#ccd7f6;}
    .chat-input-bar-container {
      width:96%; max-width:99vw; margin:0 auto 0 auto; position:absolute; bottom:18px; left:0; right:0;
    }
    .chat-input-bar {
      display:flex;align-items:center;padding:11px 10px 11px 10px;background:#fff;
      border-radius:16px; box-shadow:0 2px 12px #2563eb10; gap:8px; width:99%;
    }
    .chat-input {
      padding:13px 12px;font-size:1.07rem;border-radius:14px;border:1px solid #e5e7eb;outline:none;transition:border 0.2s;flex:1;resize:vertical;
      min-height:33px;max-height:84px;line-height:1.6;box-shadow:none;background:#f7f9fd;
    }
    .emoji-btn, .attach-btn, .send-btn {
      background:none;border:none;cursor:pointer;font-size:1.32rem;color:#7d8dae;width:34px;height:34px;border-radius:50%;transition:background 0.1s;
    }
    .send-btn { background:var(--primary); color:#fff; }
    .emoji-btn:hover, .attach-btn:hover {background:#f1f4fa;}
    .send-btn:active {background:#1747a7;}
    .emoji-picker { /* unchanged */ }
    @media(max-width:480px) {
      .chat-container {border-radius:0;height:100vh;}
    }
  </style>
</head>
<body>
  <div id="loginScreen" class="login-screen" style="display:none;">
    <form class="login-card" id="loginForm">
      <img src="https://avatars.githubusercontent.com/u/645549?v=4" alt="Academic Tutor" class="profile-avatar" style="width:50px;height:50px;">
      <div style="margin-bottom:8px;font-weight:580;font-size:1.03rem;">Academic Tutor Login</div>
      <input type="text" id="loginUsername" placeholder="Username" autocomplete="username" required>
      <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password" required>
      <button type="submit" class="login-btn">Login</button>
      <div id="loginError" style="color:red;font-size:.97em;min-height:15px;"></div>
    </form>
  </div>
  <div class="chat-container" id="chatContainer" style="display:none;position:relative;">
    <div class="chat-header">
      <button class="menu-btn"><i class="fas fa-bars"></i></button>
      <div class="header-title">ACADEMIC TUTOR</div>
      <div class="header-profile">
        <img src="https://avatars.githubusercontent.com/u/645549?v=4" id="headerProfilePic" class="profile-avatar" alt="Profile">
        <span id="headerUsername" class="username-bar"></span>
      </div>
    </div>
    <div class="side-btns">
      <button class="side-btn" id="sideMinusBtn" title="Scroll Up"><i class="fa-solid fa-minus"></i></button>
      <button class="side-btn" id="sidePlusBtn" title="Topics/Plus"><i class="fa-solid fa-plus"></i></button>
    </div>
    <div class="chat-messages" id="chatMessages" style="padding-bottom:60px;">
      <div class="typing-indicator" id="typingIndicator" style="display:none;">Professor is typing...</div>
    </div>
    <div class="chat-input-bar-container">
      <form class="chat-input-bar" id="chatForm" autocomplete="off">
        <button type="button" class="emoji-btn" id="emojiBtn" title="Emoji Picker"><i class="fa-regular fa-face-grin"></i></button>
        <div class="emoji-picker" id="emojiPicker"></div>
        <button type="button" class="attach-btn" id="attachBtn" title="Attach image"><i class="fa-solid fa-paperclip"></i></button>
        <input type="file" style="display:none;" id="attachInput" accept="image/*"/>
        <textarea class="chat-input" id="chatInput" rows="2" placeholder="Type your academic question... (Shift+Enter for newline, $math$ or block \[math\])" autocomplete="off"></textarea>
        <button type="submit" class="send-btn" title="Send"><i class="fa-solid fa-paper-plane"></i></button>
      </form>
    </div>
  </div>
  <script src="ai-chat.js"></script>
</body>
</html>
